YUI.add("mail-ui-foldersview-bind",function(e){function x(t,n){var i=n.one('[data-action="folder-rename"]'),s=n.one('[data-action="folder-remove"]'),o=n.one('[data-action="folder-move"]'),u=n.one('[data-action="folder-allread"]'),a=e.one(f),l=a.all(".custom a");l.removeClass(m),t.hasClass("papa-folder")?(i.addClass(m),s.addClass(m),o.addClass(m)):(i.removeClass(m),s.removeClass(m),o.removeClass(m)),r.Controller.Folders.get(t.getAttribute("data-fid")).unread>0?u.removeClass(m):u.addClass(m)}function T(){var t=e.one(f),n=t.all(".custom a");n.addClass(m),t.fire("menu:changed")}function k(e,t){e&&("show"===t&&!e.hasClass("selected")?e.addClass("cntxtmenu"):"hide"===t&&e.removeClass("cntxtmenu"))}function L(e,t){var n,r=t.keyCode===40?"next":"previous",i,s,o,u,a,f,l,c=function(e){return e.getComputedStyle("display")==="none"||e.get("offsetWidth")<=0||e.get("offsetHeight")<=0||e.hasClass("nav-separator")||e.hasClass("offscreen")||e.hasClass("hidden")};return e?(i=e[r](),i?(c(i)?i=L(i,t):t.keyCode===38&&(i.hasClass("nav-open")||i.hasClass("listnav-container")||i.hasClass("listnav-subfolder"))&&(o=i.one("ul#custom-folders"),o&&(u=o.all("li"),a=o?u.size():0,f=a?u.item(a-1):null,c(f)?i=L(f,t):i=f)),n=i):(s=e.get("parentNode"),s.get("id")==="multitask"?n=s.ancestor("ul").one("#Inbox"):n=L(s,t))):n=null,n}function A(e,t){var n,r={},i=t.keyCode,s,o,u=function(e,n){var r=e.all(n),i=r.size(),s=null;return i&&(s=r.item(i-1).ancestor("li"),s.getComputedStyle("display")==="none"&&(s=L(s,t))),s};return e?(r[e.get("id")]=!0,r.Folders&&i===40&&e.hasClass("nav-open")?o=e.one("#custom-folders").one("li.folder"):r.multitask?(i===38?(s=L(e,t),s&&s.hasClass("nav-open")&&(s=u(s,'a[role="link"]'))):(e.hasClass("nav-open")&&(s=e.one("li.removable")),s||(n=e.ancestor("ul"),s=n&&n.one("#Inbox"))),o=s):r.Inbox&&i===38?(n=e.ancestor("ul"),s=n&&n.one("#multitask"),s&&s.hasClass("nav-open")&&(s=u(s,'a[role="tab"]'),s.hasClass("empty-tabs")&&(s=n.one("#multitask"))),o=s):o=L(e,t)):o=null,o&&(o.get("id")==="multitask"?o=o.one("button"):o.get("tagName").toLowerCase()!=="button"&&o.get("tagName").toLowerCase()!=="a"&&(o=o.one("a[role=link]")||o.one("a[role=tab]"))),o}function I(){var e="neo.pref.folderState",t;t=parseInt(i.get("neo.pref.folderState"),10)===0?1:0,i.set(e,t)}var t=e.Node.one,n=e.common.Utils,r=e.mail,i=r.persist.MetaData,s=strings.str_nav_inbox,o=n.features.enabled("folderManagement"),u="#storm-listnav",a="#custom-folders",f="#menu-system-folder",l="filtering-search",c="."+l,h=".filter-on",p="no-results",d="data-searchIdx",v="selected",m="disabled",g=t(u),y=t(a),b={"in":"Inbox",chats:"%40C%40Chats",drafts:"Draft",sent:"Sent",folder:"%40B%40Bulk",spam:"%40B%40Bulk",trash:"Trash"},w={Inbox:"str_tabs_inbox",Draft:"str_tabs_drafts",Sent:"str_tabs_sent","%40B%40Bulk":"str_tabs_spam","%40C%40Chats":"str_tabs_conversations",Trash:"str_tabs_trash"},E=e.Lang,S=function(t,n,r){var i={action:r,args:{}},s={inbox:"folderview_inbox",drafts:"folderview_draft",sent:"folderview_sent",trash:"folderview_trash",conversations:"folderview_chat",spam:"folderview_bulk",custom_fldr:"folderview_custom"},o;return r==="sysFldCk"&&(typeof t=="string"&&n==="btn"?(i.args.btn=t.replace("btn-",""),t==="checkmail"&&(o="inbox"),i.action=i.args.btn+"_btn"):(o=w[t]&&w[t].replace("str_tabs_",""),i.args.id=o,i.action=i.args.id+"_fldr")),r==="usr_fldr"&&(o="custom_fldr",i.args.id=t||""),i.spid=s[o]||"",e.fire("mt:click",i),!0},N=function(n){function v(t){var n=h.menu.getContextTarget(),i;e.fire("mt:click",{action:"cntxt_mnu_fldr_v3_itm_"+t.dataAction}),n&&(t.target=n.ancestor(function(e){return i=e.getAttribute("data-fid")||null,i},!0),i?r.handleFolderActions(t,i):r.handleFolderActions(t))}function m(n){var r=h.menu,o=r.getContextTarget().ancestor("li"),u=t(f),a;i&&i.setNodeFolderMenu(o,u),n.state==="show"&&(o.ancestor(c,!0)?u.setAttribute("data-context",l):o.ancestor("#smartviews",!0)?u.setAttribute("data-context","smartviews"):o.ancestor("#multitask",!0)?u.setAttribute("data-context","multitask"):(p.contains(o)?(u.setAttribute("data-context","usr-folders-v3"),x(o,u),e.use("mail-ui-folder-menu",function(e){var t=u.one(".menu-move-folder"),n=t.ancestor();e.mail.ui.FolderMenu.enhanceMenu({menu:r,root:n,groups:[t],childSelector:"li",displayNameSelector:"a span",toggleSelector:'[data-action="folder-move"]',toggleGroup:n.one("ul"),noShortcuts:!0,context:r.getContextTarget(),rapidPrefix:"cntxt_mv_fldr_mnu"})})):(a=o.getAttribute("id"),u.setAttribute("data-ftype",a),a==="Folders"?u.setAttribute("data-context","folder-title-v3"):u.setAttribute("data-context","sys-folders-v3"),T(),e.use("mail-ui-folder-menu",function(e){e.mail.ui.FolderMenu.removeEnhancements(u,u.one(".menu-move-folder"))})),u.setAttribute("aria-labelledby",""))),k(o,n.state),n.state==="hide"&&s&&s.focus()}var r=this,i=e.mail.ui.ContextButton,s=n.target,h=t(u),p=t(a),d;n.preventDefault();if(!h.menu){var g=["common-ui-menu-helper","mail-ui-inboxmenu-base"];o&&g.push("mail-ui-folder-menu"),e.use(g,function(e){e.mail.ui.InboxMenu.insert("menu-system-folder",function(){var r=t(f);e.common.ui.MenuHelper.create(h,{menu:r,isContext:!0,xy:[n.clientX,n.clientY],contextTarget:n.target,keys:function(t){t(e.mail.ui.InboxMenu.getValidKeys(r))}},function(){r.on("menuSelected",v),r.on("menu:state",m)})})})}e.fire("mt:click",{action:"cntxt_mnu_fldr_v3"})},C=function(n){function u(t){var n=o.menu.getContextTarget(),i;n&&(t.target=n.ancestor(function(e){return i=e.getAttribute("data-fid")||null,i},!0),i&&(r.handleFolderActions(t,i),e.fire("mt:click",{action:"cntxt_mnu_sys_fldr_itm_"+t.dataAction})))}var r=this,i=e.mail.ui.ContextButton,s=n.target,o=n.currentTarget;n.preventDefault(),o.menu||e.use("common-ui-menu-helper",function(e){var r=e.common.ui.MenuHelper;r.createLoadingMenu(g,{isContext:!0,xy:[n.clientX,n.clientY]}),e.use("mail-ui-inboxmenu-base",function(e){e.mail.ui.InboxMenu.insert("menu-system-folder",function(){var r=t(f);e.common.ui.MenuHelper.create(o,{menu:r,isContext:!0,xy:[n.clientX,n.clientY],
contextTarget:n.target,keys:function(t){t(e.mail.ui.InboxMenu.getValidKeys(r))}},function(){r.on("menuSelected",u),r.on("menu:state",function(e){var t=o.menu.getContextTarget().ancestor("li");t.hasClass("sysfolder")||e.preventDefault();if(e.state==="show"){var n=this.one("[data-action=folder-allread]");t&&"%40C%40Chats"===t.getAttribute("data-fid")?(n.addClass("disabled"),n.one("a").set("aria-disabled",!0)):(n.removeClass("disabled"),n.one("a").removeAttribute("aria-disabled"))}else e.state==="hide"&&s&&s.focus();i&&i.setNodeFolderMenu(t,r),k(t,e.state)})})})})}),e.fire("mt:click",{action:"cntxt_mnu_sys_fldr"})},O=function(t){S("checkmail","btn","sysFldCk");var n=t.currentTarget,r=n.getAttribute("data-mboxid");this.checkMail(r),e.fire("darlaEvent",{action:NeoConfig.isSSL?"folderview_inbox_ssl":"folderview_inbox"})},M=function(t){e.fire("#storm-listnav li.sysfolder:keydown",t)},_=function(t){var r=t.currentTarget,i=t.keyCode,s,o=e.UA.os,u,a,f,c,m=y.hasClass(l),g;m&&(c=y.all(h),u=c.size(),f=y.getAttribute(d)*1,g=function(e,t){c.removeClass(v),c.setAttribute("tabindex","-1"),e&&(e.addClass(v),e.setAttribute("tabIndex","0")),y.setAttribute(d,t)}),o==="macintosh"&&i===8&&(i=46);switch(i){case 13:m&&(u===1?(a=c.item(0),a.hasClass(p)||a.simulate("click")):f>=0&&c.item(f).simulate("click"));break;case 40:f<u-1&&(a=c.item(f+1),a.hasClass(p)||g(a,f+1));break;case 38:f>=0&&(a=c.item(f-1),a&&g(a,f-1));break;case 121:case 77:s=o==="windows"||o==="win";if(s&&t.shiftKey&&i===121||!s&&t.ctrlKey&&t.shiftKey&&t.altKey&&i===77)t.preventDefault(),n.simulateContextMenu(t.target);break;default:m&&(g(null,-1),e.fire("mt:click",{action:"fldr_srch"}))}},D=function(t){var r=t.target,i,s,o,u=!1,a,f=t.keyCode,l,c=n.substitute,h;if(f===38||f===40)t.halt(),i=A(r.ancestor("li"),t),i?i?(r.get("tagName").toLowerCase()!=="button"&&r.setAttribute("tabindex",-1),i.set("tabIndex",0),i.focus()):e.use("common-utils-error",function(e){e.common.Utils.error.report("Anchor not set; listItem markup is '"+i.getHTML()+"'","UP_DOWN_NAV_ERROR",1,1,1)}):f===38&&r===e.one("#custom-folders a")&&(e.one("#custom-folders-btn").focus(),t.halt());else if(f==37||f==39||f==13)s=r.ancestor("li"),s.hasClass("papa-folder")?(u=!0,o=s.one(".listnav-folder-toggle"),f==37?(o.replaceClass("icon-chevron-down","icon-chevron-right"),s.next().addClass("hidden")):f==39?(o.replaceClass("icon-chevron-right","icon-chevron-down"),s.next().removeClass("hidden")):o.hasClass("icon-chevron-down")?(o.replaceClass("icon-chevron-down","icon-chevron-right"),s.next().addClass("hidden")):(o.replaceClass("icon-chevron-right","icon-chevron-down"),s.next().removeClass("hidden")),l=s.one(".foldername"),h=c(o.hasClass("icon-chevron-down")?strings.str_nav_left_subfolders_expanded_attr:strings.str_nav_left_subfolders_collapsed_attr,{name:n.escapeHtml(l&&l.getHTML())}),s.one(".listnav-folder-toggle").set("title",h),s.one(".listnav-folder-toggle").set("aria-label",h)):s.hasClass("openable")&&(u=!0,I(),o=s.one(".listnav-toggle"),f==37?s.removeClass("nav-open"):f==39?s.addClass("nav-open"):(s.toggleClass("nav-open"),a=s.hasClass("nav-open"),r.setAttribute("aria-selected",a),r.set("title",a?strings.str_nav_left_folders_expanded_attr:strings.str_nav_left_folders_collapsed_attr))),u&&t.halt()},P=function(e){var t=n.getDataAction(e);this.handleFolderActions({dataAction:t.action,target:e.target})},H=function(t){var r=t.currentTarget,i=r.one("input.trash"),s;if(r.hasClass("icon-small-delete")||i)t.halt(),e.UA.webkit&&t.target.focus(),s=n.getDataAction(t),this.handleFolderActions({dataAction:s.action,target:t.target}),S(t.currentTarget.get("id"),"btn","sysFldCk")},B=function(t){function p(){var e=g.all(".inbox-sub"),t=i.get("neo.pref.mboxesState")===1?0:1,n;e&&e.each(function(e){e.toggleClass("hidden")});if(n=g.one("#"+(t?"hide":"show")+"-accts"))n.set("tabIndex",0),n.focus();NeoConfig.expandEA=t,i.set("neo.pref.mboxesState",t)}var n=t.currentTarget,r=t.target,o,u,a,f,l,c,h;e.fire("ds:folder:system:switch",n);if(t.target.hasClass("clicker")){n.hasClass("open")?n.removeClass("open"):n.addClass("open");return}r.get("nodeName")!=="INPUT"&&!r.hasClass("trash")&&!r.hasClass("check-mail")&&S(t.currentTarget.get("id"),"folder","sysFldCk"),n.hasClass("in")||n.hasClass("inbox-sub")?(h=r.getAttribute("data-action"),h==="show-accounts"?(t.halt(),p()):r.hasClass("check-mail")||(o=E.trim(r.getAttribute("data-mboxid")),l={fid:n.getAttribute("data-fid"),name:s,mailboxId:o&&o.length>0?o:"Inbox",smartFolder:t.smartFolder,forceRefresh:t.smartFolder},e.fire("darlaEvent",{action:NeoConfig.isSSL?"folderview_inbox_ssl":"folderview_inbox"}))):t.target.get("type")!=="button"&&(NeoConfig.imapIn?(u=n.get("className").split(" "),f=b[u[0].trim()],a=strings[w[f]],c=n.getAttribute("data-fid")):(u=n.get("className").split(" "),a=strings[w[n.getAttribute("data-fid")]],f=b[u[0].trim()],c=f||u[0]),c&&(l={fid:c,name:a,mailboxId:null,smartFolder:t.smartFolder,forceRefresh:t.smartFolder})),l&&(l.isTrashBtn=t.target.getAttribute("data-action")==="folder-empty-trash",this.set("fid",l))},j=function(e){var t=e.currentTarget,n=t.getAttribute("data-fid");if(e.target.hasClass("searcher-icon-close")){this.handleFolderActions({dataAction:"folder-search"});return}if(e.target.hasClass("clicker")){t.hasClass("open")?t.removeClass("open"):t.addClass("open");return}S(n,"folder","usr_fldr"),!o&&this.get("active")&&n===e.fid?y.hasClass(l)||this.handleFolderActions({dataAction:"folder-rename",target:e.currentTarget,actionSource:"activeFolder"}):n&&this.set("fid",{fid:n,smartFolder:e.smartFolder,forceRefresh:e.smartFolder})},F=function(n){function o(t){var n=y.menu.getContextTarget(),i;e.fire("mt:click",{action:"cntxt_mnu_fldr_itm_"+t.dataAction}),n&&(t.target=n.ancestor(function(e){return i=e.getAttribute("data-fid")||null,i},!0),i&&(t.actionSource="contextMenu",r.handleFolderActions(t,i)))}var r=this,i=e.mail.ui.ContextButton,s=n.target;n.preventDefault(),y.menu||e.use("common-ui-menu-helper",function(e){var r=e.common.ui.MenuHelper;r.createLoadingMenu
(y,{isContext:!0,xy:[n.clientX,n.clientY]}),e.use("mail-ui-inboxmenu-base",function(e){e.mail.ui.InboxMenu.insert("menu-folder",function(){var u=t("#menu-folder");r.create(y,{menu:u,isContext:!0,xy:[n.clientX,n.clientY],contextTarget:n.target,keys:function(t){t(e.mail.ui.InboxMenu.getValidKeys(u))}},function(){u.on("menuSelected",o),u.on("menu:state",function(e){var t=y.menu.getContextTarget().ancestor("li"),n,r;i&&i.setNodeFolderMenu(t,u),e.state==="show"&&(n=u.one("[data-action=folder-rename]"),r=u.one("[data-action=folder-remove]"),t.hasClass("papa-folder")?(n.addClass("disabled"),r.addClass("disabled")):(n.removeClass("disabled"),r.removeClass("disabled"))),k(t,e.state),e.state==="hide"&&s&&s.focus()})})})})}),e.fire("mt:click",{action:"cntxt_mnu_fldr"})};e.mix(e.mail.FoldersView,{contextClick:C,folderHilite:k,checkMailClick:O,sysFoldersKeyDown:M,usrFoldersKeyDown:_,upDownNavigation:D,newFolderClick:P,emptyFolderOnClick:H,sysFoldersClick:B,usrFoldersClick:j,usrFoldersContextClick:F,updateFolderPref:I,contextClickV3:N,deactivateCustomFolderMenuItems:T})},"1.0.0",{requires:["mail-controller-folders","mail-persist-meta-data"]});
