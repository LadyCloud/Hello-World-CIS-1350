"use strict";YUI.add("tictac-contactdetails-entityRelatedProductsView",function(a){var b=a.Tictac.contactdetails.rollups,c=a.Tictac.contactdetails.utils,d=a.Tictac.base.utils.subs,e=a.Tictac.contactdetails.EntityStats,f=a.Tictac.contactdetails.strings,g=a.Tictac.base.View.extend({initialize:function(a){this.entityInfo=a},onDestroy:function(){c.restoreToolbarAndMsgs(this.node)},createDOMNode:function(){return this.entityInfo.help_page_str=d(f.str_help_page,{entity_name:this.entityInfo.name}),this.entityInfo.customer_service_str=d(f.str_customer_service,{phone:this.entityInfo.phone}),a.Node.create(b.entity_related_products(this.entityInfo))},renderItems:function(c){var d={metaFields:{resultCount:"//ResultCount"},resultListLocator:"Product",resultFields:[{key:"title",locator:"DisplayTitle"},{key:"description",locator:"Description"},{key:"category",locator:"Category"},{key:"seller",locator:"Seller"},{key:"priceStartsFrom",locator:"PriceStartsFrom"},{key:"rating",locator:"Rating"},{key:"numReviews",locator:"NoOfReviews"},{key:"image",locator:"Images/Image[1]"},{key:"url",locator:"URL"}]},f=a.DataSchema.XML.apply(d,a.XML.parse(c)),g={hasRelated:f&&f.results.length>0,related:f&&f.results};g.hasRelated&&(g.related=g.related.slice(0,3),a.Array.each(g.related,function(a){a.rating=Math.round(a.rating)}));var h=b.entity_related_products_items(a.merge(this.entityInfo,g)),i=this.node.one("#related-products");i.append(h),a.each(f.results,function(){e.stat("relatedproductcount")}),e.stat("relatedproduct")},openRelatedProduct:function(a){var b,c=a.currentTarget,d=c.getAttribute("data-url");b=window.open(d,"_blank"),b.focus(),c.hasClass("related-products-title")?e.stat("relatedproductstitle"):c.hasClass("related-products-item-image")&&e.stat("relatedproductsthumbnail")},events:{"click div.related-products-url":"openRelatedProduct"}});a.namespace("Tictac.contactdetails").EntityRelatedProductsView=g},"1.0.0",{requires:["tictac-contactdetails-rollups","tictac-base-view","node","tictac-contactdetails-strings","dataschema","contactdetails-css","event-base","tictac-contactdetails-utils","tictac-base-utils","tictac-contactdetails-entityMapping","tictac-contactdetails-entityContactView","tictac-contactdetails-entityRelatedProductsView"]});"use strict";YUI.add("tictac-contactdetails-entityMainController",function(a){function b(a){return a?d[a]:null}var c,d=a.Tictac.contactdetails.EntityMapping,e=a.Tictac.base.utils,f=e.getVal,g="/mailsearch/v2/search",h=a.Tictac.contactdetails.EntityStats,i=1,j="http://vis.shop.yahoo.com:4080/vishopdd_api/V1/Products?superwow=yes&source=pc&raw_query=amazon.com&ddtype=swow&bucket=VIP077&result_count=20&type=dd&ranking=MLR%3AM&filter=ret:5316&loose_match=hardfilter&debug=true",k="http://vis.shop.yahoo.com:4080/vishopdd_api/V1/Products?superwow=yes&source=pc&raw_query=ebay&ddtype=swow&bucket=VIP077&result_count=20&type=dd&ranking=MLR%3AM&filter=ret:13712&loose_match=hardfilter&debug=true",l="http://vis.shop.yahoo.com:4080/vishopdd_api/V1/Products?locale=en-US&ranking=MLRLATEST&type=VISSRP&show_merchants=1&show_vendors=1&raw_query={{productName}}&start=0&result_count=15&filter=ret%3A11399&loose_match=hardfilter";c={init:function(){var d=this;yui.on("searchSuggestion:start",function(a){if("entity"===a.type){var b=a.type+d.generateSearchId(),c=a.id,e=a.isToQuery,f=e?"(toaddress:"+c+")":"(fromaddress:"+c+")",g={query:{keyword:f,typeTag:"search_entity"},displayQueryInSearchBar:!0,prefilterRefinements:!1,showDDWithSearchResults:!0,searchRequestId:b,addToRecentSearches:!1,searchingContact:c};d._searchId=b,d._dataId=c,d._isToQuery=e,yui.fire("search:input",g)}}),yui.on("tictac:search:complete",function(a){d._hasSearchResult=a&&a.data&&a.data.hits&&a.data.hits.length}),yui.on("global:search:complete",function(e){var f,g,i,m=null,n=d._hasSearchResult,o=d._isToQuery,p=d._dataId,q=d._searchId;if(e&&q&&e.searchRequestId===q){var r=b(p);g=a.one("#dd_search_results_container_top"),i=a.one("#dd_search_results_container"),g.get("children").remove(!0),i.get("children").remove(!0),m=new a.Tictac.contactdetails.EntityContactView(a.merge(r,{parent:g,index:0,searchTerms:p,hasSearchResult:n,isToQuery:o})),f=new a.Tictac.contactdetails.EntityRelatedProductsView(a.merge(r,{parent:i,index:0,searchTerms:p})),m.render(),f.render(),c.fetchData(p,function(b){var d=m.parseItems(b);if(d=d&&d.split(" ")[0],d=d&&encodeURIComponent(d),!NeoConfig.isMailPlus&&a.Tictac.contactdetails.neoConfigHadAds&&0===NeoConfig.targetingOptOut&&"br"!==NeoConfig.intl){var e;e="amazon"===p?j:"ebay"===p?k:l,c.fetchRelatedProducts(e,function(a){f.renderItems(a),h.stat("relatedProductOffered")},function(b){a.log("fetchRelatedProducts failed",b)})}})}})},generateSearchId:function(){return i++===Number.MAX_VALUE&&(i=1),i},fetchData:function(b,c){function d(b,d){var e=a.JSON.parse(d.responseText||d.response);c(e)}function e(){}var f=this,g=f._getEntityQuery(b);g&&a.Tictac.base.mailIO.send(g,{method:"GET",on:{success:d,failure:e}},!0)},fetchRelatedProducts:function(b,c,d){var g="fetchRelatedProducts123";a.Tictac.base.BatchTransport.send({requests:[{id:g,uri:b,method:"GET"}]},{success:function(d,e,h){var i="",j=g,k=h&&h[g]&&h[g].body,l=f(h,"Status.body.failedRequests");l&&l.length>0?(a.each(l,function(a){i+=a.id+" error: "+f(a,"error.code")+" "+f(a,"error.message")+";  "}),a.log("fetchRelatedProducts ","V3 Batch API request "+b+g+" failed -- "+i)):g!==j?a.log("fetchRelatedProducts ","V3 Batch API request "+g+" returned but our currentrequestId is "+j,"info"):k?c(k,j):a.log("fetchRelatedProducts ","V3 Batch API request "+b+g+" failed -- no data returned")},fail:function(a,c){var h="status: "+c.status+" ",i=e.parseJSON(c.responseText);h+="error: "+f(i,"error.code")+" "+f(i,"error.message"),d("V3 Batch API request "+b+" failed --  "+h,g)}})},_getEntityQuery:function(b){var c={flags:{softdelete:0},from:b,tags:"schema:ParcelDelivery"},d=["query="+encodeURIComponent(a.JSON.stringify(c)),"start=0","appid=YahooMailNeo","wssid="+(window.NeoConfig?NeoConfig.wssid:""),"ts="+ +new Date,"foldername=1"];return g+"?"+d.join("&")}},a.Tictac.contactdetails.EntityController=c,c.init()},"1.0.0",{requires:["event-base","dataschema","tictac-base-batch-transport","tictac-base-utils","tictac-base-mail-io","tictac-contactdetails-entityMapping","tictac-contactdetails-entityContactView","io","json-stringify","tictac-contactdetails-entityRelatedProductsView"]});