YUI.add("minty_module_toolbar_fragments_native_ad_group_rollup",function(e){e.namespace("ui.Templates"),e.ui.Templates.minty_module_toolbar_fragments_native_ad_group_rollup={base:'<div id="pagetoolbar" class="{{msgliststate}} threadtoolbar adspanetoolbar"> <button id="btn-delete" class="btn multimsg" aria-label="" title="{{str_delete_conv_attr}}" data-action="closemsg" tabindex="-1"> <i class="icon-delete"></i><span class="icon-text">{{str_delete}}</span> </button> <button id="btn-forward" class="btn onemsg forward" aria-label="" title="{{str_forward}} [{{str_menu_accel_shift_f}}]" data-action="ad-forward" tabindex="-1"> <i class="icon-forward"></i><span class="icon-text">{{str_forward}}</span> </button> <button id="native-ad-save" class="btn onemsg download" aria-label="" title="{{str_save_this_ad_to_inbox}}" data-action="save_ad" tabindex="-1"> <i class="icon-download"></i><span class="icon-text save-ib">{{str_save_ad_to_inbox}}</span> <span class="icon-text saved invisible">{{str_saved_ad_to_inbox}}</span> </button> <button id="btn-closemsg" class="btn btn-absolute btn-close-msg" aria-label="{{str_close}}" title="{{str_close}}" data-action="closemsg" tabindex="-1"> <i></i> </button></div>'}},"1.0.0");
YUI.add("mail-ui-nativeads-read",function(e){var t=function(n){function s(t){var r=this,i="70,27,70+shift,46,83+shift";if(r.rendered)return;var s=e.ui.Templates._shared_module_ads_display,u;r.container=t,u=r.substituteAd(n,s),r.container.append(u),r.container.one(".msg-body").set("innerHTML",n.content),r.setToolbars(),r.attachHandlers(r.container),r.set("charCodes",i),r.rendered=!0,r.on("closeChange",o)}function o(t){var n=this;t.newVal===1&&n.eventsHandler&&e.detach(n.eventsHandler)}function u(t){var n=this,r=n.container.one("#AdlearnMore");r&&(n.eventsHandler=r.on("click",function(){e.fire("util:ymstats",{name:"mb_list_native_ads_learnMore",tags:{bkt:NeoConfig.expBucketId}})}))}function a(e,t){var n=this,i={ad_from:e.header.from.email,ad_subject:e.header.subject,ad_to:e.header.to,ad_date:r.dateFormatter(new Date,strings.str_tog_dateformat_read_noyear_today)};return r.substitute(t.base,i,null,null,strings)}function f(){var t=this,n=e.ui.Templates.minty_module_toolbar_fragments_native_ad_group_rollup,i=r.substitute,s=i(n.base,null,null,null,null,strings),o=t.createToolbar(s);t.set("contentToolbar",o)}function l(t){var n=this,r;return r=new e.mail.ui.ad.Toolbar({template:t}),r.on("itemSelected",n.handleToolbarSelection,n),r}function c(){var t=this,n,r=e.contacts.ui.ContactsView,s,o,u;s=t.tab.prevTabId;if(s){o=i.getTabById(s);if(o&&o.widgetType==="search"){i.switchToTab(o),u=o.elContent.one("#msg-list"),u!==null&&e.UA.safari>0&&(u.addClass("toggle-to-force-repaint"),setTimeout(function(){u.removeClass("toggle-to-force-repaint")},1));return}n=r&&s===r.tab.get("id");if(n){i.switchToTab(r.tab);return}}i.switchToTab(i.tabs[0])}function h(t){var n=this,r=t?t.dataAction||t.currentTarget._node.getAttribute("data-action"):0;switch(r){case"save_ad":e.fire("nativeAd:save");break;case"ad-forward":e.fire("nativeAd:forward");break;case"closemsg":n.handlePaneClose()}}function p(t){var n=this,r=t.keyCode;switch(r){case 70:return e.fire("nativeAd:forward"),!0;case 83:return e.fire("nativeAd:save"),!0;case 27:case 46:case 8:return n.handlePaneClose(),!0;default:}}function d(){var t=this;e.fire("nativeAd:close"),e.fire("util:ymstats",{name:"mb_list_native_ads_closed",tags:{bkt:NeoConfig.expBucketId}}),NeoConfig.multitask&&!NeoConfig.tabs?(t.handleTabSwitch(),NeoConfig.backButtonFull&&e.fire("removePage")):t.set("close",1)}var r=e.common.Utils,i=e.mail.Tabs;this.rendered=!1,t.superclass.constructor.call(this),e.mix(this,{NAME:"NativeAdsRead",render:s,setToolbars:f,createToolbar:l,handleToolbarSelection:h,handleTabSwitch:c,handlePaneClose:d,onKeyDown:p,substituteAd:a,attachHandlers:u,detachHandlers:o},!0)};e.extend(t,e.mail.ui.BaseWidget),e.namespace("Y.mail.ui"),e.mail.ui.NativeAdsRead=t},"1.0.0",{requires:["mail-ui-basewidget","_shared_module_ads_display","common-ui-toolbar-base","mail-ui-ad-toolbar","minty_module_toolbar_fragments_native_ad_group_rollup"]});
YUI.add("mail-ui-mb-list-native-view",function(e){var t=e.common.Utils,n=e.mail.ui.mail,r=e.common.Utils.settings,i,s,o,u,a,f;e.mail.ui.mbListNativeView=e.mail.ui.mbListView.extend({template:e.ui.Templates.minty_module_list_view_ad_mb_native,nativeTemplates:["minty_module_list_view_ad_buckets_native_email_ad_match","minty_module_list_view_ad_buckets_native_email_ad_dish","minty_module_list_view_ad_buckets_native_email_ad_zulily","minty_module_list_view_ad_buckets_native_email_ad_uber"],statName:"mbListNativeView",_postRender:function(){this.container.removeClass("hidden"),this._bindUiEvents(this.container,this),this._detach(),this._bindAdClick(this.container)},_preRender:function(){this.fbView&&(this.fbView.end(),this.fbView=null),this.fbActive=!1},_adEventHandler:function(){var e=this;!e.stopAdRot&&(!NeoConfig.vertPane||t.features.enabled("mbListNativeViewPrvwPnLN1"))&&(this.model.execute(),this.stat("renderAttempt"))},_bindAdClick:function(e){e!==null&&(this.readHandler=e.delegate("click",function(e){this._clickHandlers(e)},".mb-native-ad",this))},_fireClickBeacon:function(){var e=new Image,t;a.model.currentAds[0]?t=a.model.currentAds[0].click_url:t=NeoConfig.moneyball.click_url,e.src=t},_getAdHtml:function(n){var r=n[0];return t.features.enabled("mbListNativeView")&&(t.features.enabled("mbListNativeViewPrvwPnLN1")&&NeoConfig.previewPanePref===1?this.template=e.ui.Templates.minty_module_list_view_ad_mb_native_vert_prev:t.features.enabled("mbListNativeViewLN4")?this.template=e.ui.Templates.minty_module_list_view_ad_mb_native_img:this.template=e.ui.Templates.minty_module_list_view_ad_mb_native),this.substituteWithConditionals(this.template,r)},_enableToolbar:function(e){e.addClass("mbAdSelected"),e.hasClass("hasnomsg")&&e.replaceClass("hasnomsg","hasonemsg")},_disableToolbar:function(t){var n=e.mail.Tabs.getActiveTab().get("widget").type;if(n==="convlist"||n==="messagelist")t.removeClass("mbAdSelected"),t.hasClass("hasonemsg")&&(t.hasClass("msgChecked")||t.replaceClass("hasonemsg","hasnomsg"))},_removeAd:function(){var e=this,n=e.container;n.remove(),u.removeClass("mbAdSelected"),u.hasClass("hasonemsg")&&(u.hasClass("msgChecked")||u.replaceClass("hasonemsg","hasnomsg")),t.features.enabled("mbAdFeedback")||(NeoGV.mbToggle=!0)},_startFeedback:function(){var n=this,r=n.model.currentAds[0]?n.model.currentAds[0].feedback_beacon:NeoConfig.moneyball.feedback_beacon;if(!t.features.enabled("mbAdFeedback")||!r){n._removeAd();return}if(n.fbActive)return;n.fbActive=!0,e.fire("stopAdRotation"),e.use("minty_module_list_view_ad_mb_native_feedback","mail-ui-mb-feedback-view",function(e){try{var t={template:e.ui.Templates.minty_module_list_view_ad_mb_native_feedback,fb:NeoConfig.vertPane?"vertical":"horizontal",ack:"feedback_ack"},r={done:"mb-done-button",option:"mb-option",select:"mb-select",comment:"mb-comment"},i={end:n._endFeedback};e.fire("util:ymstats",{name:"mb_list_native_ads_feedback_attempt",tags:{bkt:NeoConfig.expBucketId}}),n.fbView||(n.fbView=new e.mail.ui.mbFeedbackView(n)),n.fbView.start(t,r,i)||(n._enableAdRotation(),e.fire("util:ymstats",{name:"mb_list_native_ads_feedback_failure",tags:{status:"failure",bkt:NeoConfig.expBucketId}})),n._removeAd()}catch(s){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-moneyball-mbListNativeView:1",s,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-moneyball-mbListNativeView:1"),n._enableAdRotation(),e.fire("util:ymstats",{name:"mb_list_native_ads_feedback_failure",tags:{status:"failure",bkt:NeoConfig.expBucketId}})}})},_endFeedback:function(t,n){var r=t;r._enableAdRotation(),r.fbActive=!1,n||e.fire("mbEvent:rotate")},_bindEvents:function(){var n=this,r;e.mail.ui.mbListView.prototype._bindEvents.call(this),this._bindUiEvents(this.container,this),this._bindAdClick(this.container),e.on("nativeAd:select",function(){this._selectNativeAd()},this),e.on("nativeAd:unselect",function(){this._unselectNativeAd()},this),e.on("nativeAd:save",function(){var t=this._getNativeAdMailTemplate(!1);e.fire("util:ymstats",{name:"mb_list_native_ads_save_to_inbox_clicked",tags:{status:"clicked",bkt:NeoConfig.expBucketId}}),t.then(function(e){n._emailAd(f,e,!1,!0)},function(){})},this),e.on("nativeAd:forward",function(){e.fire("util:ymstats",{name:"mb_list_native_forward_clicked",tags:{bkt:NeoConfig.expBucketId}}),this._forwardNativeAd()},this),e.on("stopAdRotation",function(){this._stopAdRotation()},this),e.on("nativeAd:close",function(){n.frwdClicked=!1,n.isPrevPaneAdsPane=!0}),t.features.enabled("mbListNativeView")&&e.before("tabChange",function(){var t=e.mail.Tabs.getActiveTab().widget;if(t.type==="adspane")n.isPrevPaneAdsPane=!0;else if(t.type!=="adspane"&&!n.frwdClicked||t.fid!==n.srcFid||t.type!=="convlist"&&t.type!=="messagelist")n._enableAdRotation(),n.isPrevPaneAdsPane=!1}),e.after("tabChange",function(){if(t.features.enabled("mbListNativeView")){var r=e.mail.Tabs.getActiveTab().widget;n.isPrevPaneAdsPane&&r.fid===n.srcFid&&(r.type==="convlist"||r.type==="messagelist")&&(n._enableAdRotation(),n.isPrevPaneAdsPane=!1)}}),r=e.mail.ui.Workspace.getMessageList(),r&&r.on("fidChange",function(){n._enableAdRotation()})},_clickHandlers:function(e){var t=this,n;n=t._getNativeAdMailTemplate(!0),n.then(function(n){t._handleClickDataAction(n,e)},function(){})},_getNativeAdMailTemplate:function(n){var r=t.settings.value("mbNativeTestCrtvMap"),i=e.ui.Templates.minty_module_list_view_ad_buckets_mb_right_rail_save_ad,s,o,u=this,a;return new Promise(function(t){n?s=u.model.currentAds[0]?u.model.currentAds[0].creative_id:NeoConfig.moneyball.creative_id:s=f.creative_id,r.hasOwnProperty(s)?(a="minty_module_list_view_ad_buckets_native_email_ad_"+r[s],e.use(a,function(e){o=e.ui.Templates[a]||i,t(o)})):t(i)})},_forwardNativeAd:function(){var n=this,r=e.ui.Templates.minty_module_ads_native_ad_forward,i=n._getNativeAdMailTemplate(!1);i.then(function(i){n.frwdClicked=!0,e.fire("newMessage",{cbfn:function(e){var n={}
,s;return s=t.substitute(r.base,null,null,null,strings),n.subject=f.ad_headline,s+=t.substitute(i.base,f,null,null,strings),e.setHeader(n),e.setBody(null,s),!0}})},function(){})},_handleClicks:function(e,t){a.keyBounceTimer||(a._handleClickDataAction(e,t),a.keyBounceTimer=setTimeout(function(){a.keyBounceTimer=null},1500))},_selectNativeAd:function(){var e=this.container.one(".mb-checkbox");e.get("checked")?this._unselectNativeAd():(i=this.container.ancestor("#shellinner"),u=i.one("#pagetoolbar"),e.set("checked","true"),this._enableToolbar(u))},_unselectNativeAd:function(){var e=this.container.one(".mb-checkbox");i=this.container.ancestor("#shellinner"),u=i.one("#pagetoolbar"),e.set("checked",""),this._disableToolbar(u)},_handleClickDataAction:function(t,n){var r=n.target.getAttribute("data-action"),i,s,u;f=this.model.currentAds[0]||NeoConfig.moneyball;switch(r){case"check":n.stopPropagation(),i=n.currentTarget.ancestor("#shellinner"),s=i.one("#pagetoolbar"),u=n.currentTarget.one(".mb-checkbox"),n.target.hasClass("mb-checkbox")?u.get("checked")?this._enableToolbar(s):this._disableToolbar(s):u.get("checked")?(u.set("checked",""),this._disableToolbar(s)):(u.set("checked","true"),this._enableToolbar(s));break;case"ad-srch":n.preventDefault(),this.model.currentAds[0]?e.fire("fireSearch",this.model.currentAds[0].ad_source):e.fire("fireSearch",NeoConfig.moneyball.ad_source),e.fire("util:ymstats",{name:"mb_list_native_ads_search_clicked",tags:{bkt:NeoConfig.expBucketId}});break;case"ad-delete":n.preventDefault(),i=this.container.ancestor("#shellinner"),o=i.one("#slot_MB"),i.one("#slot_MB")&&this._startFeedback(),e.fire("util:ymstats",{name:"mb_list_native_ads_delete_clicked",tags:{bkt:NeoConfig.expBucketId}});break;case"ad-star":n.preventDefault(),this._fireClickBeacon(),this._emailAd(this.model.currentAds[0]||NeoConfig.moneyball,t,!0,!1),e.fire("util:ymstats",{name:"mb_list_native_ads_star_clicked",tags:{bkt:NeoConfig.expBucketId}});break;case"mb-redirect":n.preventDefault(),window.open(strings.str_cfg_url_about_adchoices,"_blank");break;default:n.preventDefault(),this._fireClickBeacon(),this._openAd(this.model.currentAds[0]||NeoConfig.moneyball,t),e.fire("util:ymstats",{name:"mb_list_native_ads_open_clicked",tags:{bkt:NeoConfig.expBucketId}})}},_openAd:function(n,i){if(n){e.fire("stopAdRotation");var s,o=t.settings.value("mbAssetMap")||{},u,f;t.features.enabled("mbAssetExchange")&&o.hasOwnProperty(n.creative_id)&&(u=o[n.creative_id],n.hq_image=u.imgUrl||n.ad_img,n.click_url=u.clickUrl||n.click_url),s=t.substitute(i.base,n,null,null,strings),e.use("mail-ui-nativeads-read",function(e){var t={subject:n.ad_headline,from:{email:r.value("mbNativeSender"),name:n.ad_source},to:"me"},i={fid:"Inbox",tabKey:"mid",header:t,content:s},o=new e.mail.ui.NativeAdsRead(i),u={p_label:t.from.name,s_label:t.subject,s_labelDir:"",widget:o,widgetType:"adspane",isRemovable:!0,forcePane:0},l;o.type="adspane",o.set("title",u.s_label),f=e.mail.ui.Workspace.addContentWidget(u),l=o.container,l.delegate("hover",e.bind(a._sponsoredOver,null,"readpane"),a._sponsoredOut,".mb-sponsored-open")})}},_emailAd:function(i,s,o,u){if(i){var f={subject:i.ad_headline,from:{email:r.value("mbNativeSender"),name:i.ad_source},to:null,cc:[],bcc:[],replyto:{email:r.value("mbNativeSender"),name:i.ad_source}},l=t.substitute(s.base,i,null,null,strings),c=i.ad_summary||"",h;h=n.saveEmailToInbox(f,l,c,u),h.then(function(n){a._changeTbState(),o&&a._starNativeAd(n),!t.features.enabled("mbListNativeViewSaveV3")&&u&&a._setEmailRead(n)},function(){e.fire("util:ymstats",{name:"mb_list_native_ads_save_to_inbox_failure",tags:{status:"failure",bkt:NeoConfig.expBucketId}})})}},_changeTbState:function(){var t=e.one(".adspanetoolbar"),n,r;t&&(n=t.one(".save-ib"),r=t.one(".saved"),n&&(t.addClass("adSaved"),n.addClass("hidden"),r.removeClass("invisible")))},_starNativeAd:function(n){var r=e.ui.Templates._shared_module_offscreen_bin_notification_native_ad_star,i={fid:"Inbox",destinationFid:"Inbox",mid:[n],setFlags:{flagged:1}},s;s=new Promise(function(t,n){e.mail.Controller.Messages.flag(i,function(e,r,i){i==="success"?t():n()})}),s.then(function(){var i=t.substitute(r.base,null,null,null,strings);e.common.ui.NotificationV2.notify(i,{type:"info",close:"true",duration:5e3}),e.mail.FoldersView.checkMail()},function(){e.fire("util:ymstats",{name:"mb_list_native_ads_star_failure",tags:{status:"failure",bkt:NeoConfig.expBucketId}})})},_setEmailRead:function(t){var n={fid:"Inbox",mid:[t],setFlags:{read:1}};e.mail.Controller.Messages.flag(n,function(t,n,r){r!=="success"&&e.fire("util:ymstats",{name:"mb_list_native_ads_mark_as_read_failure",tags:{status:"failure",bkt:NeoConfig.expBucketId}})})},_detach:function(){this.readHandler&&this.readHandler.detach()},_bindUiEvents:function(t){var n=e.mail.Tabs.getActiveTab().get("widget").type;if(!t)return;(n==="convlist"||n==="messagelist")&&!NeoGV.mbToggle&&(i=t.ancestor("#shellinner"),s=i.one("#pagetoolbar #btn-delete"),o=i.one("#slot_MB"),u=i.one("#pagetoolbar"),a=this,a.srcFid="",s.on("click",function(t){var n=i.one(".mb-checkbox");o=i.one("#slot_MB"),i.one("#slot_MB")&&n.get("checked")&&(t.halt(),a._startFeedback()),e.fire("util:ymstats",{name:"mb_list_native_ads_delete_clicked",tags:{bkt:NeoConfig.expBucketId}})}),this.lastContainer!==t&&(this.lastContainer&&this.lastContainer.detach("click"),this.sponsoredHoverHandler=t.delegate("hover",e.bind(a._sponsoredOver,null,"msgList"),this._sponsoredOut,".mb-native-info"),this.starHoverHandler=t.delegate("hover",this._starOver,this._starOut,".flag"),this.lastContainer=t))},_sponsoredOver:function(n,r){var i=e.ui.Templates.minty_module_offscreen_bin_native_ad_callout,s=r.currentTarget;r.preventDefault(),e.fire("onboard:tip",{node:s,template:t.ezSub(i.base,{},i),fn:function(){e.fire("onboard:tipclose")},offset:[s.get("offsetWidth")-310,35]})},_sponsoredOut:function(){e.fire("onboard:tipclose")},_starOver:function(n){n.preventDefault();var r=e.ui.Templates.minty_module_offscreen_bin_native_ad_star
,i=this;e.fire("onboard:tip",{node:i,template:t.ezSub(r.base,{},r),offset:[-83,-36]}),i.on("click",function(){e.fire("onboard:tipclose")})},_starOut:function(){e.fire("onboard:tipclose")},_stopAdRotation:function(){this.stopAdRot=!0,this.srcFid=e.mail.Tabs.getActiveTab().widget.fid},_enableAdRotation:function(){this.stopAdRot=!1}})},"1.0.0",{requires:["mail-ui-mb-list-view","minty_module_list_view_ad_mb_native","minty_module_ads_native_ad_forward","minty_module_list_view_ad_buckets_mb_right_rail_save_ad","minty_module_offscreen_bin_native_ad_callout","minty_module_offscreen_bin_native_ad_star","mail-ui-onboarding","mail-common-utils-features","_shared_module_offscreen_bin_notification_native_ad_star","mail-ui-mail-helper","common-ui-tabs-base","mail-ui-nativeads-read"]});
YUI.add("mail-ui-mb-controller",function(C){var B=function(){},A=C.common.Utils;B.prototype={init:function(){if(this.isMoneyballEnabled()){this._initViews();}return this;},_initViews:function(){if(NeoConfig.mbSectionId&&(!NeoConfig.AffiliateAds||(NeoConfig.AffiliateAds&&!this.isAffiliateDaypartingEligible()||A.features.enabled("mbBackfill")))){if(A.features.enabled("mbListViewWithoutImage")){new C.mail.ui.mbListView().init();}else{if(A.features.enabled("mbListNativeView")){new C.mail.ui.mbListNativeView().init();}else{new C.mail.ui.mbListImgView().init();}}}if(NeoConfig.mbSearchSectionId){new C.mail.ui.mbSearchListView().init();}if(NeoConfig.enableTL1Fallback&&NeoConfig.mbLeftRailSectionId&&NeoConfig.expBucketId!=="CMUSGRMBI04"&&NeoConfig.expBucketId!=="CMUSGRMBI05"){C.use("mail-ui-mb-rec-view",function(D){new D.mail.ui.mbRecView().init();});}if(NeoConfig.mbBackfillRightRail&&NeoConfig.mbRightRailSectionId){if(/^CMUSGRRRC\d{2}$/.test(NeoConfig.expBucketId)){C.use("mail-ui-mb-right-rail-carousel-view",function(D){new D.mail.ui.mbRightRailCarouselView().init();});}else{C.use("mail-ui-mb-right-rail-view",function(D){new D.mail.ui.mbRightRailView().init();});}}if(NeoConfig.mbOnMsgRead&&NeoConfig.mbMsgReadSectionId){C.use("mail-ui-mb-msg-read-view",function(D){new D.mail.ui.mbMsgReadView().init();});}},isMoneyballEnabled:function(){return(NeoConfig.moneyballEnabled&&NeoConfig.hasAds);},isAffiliateDaypartingEligible:function(){var D=new Date().getHours();if(!A.features.enabled("affiliateAdsDayParting")||(A.features.enabled("affiliateAdsDayParting")&&A.settings.value("affiliate_dayparting_hours").indexOf(D)!==-1)){return true;}return false;}};C.namespace("mail.ui");C.mail.ui.mbController=B;},"1.0.0",{requires:["mail-ui-mb-list-view","mail-ui-mb-search-list-view","mail-ui-mb-list-img-view","mail-common-utils-features","mail-ui-mb-list-native-view"]});YUI.add("mail-ui-log",function(F){var B=15*1000,G=F.common.Utils,T=G.ymmastats,L=200,P=1000;function J(Y){Y=Y||{};this._sessionLogger=F.comms.log4js.getLogger("_sessionLogger",1,"ajax",{jsonReq:true});this._logger=[];this._logTimer={};this.FLUSH_LIMIT=Y.FLUSH_LIMIT||L;this.LOG_LIMIT=Y.LOG_LIMIT||P;this.events=Y.events||{},this.tid=NeoConfig.loginId+G.rand(1000000);this._lastFlushed=0;this._index=0;}function D(){var Y=this;F.each(Y.events,function(b,c){F.on(c,function(){try{b.apply(Y,arguments);}catch(d){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-mail-debug-maillog:1",d,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-debug-maillog:1");Y.add({m:"Logger Exception"},1,"JSException");}});});}function N(Y){var b=new Date();if(this._logger.length===this.LOG_LIMIT){this._logger.shift();this._lastFlushed=this._lastFlushed-1>0?this._lastFlushed-1:0;}this._logger.push(F.JSON.stringify({t:b.toTimeString().substr(0,8)+":"+b.getMilliseconds(),d:Y}));}function O(Y,b){var c=this;c._logTimer[Y.key]&&c._logTimer[Y.key].cancel();c._logTimer[Y.key]=F.later(Y.time||B,Y.context,function(){var d=false;if(Y.onTimeout){d=!Y.onTimeout.apply(Y.context||null);}if(!d){c.add(Y.data);T.stat("TimeoutError","reason=>"+Y.key.split(":")[0]);c.flush(Y.key);}b&&b.detach();});}function a(){this._logger=[];this._lastFlushed=0;this._index=0;}function A(){var Y=window.open("","","width=650,height=700,resizable"),b=Y.document;b.open();b.write("<html>"+"<body>"+'<div id = "reason"></div>'+'<div id = "extraInfo"></div>'+'<div id = "logs"></div>'+"</body>"+"</html>");return Y;}function V(){var Y=window.open("","","width=650,height=700,resizable"),b=Y.document;b.open();b.write("<html>"+"<body>"+'<textarea id = "hardetails" rows="50" cols="80"></textarea>'+"</body>"+"</html>");return Y;}function M(){var Y=window.open("","","width=1000,height=700,resizable"),b=Y.document;b.open();b.write("<html><head>"+"<script>"+"function createWF(res) {"+'var _yr= "https://s.yimg.com/zz/combo?os/mit/media/p/content/'+NeoConfig.yaft_report_js_version+'",_yrs = document.createElement("script");'+'_yrs.src = _yr; _yrs.type ="text/javascript";'+"_yrs.onload = function(){ YAFT_REPORT.drawWaterfall(res); };"+"document.body.appendChild(_yrs);"+"}"+"<\/script>"+"</head><body></body></html>");return Y;}function I(){var b=this._prepareLog("Console Print"),f,c="getElementById",e,Y="";if(!(this.logW&&this.logW.opener&&!this.logW.opener.closed)){this.logW=this._createUI();}f=this.logW.document;f[c]("reason").innerHTML=b.reason;f[c]("extraInfo").innerHTML=F.JSON.stringify(b.info);for(e=0;e<b.logs.length;e++){Y+="<div>"+b.logs[e]+"</div>";}f[c]("logs").innerHTML=Y;}function X(){var b=this,Y={tid:b.tid,yid:NeoConfig.loginId,browser:NeoConfig.browser,build:NeoConfig.buildNumber,url:location.toString(),hasConv:NeoConfig.hasConvView,mailplus:!NeoConfig.hasAds?"1":"0",bucket:NeoConfig.expBucketId};return Y;}function R(Y){if(NeoConfig.log_error_yapache){var b=this;Y=Y||"MailLog";b._sessionLogger.log(F.JSON.stringify(b._prepareLog(Y,b.FLUSH_LIMIT)));b._lastFlushed=b._logger.length;}}function C(Y){var c=this;var b=F.on(Y.event,function(){if(Y.condition.apply(Y.context||null,arguments)){c._logTimer[Y.key]&&c._logTimer[Y.key].cancel();b.detach();}});c._addTimer(Y,b);}function E(f,b){var h=this,d,c=[],e,g,Y=h._logger.length;if(!b){g=0;}else{if(Y-h._lastFlushed<b){g=h._lastFlushed;}else{g=Y-b;}if(g<0){g=0;}}for(d=g;d<Y;d++){c.push(this._logger[d]);}e={reason:f,info:this._getExtraLogInfo(),logs:c,index:h._index};h._index=h._index+c.length;return e;}function S(){if(!(this.waterFallW&&this.waterFallW.opener&&!this.waterFallW.opener.closed)){this.waterFallW=M();}this.waterFallW.createWF(YAFT.data);}function H(){if(!(this.harW&&this.harW.opener&&!this.harW.opener.closed)){this.harW=V();}this.harW.document.getElementById("hardetails").value=F.JSON.stringify(YAFT.data.har);}function Z(){var Y=NeoConfig.launchPVID.replace(/[^a-zA-Z]/g,""),d=Y.length,c,b="";for(c=8;c<d;c++){if(c%2==0){b+=Y.charAt(c);}}return b;}function Q(Y){YAFT.init({modules:["shellnavigation-inner","storm-listnav","shellcontent","nav","yucs-top-bar","yucsHead","slot_"],modulesExclude:["yucs-",(NeoConfig.ccAb&&Z())||"slot_MB"],canShowVisualReport:0,generateHAR:true,maxWaitTime:200},function(c,b){if(!b){YAFT.data=c;Y();}});}function K(c){if(window.YAFT!==undefined&&window.YAFT_REPORT!==undefined&&window.YAFT.data!==undefined){c();}else{var b="https://s.yimg.com/zz/combo?os/mit/media/p/content/"+NeoConfig.yaft_js_version+"&os/mit/media/p/content/"+NeoConfig.yaft_report_js_version,Y=document.createElement("script");Y.src=b;Y.type="text/javascript";Y.onload=function(){Q(c);};document.body.appendChild(Y);}}function W(){K(S);}function U(){K(H);}F.mix(J.prototype,{flush:R,print:I,printWaterfall:W,printHAR:U,bindEvents:D,add:N,addFlow:C,reset:a,_createUI:A,_addTimer:O,_getExtraLogInfo:X,_prepareLog:E});F.namespace("mail.ui").MailLog=J;},"1.0.0",{requires:["ymma-stats","comms-log4js","common-utils"]});YUI.add("mail-ui-log-events",function(C){var M=C.mail.ui.MailLog;function V(b,Y,a){this.add(b);if(Y&&a){this.flush(a);}}function S(){this.print();}function B(Y){Y&&Y(this._prepareLog());}function W(b,Y,a){this.reset();V.call(this,b,Y,a);}function L(b,Y){var a=[];C.each(Y,function(c){a.push(c.mid);});this.add({m:"Load Message Cards Start",cid:b.cid,fid:b.fid,mids:a.join(", ")});}function H(a){var b=this,Y;if(!a){return;}Y={m:"Mail open",fid:a.fid,subject:a.message.subject};if(a.message.cid){Y.cid=a.message.cid;}else{Y.mid=a.message.mid;}b.add(Y);if(NeoConfig.hasConv&&a.message.cid!==""){b.addFlow({event:"MessagePane:rendered",key:"mailOpenFail:"+Y.cid,condition:function(c,d){b.add({m:"MessagePane rendered",fid:d.fid,subject:d.subject,cid:d.cid});return d.cid===Y.cid;},data:{m:"TimeoutError: Mail open failed for "+Y.cid+":"+Y.subject}});}}function O(a){var b=this,Y=a.mid;b.add({m:"Expand Click Start",mid:a.mid});b.addFlow({event:"MessagePane:messageExpandDone",key:"msgExpandFail"+Y,time:5000,condition:function(c){return Y===c.mid;},data:{m:"TimeoutError: Expand message failed"}});}function Q(a){var Y=[];C.each(a,function(b){Y.push(b.mid);});this.add({m:"Load Message Success Start",mids:Y.join(", ")});}function G(a){var Y=[];C.each(a,function(b){Y.push(b.mid);});this.add({m:"Message Controller getMultipleMessages",mids:Y.join(", ")});}function I(a){var Y=[];C.each(a,function(b){Y.push(b.mid);});this.add({m:"Message Controller getMultipleMessagesSuccess",mids:Y.join(", ")});}function K(a,Y){this.add({m:"Set pending request variable",pending:a,reason:Y});if(a===1){this.addFlow({event:"BaseController:pending",key:"pendingReq",time:31*1000,condition:function(b){return b?false:true;},data:{m:"TimeoutError: Pending is still set to 1 after 31 seconds"}});}}function N(c,d,b){var e=[],Y=[],a;for(a=0;a<c.length;a++){e.push(c[a].method);}if(d){for(a=0;a<b.length;a++){if(b[a].method){Y.push(b[a].method);}}this.add({m:"Not executing batch request",methods:e.join(", "),waitingMethods:Y});}else{this.add({m:"Executing batch request",methods:e.join(", ")});}}function Z(Y,d){var c=this,b=Y.cid,a;if(Y.totalUnread!==d.totalUnread&&(Y.totalUnread===0||d.totalUnread===0)){if(Y.totalUnread===0){c.add({m:"Conversation changing state from read to unread in ConvStore",cid:b});a=false;}else{if(d.totalUnread===0){c.add({m:"Conversation changing state from unread to read in ConvStore",cid:b});a=true;}}c.addFlow({event:"MessagePane:markConvRead",key:"markConvReadInPane:"+b,condition:function(f,e){c.add({m:"Conversation getting marked as "+(e?"Read":"Unread")+" in the ConvPane UI",cid:f.cid});return f.cid===b&&e===a;},onTimeout:function(){var e=C.mail.model.ConvStore.Conversations.getPermCidPart,h=e(b),f,i,g=C.mail.Tabs.iterateTabs(function(j){if(j.widgetType==="convlist"||j.widgetType==="convpane"){if(j.widget&&j.widget.msgPane&&j.widget.msgPane.message){f=j.widget.msgPane.message.cid;i=e(f);if(b===f||b===i||h===f||h===i){return true;}}}});return g?true:false;},time:1000,data:{m:"TimeoutError: Conversation couldn't get marked as "+(a?"Read":"Unread")+" in the ConvPane UI",cid:b}});c.addFlow({event:"listview:itemUpdate",key:"markConvReadInList:"+b,condition:function(f,e){var g=f.one(".list-view-item").hasClass("unread")?false:true;c.add({m:"Conversation getting marked as "+(g?"read":"unread")+" in ConvList UI",cid:b});return e.cid===b&&g===a;},time:1000,data:{m:"TimeoutError: Conversation couldn't get marked as "+(a?"Read":"Unread")+" in the ConvList UI",cid:b}});}}function A(c,d,Y){if(Y.indexOf("appid=YahooMailNeo")>-1&&Y.indexOf("SetMetaData")===-1){var a=c.request.postdata,b;if(Y.indexOf("SendMessage")>-1||Y.indexOf("SaveMessage")>-1||Y.indexOf("BatchExecute")>-1&&a.indexOf("SaveMessage")>-1||Y.indexOf("BatchExecute")>-1&&a.indexOf("SendMessage")>-1){a=a.replace(/"message":{.*}/,'"message":{<filtered>},');}b={m:"Request Sent",url:Y,post:a};if(C.UA.chrome>0){b.online=navigator.onLine;}this.add(b);}}function U(d,b){var c=this,Y,a;a=F(d);Y={m:"Initiating delete action",fid:b};Y[NeoConfig.hasConv?"cids":"mids"]=a.join(", ");this.add(Y);if(NeoConfig.hasConv){c.addFlow({event:"convops:movecbk",key:"removeMailFail:"+a[0],condition:function(e){a=a.sort();e=e.sort();return(a.join(",")===e.join(","));},time:30000,data:{m:"TimeoutError: Mail couldn't be deleted",ids:a.join(", ")}});}}function E(c,a){var Y,b=[];C.each(a,function(d){b.push(P(c[d]));});Y={m:"Removing mails from listmodel"};Y[NeoConfig.hasConv?"cids":"mids"]=b.join(", ");this.add(Y);}function R(Y){this.add({m:"Finished syncing listview",syncReason:Y});}function T(b,a){var c=P(a),Y;Y={m:"Updating single item in the list",subject:a.subject};Y[NeoConfig.hasConv?"cid":"mid"]=c;this.add(Y);}function F(a){var Y=[];C.each(a,function(b){Y.push(P(b));});return Y;}function P(Y){return NeoConfig.hasConv?Y.cid:Y.mid;}function J(){this.printWaterfall();}function D(){this.printHAR();}var X=new M({events:{"MailLog":V,"MailLogClean":W,"printLog":S,"extractLogs":B,"printWaterfall":J,"printHAR":D,"MessagePane:inception":H,"MessagePane:expandClick":O,"MessagePane:loadMessageCardsStart":L,"MessagePane:loadMessageSuccessStart":Q,"MessageController:getMultipleMessages":G,"MessageController:getMultipleMessagesSuccess":I,"BaseController:pending":K,"BaseController:execute":N,"ConvStore:calcConvSummary":Z,"net:start":A,"mailEvents:removeMails":U,"listmodel:remove":E,"listview:sync":R,"listview:itemUpdate":T}});X.bindEvents();},"1.0.0",{requires:["mail-ui-log"]});/*
YUI 3.16.0 (build 3.16.0-ym16)
Copyright 2015 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("jsonp",function(e,t){function r(){this._init.apply(this,arguments)}var n=e.Lang.isFunction;r.prototype={_init:function(t,r){this.url=t,this._requests={},this._timeouts={},r=n(r)?{on:{success:r}}:r||{};var i=r.on||{};i.success||(i.success=this._defaultCallback(t,r)),this._config=e.merge({context:this,args:[],format:this._format,allowCache:!1},r,{on:i})},_defaultCallback:function(){},send:function(){function u(e,r){return n(e)?function(n){var o=!0,u="_requests";r?(++t._timeouts[s],--t._requests[s]):(t._requests[s]||(o=!1,u="_timeouts"),--t[u][s]),!t._requests[s]&&!t._timeouts[s]&&delete YUI.Env.JSONP[s],o&&e.apply(i.context,[n].concat(i.args))}:null}var t=this,r=e.Array(arguments,0,!0),i=t._config,s=t._proxy||e.guid(),o;return i.allowCache&&(t._proxy=s),t._requests[s]===undefined&&(t._requests[s]=0),t._timeouts[s]===undefined&&(t._timeouts[s]=0),t._requests[s]++,r.unshift(t.url,"YUI.Env.JSONP."+s),o=i.format.apply(t,r),i.on.success?(YUI.Env.JSONP[s]=u(i.on.success),e.Get.js(o,{onFailure:u(i.on.failure),onTimeout:u(i.on.timeout,!0),timeout:i.timeout,charset:i.charset,attributes:i.attributes,async:i.async}).execute(),t):t},_format:function(e,t){return e.replace(/\{callback\}/,t)}},e.JSONPRequest=r,e.jsonp=function(t,n){var r=new e.JSONPRequest(t,n);return r.send.apply(r,e.Array(arguments,2,!0))},YUI.Env.JSONP||(YUI.Env.JSONP={})},"3.16.0",{requires:["get","oop"]});
/*
YUI 3.16.0 (build 3.16.0-ym16)
Copyright 2015 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("jsonp-url",function(e,t){var n=e.JSONPRequest,r=e.Object.getValue,i=function(){};e.mix(n.prototype,{_pattern:/\bcallback=(.*?)(?=&|$)/i,_template:"callback={callback}",_defaultCallback:function(t){var n=t.match(this._pattern),s=[],o=0,u,a,f;if(n){u=n[1].replace(/\[(['"])(.*?)\1\]/g,function(e,t,n){return s[o]=n,".@"+o++}).replace(/\[(\d+)\]/g,function(e,t){return s[o]=parseInt(t,10)|0,".@"+o++}).replace(/^\./,"");if(!/[^\w\.\$@]/.test(u)){a=u.split(".");for(o=a.length-1;o>=0;--o)a[o].charAt(0)==="@"&&(a[o]=s[parseInt(a[o].substr(1),10)]);f=r(e.config.win,a)||r(e,a)||r(e,a.slice(1))}}return f||i},_format:function(e,t){var n=/\{callback\}/,r,i;return n.test(e)?e.replace(n,t):(r=this._template.replace(n,t),this._pattern.test(e)?e.replace(this._pattern,r):(i=e.slice(-1),i!=="&"&&i!=="?"&&(e+=e.indexOf("?")>-1?"&":"?"),e+r))}},!0)},"3.16.0",{requires:["jsonp"]});
YUI.add("comet",function(D){D.namespace("Comet");function B(E){B.superclass.constructor.apply(this,arguments);}var C={};var A="comet:ready";D.initComet=function(G,F){var E=G.replace(/https:/,"http:");if(E.substr(-1)==="/"){E=E.substring(0,E.length-1);}if(!C[E]){D.publish(A);C[E]=new B();C[E].clearListeners();}if(F){C[E].addListener("/meta/handshake",F);}C[E].initBayeux(G,function(H){if(H.successful){D.fire(A,{message:H});}});return C[E];};B.NAME="Comet";B.ATTRS={uri:{value:null,setter:function(G){if(G===null){return;}var E=window.location.protocol;if(E.indexOf("https")!==-1){G=G.replace(/http:/,"https:");}else{if(E.indexOf("http")!==-1){G=G.replace(/https:/,"http:");}}var F=G.toLowerCase();if(F.indexOf("https://")!==-1){this.set("protocol","https://");}else{if(F.indexOf("http://")!==-1){this.set("protocol","http://");}}return G;}},protocol:{value:"https://"},meta:{value:{handshake:{channel:"/meta/handshake",version:"1.0",supportedConnectionTypes:["long-polling"]},connect:{channel:"/meta/connect",connectionType:"long-polling"},subscribe:{channel:"/meta/subscribe"},unsubscribe:{channel:"/meta/unsubscribe"},publish:{},disconnect:{channel:"/meta/disconnect"},ack:{channel:"/meta/ack"}}},ioCfg:{value:{method:"POST",headers:{"Content-Type":"application/json","Accept":"*/*"}}},ext:{value:{all:{},handshake:{},subscribe:{"Comet-api-version":"1.1","Comet-subscriber-auth-info":null},unsubscribe:{"Comet-api-version":"1.1","Comet-subscriber-auth-info":null},connect:{},publish:{"Comet-api-version":"1.1","Comet-registration-id":"make-up","Comet-opaque-id":"markup","Comet-acknowledge-URI":"www.yahoo.com/ack","Comet-acknowledge-type":"All"},disconnect:{}}}};D.extend(B,D.Base,{_clientState:"unconnected",_advice:{},_connected:false,_config:{backoffIncrement:1000,maxBackoff:10000,maxNetworkDelay:300000,delayedSendMaxCount:10,advice:{timeout:60000,interval:0,reconnect:"retry"},subscribe:{jsonpTimeout:5000}},_delayedSendCount:0,_urlOrigin:"",_backoff:0,_isLongpollingConnect:false,_isSendingQueue:false,_isShutdown:false,_clientId:null,_token:null,_lastMessageId:0,_outgoing:[],_subscribeChannel:{},_queue:new D.AsyncQueue(),_ioQueue_c2s:D.io.queue,_ioQueue_s2c:D.io.queue,_jsonp:null,_listeners:{},initializer:function(E){this.setClientState("unconnected");D.on("beforeunload",D.bind(function(){if(this.getClientState()!=="unconnected"){this.disconnect();}},this),window);},config:function(E,F){D.Object.setValue(this._config,E,F);},_Queue_send:function(F){var E=this;E._batch(F);if(!E.getClientId()){return;}if(E._isSendingQueue){return;}if(E._outgoing.length<=0){return;}D.each(E._outgoing,function(G){G=E._patchMessage(G);});E._IO_send(true,E._outgoing);E._outgoing=[];},_nextQueueSend:function(){this._Queue_send();},_IO_send:function(G,F){var E=this;if(!E.get("uri")){return;}if(G){if(E._isSendingQueue||!F){return;}E._IO_Queue_Send(F);}else{if(!E.getClientId()){return;}if(E._isLongpollingConnect||!F){return;}E._IO_Longpolling_Send(F);}},_IO_Queue_Send:function(F){var E=this;E.setTokenHeader(E._token);var G=D.merge(E.get("ioCfg"),{context:E,timeout:E._config.maxNetworkDelay,data:D.JSON.stringify(F),xdr:{credentials:true},on:{success:function(H,K){try{var I=D.JSON.parse(K.responseText);E._handleResponse(I);}catch(J){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-common-net-cometd-yui3:1",J,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-common-net-cometd-yui3:1");E._handleFailure(F,"json parse error");return;}},failure:function(H,I){E._handleFailure(F,"500::io failed");},start:function(){E._isSendingQueue=true;},complete:function(){E._isSendingQueue=false;E._nextQueueSend();}}});if(E._isShutdown){return;}E._ioQueue_c2s.stop();E._ioQueue_c2s(E.get("uri"),G);E._ioQueue_c2s.start();},_IO_Jsonp_Send:function(F){var E=this;if(!E.get("uri")){return;}var H=E.get("uri")+"?callback={callback}";var G=encodeURIComponent(D.JSON.stringify(F));H=H+"&data="+G;E._jsonp=new D.JSONPRequest(H,{on:{success:function(I){E._handleResponse(I);},timeout:function(I){E._handleFailure(F,"408:"+E._config.subscribe.jsonpTimeout+":jsonp timeout");},failure:function(){E._handleFailure(F,"500::jsonp failed");}},timeout:E._config.subscribe.jsonpTimeout});E._jsonp.send();},_IO_Longpolling_Send:function(F){var E=this;E.setTokenHeader(E._token);var G=D.merge(E.get("ioCfg"),{context:E,timeout:E._config.maxNetworkDelay,xdr:{credentials:true},data:D.JSON.stringify(F),on:{success:function(H,K){try{var I=D.JSON.parse(K.responseText);E._handleResponse(I);}catch(J){typeof globals!=="undefined"&&globals.report?globals.report("caughterror:..-build-common-net-cometd-yui3:2",J,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-common-net-cometd-yui3:2");E._handleFailure(F,"json parse error");return;}},failure:function(H,I){E._handleFailure(F,"500::io failed");},start:function(){E._isLongpollingConnect=true;},complete:function(){E._isLongpollingConnect=false;}}});if(E._isShutdown){return;}E._ioQueue_s2c.stop();E._ioQueue_s2c(E.get("uri"),G);E._ioQueue_s2c.start();},_handleResponse:function(E){if(E===undefined||E===null){return;}var F=this;D.each(E,function(H){F._updateAdvice(H.advice);H.originalURI=F._urlOrigin;var G=H.channel;switch(G){case"/meta/handshake":F._handshakeResponse(H);break;case"/meta/connect":F._connectResponse(H);break;case"/meta/disconnect":F._disconnectResponse(H);break;case"/meta/subscribe":F._subscribeResponse(H);break;case"/meta/shutdown":F._shutdownResponse(H);break;case"/meta/unsubscribe":F._unsubscribeResponse(H);break;default:F._messageResponse(H);break;}});},_updateAdvice:function(E){if(E){this._advice=this._mixin(false,{},this._config.advice,E);}else{this._advice=this._config.advice;}},_handshakeResponse:function(F){var E=this;if(F.successful){E.setClientState("connected");E._clientId=F.clientId;if(E._advice.VIP){E.set("uri",E.get("protocol")+E._advice.VIP+"/comet");}E._notifyListeners("/meta/handshake",F);E._Queue_send();var G=E._isDisconnected()?"none":E._advice.reconnect;
switch(G){case"retry":E._resetBackoff();E._delayedConnect();break;case"handshake":E.setClientState("unconnected");E._resetBackoff();E._delayedHandshake();break;case"none":E._disconnect(false);break;}}else{E._failHandshake(F);}},_failHandshake:function(G){var F=this;F.setClientState("unconnected");F._clientId=null;F._notifyListeners("/meta/handshake",G);F._notifyListeners("/meta/unsuccessful",G);var E=(F._advice.reconnect!=="none");if(E){F._increaseBackoff();F._delayedHandshake();}else{F._disconnect(false);}},_delayedHandshake:function(){var E=this;this._delayedSend(function(){E._handshake();});},_subscribeResponse:function(E){if(E.successful){if(this._subscribeChannel[E.subscription]&&this._subscribeChannel[E.subscription]===true){}else{this._subscribeChannel[E.subscription]=true;}if(E["ext"]["Comet-auth-token"]){this._token=E["ext"]["Comet-auth-token"];}this._notifyListeners("/meta/subscribe",E);}else{this._failSubscribe(E);}},_failSubscribe:function(E){this._notifyListeners("/meta/subscribe",E);this._notifyListeners("/meta/unsuccessful",E);},_connectResponse:function(F){var E=this;if(E._isDisconnected()){return;}E._connected=F.successful;if(E._connected){E.setClientState("connected");E._notifyListeners("/meta/connect",F);var G=E._isDisconnected()?"none":E._advice.reconnect;switch(G){case"retry":E._resetBackoff();E._delayedConnect();break;case"handshake":E.setClientState("unconnected");E._resetBackoff();E._delayedHandshake();break;case"none":E._disconnect(false);break;}}else{E._failConnect(F);}},_failConnect:function(F){var E=this;E._notifyListeners("/meta/connect",F);E._notifyListeners("/meta/unsuccessful",F);var G=E._isDisconnected()?"none":E._advice.reconnect;switch(G){case"retry":E._delayedConnect();E._increaseBackoff();break;case"subscribe":E._delayedConnect();E._increaseBackoff();break;case"handshake":E.setClientState("unconnected");E._resetBackoff();E._delayedHandshake();break;case"none":E._disconnect(false);break;}},_delayedConnect:function(){var E=this;this._delayedSend(function(){E._connect();});},_disconnectResponse:function(E){if(E.successful){this._disconnect(false);this._notifyListeners("/meta/disconnect",E);}else{this._failDisconnect(E);}},_shutdownResponse:function(E){this._disconnect(true);this._isShutdown=true;this._notifyListeners("/meta/shutdown",E);},_failDisconnect:function(E){this._disconnect(true);this._notifyListeners("/meta/disconnect",E);this._notifyListeners("/meta/unsuccessful",E);},_unsubscribeResponse:function(E){if(E.successful){if(this._subscribeChannel[E.subscription]&&this._subscribeChannel[E.subscription]===true){delete this._subscribeChannel[E.subscription];}this._notifyListeners("/meta/unsubscribe",E);}else{this._failUnsubscribe(E);}},_failUnsubscribe:function(E){this._notifyListeners("/meta/unsubscribe",E);this._notifyListeners("/meta/unsuccessful",E);},_messageResponse:function(E){if(E.successful===undefined){if(E.data){this._notifyListeners(E.channel,E);if(E.id){this._ackMessage({msgId:E.id,msgChannel:E.channel});}}else{this._notifyListeners("/meta/unsuccessful",E);}}else{if(E.successful){this._notifyListeners("/meta/publish",E);}else{this._failMessage(E);}}},_ackMessage:function(E){var F=this._createMessage("ack",E);this._Queue_send(F);},_failMessage:function(E){this._notifyListeners("/meta/publish",E);this._notifyListeners("/meta/unsuccessful",E);},_delayedSend:function(E){var H=this;var F=H._advice.interval+H._backoff;if(H._config.maxBackoff<=H._backoff){H._delayedSendCount++;}else{H._delayedSendCount=0;}if(H._delayedSendCount>H._config.delayedSendMaxCount){var G=H.get("uri");H.set("uri",H._urlOrigin);if(G===H.get("uri")){return;}H._resetBackoff();H._delayedSendCount=0;}H._queue.add({fn:E,timeout:F});H._queue.run();},_handshakeFailure:function(F,E){this._failHandshake({successful:false,failure:true,channel:"/meta/handshake",request:F,advice:{reconnect:"retry",interval:this._backoff},error:E||"",ext:F.ext||{},id:F.id||""});},_connectFailure:function(F,E){this._connected=false;this._failConnect({successful:false,failure:true,channel:"/meta/connect",request:F,advice:{reconnect:"retry",interval:this._backoff},clientId:F.clientId||"",error:E||"",ext:F.ext||{},id:F.id||""});},_disconnectFailure:function(F,E){this._failDisconnect({successful:false,failure:true,channel:"/meta/disconnect",request:F,advice:{reconnect:"none",interval:0},clientId:F.clientId||"",error:E||"",ext:F.ext||{},id:F.id||""});},_subscribeFailure:function(F,E){this._failSubscribe({successful:false,failure:true,channel:"/meta/subscribe",request:F,advice:{reconnect:"none",interval:0},clientId:F.clientId||"",subscription:F.subscription||"",error:E||"",ext:F.ext||{},id:F.id||""});},_unsubscribeFailure:function(F,E){this._failUnsubscribe({successful:false,failure:true,channel:"/meta/unsubscribe",request:F,advice:{reconnect:"none",interval:0},clientId:F.clientId||"",subscription:F.subscription||"",error:E||"",ext:F.ext||{},id:F.id||""});},_messageFailure:function(F,E){this._failMessage({successful:false,failure:true,channel:F.channel,request:F,advice:{reconnect:"none",interval:0},clientId:F.clientId||"",subscription:F.subscription||"",error:E||"",ext:F.ext||{},id:F.id||""});},_handleFailure:function(I,E){var H,G,F;for(F=0;F<I.length;++F){H=I[F];G=H.channel;switch(G){case"/meta/handshake":this._handshakeFailure(H,E);break;case"/meta/connect":this._connectFailure(H,E);break;case"/meta/disconnect":this._disconnectFailure(H,E);break;case"/meta/subscribe":this._subscribeFailure(H,E);break;case"/meta/unsubscribe":this._unsubscribeFailure(H,E);break;default:this._messageFailure(H,E);break;}}},_notifyListeners:function(I,H){this._notify(I,H);var J=I.split("/");var G=J.length-1,F=0;for(F=G;F>0;--F){var E=J.slice(0,F).join("/")+"/*";if(E!==I){this._notify(E,H);}}},_notify:function(G,F){var E=this._listeners[G];if(E){D.each(E,function(H){if(D.Lang.isFunction(H.listener)){H.listener(F);}});}},_isDisconnected:function(){return this._clientState==="unconnected";},_resetBackoff:function(){this._backoff=0;
},_nextMessageId:function(){return ++this._lastMessageId+"";},_increaseBackoff:function(){if(this._backoff<this._config.maxBackoff){this._backoff+=this._config.backoffIncrement;}},_createMessage:function(G,F){F=F||{};var J=(new Date()).valueOf();var I=window.location.host;var E=[];var H=D.merge(this.get("ext").all,this.get("ext")[G],F.ext||{},{"timestamp":J,"host":I||""});switch(G){case"handshake":E.push(D.merge({id:this._nextMessageId(),ext:H},this.get("meta")[G]));break;case"connect":E.push(D.merge({id:this._nextMessageId(),ext:H},this.get("meta")[G],{clientId:this.getClientId()}));break;case"subscribe":E.push(D.merge({id:this._nextMessageId(),ext:H},this.get("meta")[G],{clientId:this.getClientId(),subscription:F.channel}));break;case"unsubscribe":E.push(D.merge({id:this._nextMessageId(),ext:H},this.get("meta")[G],{clientId:this.getClientId(),subscription:F.channel}));break;case"publish":E.push(D.merge({id:this._nextMessageId(),ext:H},this.get("meta")[G],{clientId:this.getClientId(),channel:F.channel,data:F.data}));break;case"disconnect":E.push(D.merge({id:this._nextMessageId(),ext:H},this.get("meta")[G],{clientId:this.getClientId()}));break;case"ack":E.push(D.merge({id:this._nextMessageId(),ext:H,msgId:F.msgId,msgChannel:F.msgChannel},this.get("meta")[G],{clientId:this.getClientId()}));break;}return E;},_handshake:function(E){var H=this;if(H.getClientState()!=="unconnected"){if(H.getClientState()==="connected"){var G={successful:true,channel:"/meta/handshake",clientId:H._clientId,originalURI:H._urlOrigin};H._notifyListeners("/meta/handshake",G);}return;}if(E&&E.listener){H._addListener(E,false);}H._clientId=null;H._token=null;H.resetTokenHeader();H._clearSubscriptions();H._updateAdvice(H._config.advice);var F=H._createMessage("handshake",E);H._IO_send(true,F);H.setClientState("connecting");},_connect:function(E){var G=this;if(G.getClientState()!=="connected"){return;}if(G._isLongpollingConnect){return;}var F=G._createMessage("connect",E);G._IO_send(false,F);},_subscribeJSONP:function(E){if(!(E&&E.channel)){return;}if(!this.getClientId()){return;}if(this._subscribeChannel[E.channel]&&this._subscribeChannel[E.channel]===true){return;}if(E.listener){this._addListener(E,true);}var F=this._createMessage("subscribe",E);this._IO_Jsonp_Send(F);},_unsubscribe:function(E){if(!this.getClientId()){return;}if(E&&E.channel){this.removeListeners(E.channel);}if(E&&E.channel){var F=this._createMessage("unsubscribe",E);this._Queue_send(F);}},_disconnect:function(F){var G=this;if(F){G._ioQueue_c2s.stop();G._ioQueue_s2c.stop();}G.setClientState("unconnected");G._clientId=null;G._resetBackoff();G._queue.stop();if(G._outgoing.length>0){var E=G._outgoing;G._outgoing=[];G._handleFailure(E,"500::canceled after disconnect");}G._clearSubscriptions();},_patchMessage:function(E){if(!E.id){E.id=this._nextMessageId();}E.clientId=this.getClientId();if(E.channel==="/meta/handshake"){delete E.clientId;}return E;},_batch:function(){D.each(arguments,function(E){if(E&&D.Lang.isArray(E)){var F=0;for(F=0;F<E.length;++F){this._outgoing.push(E[F]);}}else{if(E){this._outgoing.push(E);}}},this);},_clearSubscriptions:function(){D.each(this._listeners,function(E){if(E){D.each(E,function(G,F,H){if(G&&G.isSub){H.splice(F);}});}});this._subscribeChannel={};},_reDoSubscriptions:function(){D.each(this._subscribeChannel,function(E,F){if(E){this._subscribeChannel[F]=false;this._subscribeJSONP({channel:F});}},this);},isDuplicatedListener:function(E,G){var F=0;for(F=0;F<G.length;++F){var H=G[F];if(H&&H.listener&&H.listener.toString()===E.toString()){return true;}}return false;},_addListener:function(E,F,G){if(E&&E.listener&&D.Lang.isFunction(E.listener)){if(this._listeners[E.channel]){if(G||!this.isDuplicatedListener(E.listener,this._listeners[E.channel])){this._listeners[E.channel].push({listener:E.listener,isSub:F});}}else{this._listeners[E.channel]=[{listener:E.listener,isSub:F}];}}},_mixin:function(K,I,L){var G,H;var M=I||{};for(G=2;G<arguments.length;++G){var F=arguments[G];if(F===undefined||F===null){continue;}for(H in F){var E=F[H];var J=M[H];if(E===I){continue;}if(E===undefined){continue;}if(K&&typeof E==="object"&&E!==null){if(E instanceof Array){M[H]=this._mixin(K,J instanceof Array?J:[],E);}else{M[H]=this._mixin(K,{},E);}}else{M[H]=E;}}}return M;},destructor:function(){},getClientState:function(){return this._clientState;},setClientState:function(E){this._clientState=E;},getClientId:function(){return this._clientId;},initBayeux:function(E,F){this._urlOrigin=E;this.set("uri",E);this._handshake({channel:"/meta/handshake",listener:F});},subscribe:function(E,F){this._subscribeJSONP({channel:E,listener:F});},unsubscribe:function(E){this._unsubscribe({channel:E});},disconnect:function(G){var F=this;if(G){F._addListener({channel:"/meta/disconnect",listener:G},false);}if(F.getClientState()==="unconnected"){return;}if(!F.getClientId()){return;}var E=F._createMessage("disconnect");F._Queue_send(E);},publishMsg:function(F,H){if(F&&H){var E={channel:F,data:H};var G=this._createMessage("publish",E);this._Queue_send(G);}},clearListeners:function(){this._listeners={};},addListener:function(E,G,F){F=F||false;if(!G&&D.Lang.isFunction(G)){return;}this._addListener({channel:E,listener:G},false,F);},removeListeners:function(E){if(this._listeners[E]){delete this._listeners[E];}},setUserInfo:function(F,E){if(F&&E){var G=this.get("ext");G.subscribe["Comet-subscriber-auth-info"]={"uid":F,"user_type":"yahoo","user_cred":E};}},setUserInfoWithCookie:function(F,E){if(F){var G=this.get("ext");G.subscribe["Comet-subscriber-auth-info"]={"uid":F,"user_type":"yahoo","user_cred":"Any Value"};}},setTokenHeader:function(E){if(E){var F=this.get("ioCfg");F["headers"]["Authorization"]="Basic token="+E;}},resetTokenHeader:function(){var E=this.get("ioCfg");E["headers"]["Authorization"]="Basic token=";},setYcaHeader:function(E,F){if(E){var H=this.get("ioCfg");H["headers"]["Yahoo-App-Auth"]=E;}if(F){var G=this.get("ext");G.publish["Comet-opaque-id"]=F;}}});D.Comet=B;},"3.4.1",{requires:["base","io","json","async-queue","cookie","jsonp","jsonp-url"]});
YUI.add("mail-ui-shopping-utils",function(e){e.namespace("mail.ui.Shopping");var t={};e.mix(t,{normalizeProductName:function(t){var n=e.common.Utils.settings.value("shoppingStrings")||[],r=t;return e.Array.each(n,function(e){var t="\\b"+e.join("\\b|\\b")+"\\b";r=r.replace(new RegExp(t,"ig"),"")}),r.replace(new RegExp(":","i")," "),r=r.replace(/[(\[{].*?[)\]}]/g,""),r=r.replace(/\S*[^a-z\-\s]\S*/ig,""),r=r.replace(/(?![a-z])-(?![a-z])/ig,""),r=r.replace(/\s+/g," "),r=r.replace(/^\s+|\s+$/g,""),r},getColo:function(){var e=NeoConfig.hostName||"",t=NeoConfig.mailEnv==="dev"?/.corp\.([^\.]+)\.yahoo.com$/i:/.mail\.([^\.]+)\.yahoo.com$/i,n="",r;return r=e.match(t),r&&r[1]&&(n=r[1]),n},getGender:function(){var e="n";switch(parseInt(NeoConfig.comscoreGender,10)){case 0:e="f";break;case 1:e="m"}return e},flattenArray:function(e){var t=[];return t=t.concat.apply(t,e),e=t,e},shuffleArray:function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e}}),e.mail.ui.Shopping.Utils=t},"1.0.0",{requires:[]});
YUI.add("mail-ui-shopping-model",function(e){var t;t=function(){function o(){var t=this,n=[],i,s,o,a,f=5,l=4,c=NeoConfig.purchasedItems||[],h=e.common.Utils.settings.settings;r.AdsModel.predictCount=0,c=c.slice(0,f),c.forEach(function(e,r){s="/neo/sherpa?item="+e+"&sampleId="+NeoConfig.expBucketId,n[r]=t.getXHRPromise(s)}),r.AdsModel.affAdDoneTimer=e.later(1e4,t,function(){e.fire("util:ymstats",{name:"shopping_aff_event_not_fired",tags:{bkt:NeoConfig.expBucketId}})},[],!1),n.forEach(function(n,f){n.then(function(e){try{a=JSON.parse(e),a.forEach(function(e,n){if(n>l)return;o=h.predictedItemEndPoint?h.predictedItemEndPoint:"/neo/shopping",o+="?item="+e+"&sampleId="+NeoConfig.expBucketId,r.AdsModel.predictCount++,i=t.getXHRPromise(o),u(i)})}catch(n){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-shoppingads-shoppingAdsModel:1",n,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-shoppingads-shoppingAdsModel:1")}},function(t){e.fire("MailLog",{m:"storm_jsexception_shoppingads",bkt:NeoConfig.expBucketId,brwsr:NeoConfig.browser,err:t.message,url:s},1,"JSException")})})}function u(t){var n=this,s,o;o=i.getColo(),NeoConfig.shoppingAds=[],t.then(function(t){try{r.AdsModel.predictCount--,s=JSON.parse(t),s.length?NeoConfig.shoppingAds.push(s):e.fire("util:ymstats",{name:"shopping_predicted_offers_empty",tags:{bkt:NeoConfig.expBucketId,colo:o}}),r.AdsModel.predictCount===0&&e.fire("affAd:done")}catch(n){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-shoppingads-shoppingAdsModel:2",n,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-shoppingads-shoppingAdsModel:2")}},function(t){r.AdsModel.predictCount--,e.fire("MailLog",{m:"storm_jsexception_shoppingads",bkt:NeoConfig.expBucketId,brwsr:NeoConfig.browser,err:t.message},1,"JSException"),r.AdsModel.predictCount===0&&e.fire("affAd:done")})}function a(){var t=this,n=s.settings.value("topItemEndPoint")+NeoConfig.expBucketId,r,i;r=t.getXHRPromise(n),r.then(function(e){try{i=JSON.parse(e),i.length&&(NeoConfig.shoppingAds=i)}catch(t){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-shoppingads-shoppingAdsModel:3",t,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-shoppingads-shoppingAdsModel:3")}},function(t){e.fire("MailLog",{m:"storm_jsexception_shoppingads",bkt:NeoConfig.expBucketId,brwsr:NeoConfig.browser,err:t.message},1,"JSException")})}function f(t){var n=s.settings.value("affTimeout")*1e3;return new Promise(function(r,i){e.io(t,{on:{success:function(e,t){r(t.responseText)},failure:function(n,r){var s=t&&t.match("^/neo/[a-zA-z]*");s=s&&s[0]&&s[0].substr(5),e.fire("util:ymstats",{name:"shopping_request_failed",tags:{endpoint:s,status:r.status,statusText:r.statusText,responseText:r.responseText}}),i(Error(r.statusText))}},timeout:n})})}var n,r=e.mail.ui.Shopping,i=e.mail.ui.Shopping.Utils,s=e.common.Utils;e.mix(this,{getXHRPromise:f,getAffiliateAds:o,makeShoppingCalls:u,getTopItems:a}),e.augment(t,e.EventTarget)},e.namespace("mail.ui.Shopping").AdsModel=new t},"1.0.0",{requires:["mail-ui-shopping-utils","common-utils","event-base"]});
YUI.add("shopping-ads-ult",function(e){e.mix(e.common.Utils.RapidCM,{affiliate_ad:["msgLst","inbxTb","msgLst","aflAd"],affiliate_ad_left:["msgLst","inbxTb","msgLst","aflAdLft"],affiliate_ad_center:["msgLst","inbxTb","msgLst","aflAdMid"],affiliate_ad_right:["msgLst","inbxTb","msgLst","aflAdRt"],rr_affiliate_ad_MON:["msgLst","inbxTb","msgLst","aflAdRrM"],rr_affiliate_ad_SKY:["msgLst","inbxTb","msgLst","aflAdRrS"],rr_affiliate_ad_LREC:["msgLst","inbxTb","msgLst","aflAdRrL"]}),e.mix(e.common.Utils.RapidVM,{shopping_ad_one_item:["affiliate_ad"],shopping_ad_three_items:["affiliate_ad_left","affiliate_ad_center","affiliate_ad_right"],rr_affiliate_ad_MON:["rr_affiliate_ad_MON"],rr_affiliate_ad_SKY:["rr_affiliate_ad_SKY"],rr_affiliate_ad_LREC:["rr_affiliate_ad_LREC"]})},"1.0.0",{requires:["common-utils-rapid-clickmap","common-utils-rapid-viewmap"]});
YUI.add("mail-ui-shopping-view",function(e){var t=e.common.Utils,n=function(){};n.extend=function(t){var r=function(){};return e.extend(r,this,t),r.extend=n.extend,r},n.prototype={init:function(){this.shoppingAds=[],this.evts=[],this.timers=[],this.adListIdx=0,this.AdsUtils=e.mail.ui.Shopping.Utils,this.refreshTime=t.settings.value("ad_refresh_time"),this.shoppingModel=e.mail.ui.Shopping.AdsModel,this.bindEventHandlers(),t.features.enabled("predictedAdsShopping")&&this.shoppingModel.getAffiliateAds(),t.features.enabled("affiliateListAd")&&this.fireViewStat(this.getContainer())},bindClickHandlers:function(){if(!this.container)return;this.clickHandler&&this.clickHandler.detach("click"),this.clickHandler=this.container.delegate("click",this.handleAdClicks,this.elClass,this)},handleAdClicks:function(t){var n,r=t.currentTarget,i=!1,s=(new Date).getHours(),o=e.mail.ui.Shopping.Utils.getGender();for(var u=0;u<this.adChoicesClasses.length;u++)r.hasClass(this.adChoicesClasses[u])&&(i=!0);i?(t.halt(!0),window.open(strings.str_cfg_url_about_adchoices,"_blank")):this.fireClickStat(t)},render:function(){var t="",n,r;t=this.getAdHtml(),this.container=this.getContainer(),this.container.setHTML(t),this.fireViewStat(this.container),r=this.rootNodeSelector&&e.one(this.rootNodeSelector),this.insertNode(r),this.applyStyle(r)},getAdList:function(e){var n=[],r;for(var i=0;i<e&&this.adListIdx<this.shoppingAds.length;)r=this.shoppingAds[this.adListIdx],r&&r.clickUrl&&r.displayTitle&&r.seller&&(r.image||r.images&&r.images.length)?(!r.image&&r.images&&r.images.length&&(r.image=r.images[0]),n.push(r),this.adListIdx=NeoGV.mbToggle?++this.adListIdx:++this.adListIdx%this.shoppingAds.length,i++):(this.shoppingAds.splice(this.adListIdx,1),this.adListIdx=NeoGV.mbToggle?this.adListIdx:this.adListIdx%this.shoppingAds.length),t.features.enabled("mbBackfill")&&this.adListIdx===this.shoppingAds.length&&(NeoGV.mbToggle=!1);return n},getRatingTmpl:function(e){var n=(Math.round(e.sellerRating*2)/2).toFixed(1),r;if(n>3){switch(n){case"3.5":e.fourthstar="half",e.fifthstar="off";break;case"4":e.fifthstar="off";break;case"4.5":e.fifthstar="half";break;default:}r=t.substitute(this.template.avgRating,e),e.avgRating=r}else e.avgRating="";return e},applyStyle:function(e){},fireRapidStat:function(t,n,r){e.fire(t,{action:n,append:r})}},e.namespace("mail.ui.Shopping"),e.mail.ui.Shopping.affView=n},"1.0.0",{requires:["io","common-utils","mail-ui-shopping-model","shopping-ads-ult","comms-utils","mail-ui-shopping-utils"]});
YUI.add("minty_module_shoppingads_rr_img_three_items",function(e){e.namespace("ui.Templates"),e.ui.Templates.minty_module_shoppingads_rr_img_three_items={base:'<div id="aff_{{rrAdPosition}}"> <div class="affiliate-ad right-rail-affiliate-ad {{shoppingBucket}}"> <div class="rr-header"> <div class="rr-sponsored rr-ad-item-click">{{shopping_sponsored_text}}</div> <div class="rr-mb-right rr-ad-item-click"> <i class="icon mb-icon adchoices mb-sponsored mb-logo-left shopping-mb-icon"></i> </div> </div> {{item}} </div></div>',maxPriceDiff:'<div class="rr-ad-item-price">{{minPrice}}&nbsp;-&nbsp;{{maxPrice}}</div> ',maxPriceDiff_else:'<div class="rr-ad-item-price">{{maxPrice}}</div> ',avgRating:'<div class="rating"> <div class="rating-star"> <div class="rating-star-yellow"></div><div class="rating-star-icon"><span class="icon icon-star"></span></div> </div> <div class="rating-star"> <div class="rating-star-yellow"></div><div class="rating-star-icon"><span class="icon icon-star"></span></div> </div> <div class="rating-star"> <div class="rating-star-yellow"></div><div class="rating-star-icon"><span class="icon icon-star"></span></div> </div> <div class="rating-star {{fourthstar}}"> <div class="rating-star-yellow"></div><div class="rating-star-icon"><span class="icon icon-star"></span></div> </div> <div class="rating-star {{fifthstar}}"> <div class="rating-star-yellow"></div><div class="rating-star-icon"><span class="icon icon-star"></span></div> </div> </div> ',item:'<div class="rr-ad-item"> <div class="rr-ad-item-body"> <a class="rr-ad-item-click" target="_blank" href="{{clickUrl}}" data-click-url="{{clickUrl}}" data-min-price="{{minPrice}}" data-seller-rating="{{sellerRating}}" data-category="{{catId}}" data-title="{{title}}" data-cpc="{{cpc}}" data-adpos="{{adpos}}" data-istop="{{isTop}}" data-item-name="{{itemName}}"i data-product-id="{{productId}}" data-seller="{{seller}}" data-product-yid="{{uniqueId}}"> <div> <img class="rr-ad-item-image" src="{{image}}" border="0"> </div> <div class="rr-ad-item-content"> <div class="rr-ad-item-title" title="{{title}}">{{title}}</div> {{maxPriceDiff}} {{maxPriceDiff_else}} <div class="rr-ad-item-seller" title="{{seller}}">{{seller}}</div> {{avgRating}} </div> </a> </div> </div> '}},"1.0.0");
YUI.add("mail-ui-shopping-rr-view",function(e){var t,n=e.common.Utils,r=n.settings.value("aff_min_num_ads")||3;e.mail.ui.Shopping.RRView=e.mail.ui.Shopping.affView.extend({template:e.ui.Templates.minty_module_shoppingads_rr_img_three_items,rootNodeSelector:"#theAd",elClass:".rr-ad-item-click",containerId:"slot_affRightRail",adChoicesClasses:["rr-sponsored","rr-mb-right","rr-mb-left"],affDarlaEvent:"",bindEventHandlers:function(){n.features.enabled("predictedAdsShopping")?e.on("affAd:done",function(){this.shoppingAds=this.AdsUtils.flattenArray(NeoConfig.shoppingAds),this.shoppingAds=this.AdsUtils.shuffleArray(this.shoppingAds)},this):this.shoppingAds=this.AdsUtils.flattenArray(NeoConfig.AffiliateFallback),e.on("darla:blankAdLoaded:affiliate",this.onDarlaEvent,this)},onDarlaEvent:function(e,t){this.affDarlaEvent=e,this.adPosition=t.rightRailAdPos,this.render(),this.bindClickHandlers()},fireClickStat:function(t){var n=e.mail.ui.Shopping.RRView.adPosition,r=t.currentTarget,i="rr_affiliate_ad_"+n,s="rr_affiliate_ad_clicked_"+n,o=(new Date).getHours(),u=e.mail.ui.Shopping.Utils.getGender(),a=r.getData("adpos").charAt(0),f={};f["mClkUrl"+a]=r.getData("click-url"),f["mnPrice"+a]=r.getData("min-price"),f["mxPrice"+a]=r.getData("max-price"),f["mCatId"+a]=r.getData("category"),f["mTitle"+a]=r.getData("title"),f["mSellr"+a]=r.getData("seller"),f["mCpc"+a]=r.getData("cpc"),f["mIsTop"+a]=r.getData("istop"),f["mUsrHr"+a]=o,f["mBkt"+a]=NeoConfig.expBucketId,f["mGender"+a]=u,f["mProdId"+a]=r.getData("product-id"),f["mYId"+a]=r.getData("product-yid"),f["mItem"+a]=r.getData("item-name"),f["mThm"+a]=NeoConfig.theme.id,this.fireRapidStat("mt:click",i,f),e.fire("util:ymstats",{name:s,tags:{pos:n,uh:o,bkt:NeoConfig.expBucketId,thm:NeoConfig.theme.id}})},getAdHtml:function(){var t,i,s,o,u=3,a={},f=this.getAdList(u),l=(new Date).getHours(),c="rr_affiliate_ad_"+this.adPosition,h="rr_affiliate_ad_viewed_"+this.adPosition,p="";if(f&&f.length!==u||this.shoppingAds.length<r)return e.fire(this.darlaAPI.blankAdLoadedDefaultEvent,this.affDarlaEvent,{rightRailAdPos:this.adPosition}),this.clean(),p;for(var d=0;d<f.length;d++){switch(d){case 0:f[d].adpos="Top";break;case 1:f[d].adpos="Middle";break;case 2:f[d].adpos="Bottom"}o=f[d].adpos.charAt(0),f[d]=this.getRatingTmpl(f[d]),f[d]=this.applyBucketLogic(f[d]),p+=n.substitute(this.template.item,f[d]),a["mnPrice"+o]=f[d].minPrice,a["mxPrice"+o]=f[d].maxPrice,a["mCatId"+o]=f[d].catId,a["mTitle"+o]=f[d].displayTitle,a["mSellr"+o]=f[d].seller,a["mCpc"+o]=f[d].cpc,a["mUsrHr"+o]=l,a["mBkt"+o]=NeoConfig.expBucketId,a["mGender"+o]=this.AdsUtils.getGender(),a["mProdId"+o]=f[d].productId,a["mYId"+o]=f[d].uniqueId,a["mItem"+o]=f[d].itemName,a["mThm"+o]=NeoConfig.theme.id}return this.fireRapidStat("mt:view",c,a),e.fire("util:ymstats",{name:h,tags:{uh:l,bkt:NeoConfig.expBucketId,thm:NeoConfig.theme.id}}),p=n.substitute(this.template.base,{item:p,shopping_sponsored_text:"Sponsored",rrAdPosition:this.adPosition}),p},getContainer:function(){var t;return t=e.one("#"+this.containerId),t||(t=e.Node.create('<div id="'+this.containerId+'">')),t},applyBucketLogic:function(e){return e.minPrice!==e.maxPrice?e.maxPriceDiff=n.substitute(this.template.maxPriceDiff,e):e.maxPriceDiff_else=n.substitute(this.template.maxPriceDiff_else,e),e},insertNode:function(e){e&&(e.all(".ch_mod").addClass("hidden"),e.append(this.container))},clean:function(){var t=e.one("#"+this.containerId);t&&t.get("parentNode").removeChild(t)}}),e.namespace("mail.ui.Shopping")},"1.0.0",{requires:["io","common-utils","mail-ui-shopping-view","mail-ui-shopping-model","shopping-ads-ult","minty_module_shoppingads_rr_img_three_items","comms-utils","mail-ui-shopping-utils"]});
YUI.add("mail-ui-shopping-rr-controller",function(e){var t,n=e.mail.ui.Shopping;t=function(){function t(t){this.yutils=e.common.Utils,NeoConfig.hasAds&&(this.view=new n.RRView,this.view.init(),this.view.darlaAPI=t,e.on(["adReturned:LREC","adReturned:MON","adReturned:SKY","showTrendingModule"],function(){this.view.clean()},this))}e.mix(this,{init:t})},e.namespace("mail.ui.Shopping"),e.mail.ui.Shopping.RRController=new t},"1.0.0",{requires:["io","mail-ui-shopping-model","mail-ui-shopping-view","mail-ui-shopping-rr-view"]});
YUI.add("mail-ui-rr-backfill-controller",function(e){var t;t=function(){function a(){e.on("darlaEvent:change",function(e){u=e},this),window.postMessage&&(window.addEventListener?window.addEventListener("message",f,!1):window.attachEvent("onmessage",f)),t.features.enabled("sidekick")&&e.use("mail-ui-sidekick-controller",function(e){e.mail.ui.sidekickController.init({blankAdLoadedDefaultEvent:n})}),(t.features.enabled("trending")||t.features.enabled("newsFeedTab"))&&e.use("mail-ui-trending-controller",function(e){e.mail.ui.trendingController.init({blankAdLoadedDefaultEvent:n,adPosition:o})}),t.features.enabled("affRightRail")&&e.use("mail-ui-shopping-rr-controller",function(e){e.mail.ui.Shopping.RRController.init({blankAdLoadedDefaultEvent:n,adPosition:o})})}function f(e){var t;e=e||window.event;if(e&&e.data)switch(e.data){case"rmx:no-ad-tl1":l("darla:blankAdLoaded:TL1");break;case"rmx:no-ad-mbrightrail":NeoGV&&NeoGV.ads&&NeoGV.ads[t]&&NeoGV.ads[t].bookId&&c({name:"rmx_noad_mbrightrail",tags:{bookingId:NeoGV.ads[t].bookId}});case"rmx:no-ad":l(i),c({name:"righrail_backfill_total",tags:{event:i,bkt:NeoConfig.expBucketId}});break;case"rmx:no-ad-mbbackfill":l("darla:blankAdLoaded"),c({name:"righrail_moneyball_backfill_total",tags:{bkt:NeoConfig.expBucketId}});break;case"rmx:no-ad-trendingnow":l("darla:blankAdLoaded:trending"),c({name:"righrail_trending_backfill_total",tags:{bkt:NeoConfig.expBucketId}});break;case"rmx:no-ad-sidekick":l("darla:blankAdLoaded:sidekick"),c({name:"righrail_sidekick_backfill_total",tags:{bkt:NeoConfig.expBucketId}});break;case"rmx:no-ad-aff-rightrail":l("darla:blankAdLoaded:affiliate")}}function l(t){var n;if(!t&&!s&&!s.getEligibleRightRailAdPos)return;n=s.getEligibleRightRailAdPos(),e.fire(t,u,{rightRailAdPos:n})}function c(t){if(!t)return;var n=t.name||"",r=t.tags||{};e.fire("util.ymstats",{name:n,tags:r})}var t=e.common.Utils,n="darla:blankAdLoaded",r=t.features.enabled("trending")?"darla:blankAdLoaded:trending":n,i=t.features.enabled("sidekick")?"darla:blankAdLoaded:sidekick":r,s=e.mail.ui.darla,o=s.getEligibleRightRailAdPos(),u={};e.mix(this,{init:a,messageReceived:f})},e.namespace("mail.ui"),e.mail.ui.RRBackfillController=new t,e.mail.ui.RRBackfillController.init()},"1.0.0",{requires:["mail-ui-darla","mail-ui-shopping-rr-controller"]});
YUI.add("mail-ui-backbutton",function(C){var I,G=C.common.Utils,B=C.mail.Tabs,H=C.Node.one("#theAd"),E,F=0,D=0,A={};I=function(){function K(){var N,P,O=C.mail.FoldersView;window.onhashchange=function(S){if(typeof S.newURL==="string"){if((S.newURL.indexOf("#")>0&&S.oldURL.indexOf("#")>0)||(S.newURL.slice(-1)==="#")){return false;}}N=B.tabs;if(N[0].NAME.indexOf("INBOX")!==-1&&O.get("fid").fid==="Inbox"){B.switchToTab(B.tabs[0]);window.history.state&&window.history.go(-1);}else{if(N[N.length-2].widgetType==="search"&&NeoConfig.backButtonSearch){var Q=B.getActiveTab();Q.set("close",1);}else{var R={fid:"Inbox",forceRefresh:"",name:"Inbox",mailboxId:"Inbox",smartFolder:""};O.set("fid",R);C.fire("navigation:switch","none");}}if(typeof window.history.pushState==="function"&&typeof window.history.state!=="undefined"){if(window.history.state!==null){window.history.state.id=0;}}return false;};}function L(){var N=C.mail.Tabs,P,O=C.mail.FoldersView;window.onclick=function(Q){if(Q.button!==2&&Q.target.getAttribute("href")==="#"){Q.preventDefault();}};window.onhashchange=function(Q){if(typeof Q.newURL==="string"){if((Q.newURL.indexOf("#")>0&&Q.oldURL.indexOf("#")>0)||(Q.newURL.slice(-1)==="#")){return false;}}};window.onpopstate=function(){if(window.location.href.slice(-1)==="#"){return false;}P=A[window.location.hash.slice(1)];if(!P&&window.location.hash.length){return;}if(!P){N.switchToTab(N.tabs[0]);return false;}if(typeof P==="object"){var Q={fid:P.fid.fid,bb:true};O.set("fid",Q);}else{N.switchToTab(N.tabs[P||0],0,0,0,0,1);}C.fire("util:ymstats",{"name":"browsernav","tags":{"type":"switch"}});return false;};}function J(P){var O=false;C.fire("util:ymstats",{"name":"browsernav","tags":{"type":"init"}});if(!NeoConfig.backButtonFull){if(NeoConfig.backButton&&(typeof window.history.pushState==="function")){if(!window.history.state||!window.history.state.id){window.history.pushState({id:"1"},document.title,window.location.pathname+window.location.search);}if(!window.location.hash.length){window.history.replaceState({id:"1"},document.title,"#mail");}}return;}E=Math.ceil(Math.random()*Math.pow(10,10));var N;window.history.pushState({id:E},document.title,"#"+E);N=P?P.id:B.getActiveTab().cfg.label;switch(N){case"Contacts":A[E]=1;O=true;break;case"Calendar":A[E]=2;O=true;break;case"Notepad":A[E]=3;O=true;break;default:if(P.fid&&P.fid.length>1){A[E]={};A[E].tab=0;A[E].fid=P;}else{A[E]=B.getActiveTabIndex();}O=true;break;}F++;return O;}function M(){var N=window.location.hash.slice(1);if(A[N]){delete A[N];}}if(NeoConfig.backButtonFull){L();}else{if(NeoConfig.backButton){K();}}C.on("initPage",J);C.on("removePage",M);C.mix(this,{initPage:J,removePage:M});};C.namespace("mail.ui").BackButton=new I();},"1.0.0",{});YUI.add("minty_module_toolbar_fragments_reply_group_conv",function(A){A.namespace("ui.Templates");A.ui.Templates.minty_module_toolbar_fragments_reply_group_conv={base:"{{reply_group}}",reply_group:'<button id="btn-reply-sender" class="btn onemsg reply" aria-label="{{str_reply_sender}}" title="{{str_reply_sender}} [{{str_menu_accel_shift_r}}]" data-action="reply_sender" tabindex="-1"> <i class="icon-reply"></i> </button> <button id="btn-reply-all" class="btn onemsg reply-all" aria-label="{{str_reply_all}}" title="{{str_reply_all}} [{{str_menu_accel_shift_a}}]" data-action="reply_all" tabindex="-1"> <i class="icon-reply-all"></i> </button> <button id="btn-forward" class="btn onemsg forward" aria-label="{{str_forward}}" title="{{str_forward}} [{{str_menu_accel_shift_f}}]" data-action="forward" tabindex="-1"> <i class="icon-forward"></i> </button>'};},"1.0.0");YUI.add("minty_module_toolbar_inbox_message_thread",function(e){e.namespace("ui.Templates"),e.ui.Templates.minty_module_toolbar_inbox_message_thread={base:'<div id="pagetoolbar" class="{{msgliststate}} threadtoolbar"> {{from_search}} {{minty_module_toolbar_fragments_reply_group_conv}} <button id="btn-delete" class="btn multimsg" aria-label="{{str_delete_conv_attr}}" title="{{str_delete_conv_attr}}" data-action="delete" tabindex="-1"> <i class="icon-delete"></i><span class="icon-text">{{str_delete}}</span> </button> <button id="btn-move" class="btn multimsg" aria-label="{{str_move_convs_attr}}" title="{{str_move_convs_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <i class="icon-move"></i><span class="icon-text">{{str_move}}</span><b class="icon icon-chevron-down"></b> </button> {{has_spam_button}} <button id="btn-actions" class="btn multimsg" aria-label="{{str_more_actions_attr}}" title="{{str_more_actions_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <i class="icon-more"></i><span class="icon-text">{{str_more}}</span><b class="icon icon-chevron-down"></b> </button> {{msg_nav_arrows}} <button id="btn-togglethread" class="btn onemsg thread-cards-expanded hidden {{rightAlign_togglethread}}" aria-label="{{str_collapse_all_attr}}" title="{{str_collapse_all_attr}}" data-action="thread-toggle" tabindex="-1"> <i class="icon-collapse-list"></i><span class="icon-text">{{str_collapse_all}}</span> </button> {{cancellable}}</div>',from_search:'<button id="btn-back-to-search" class="btn" aria-label="{{str_srch_back}}" title="{{str_srch_back}}" data-action="closemsg" tabindex="-1"> <i class="icon-arrow-left"></i><span class="icon-text">{{str_srch_result}}</span> </button> ',spam_menu:'<button id="main-btn-spam" class="btn multimsg collapse-end-space" aria-label="{{str_mspam_conv_attr}}" title="{{str_mspam_conv_attr}}" data-action="{{spam_data_action}}" tabindex="-1"> <i class="icon-spam"></i><span class="icon-text">{{str_spam}}</span> </button> <button id="btn-spam" class="btn multimsg primary-only-action" aria-label="{{str_menu_spam_toggle_attr}}" title="{{str_menu_spam_toggle_attr}}" data-action="menu" tabindex="-1" aria-haspopup="true"> <b class="icon icon-chevron-down"></b> </button> ',spam_menu_else:'<button id="main-btn-spam" class="btn multimsg" aria-label="{{str_spam_attr}}" title="{{str_spam_attr}}" data-action="{{spam_data_action}}" tabindex="-1"> <i class="icon-spam"></i><span class="icon-text">{{str_spam}}</span> </button> ',has_spam_button:"{{spam_menu}} {{spam_menu_else}} ",msg_nav_arrows:'<button id="btn-prev-msg" class="btn btn-absolute btn-prev-msg hidden" aria-label="{{str_prev_conv_attr}}" title="{{str_prev_conv_attr}}" data-action="prev" tabindex="-1"> <i></i> </button> <button id="btn-next-msg" class="btn btn-absolute btn-next-msg hidden" aria-label="{{str_nxt_conv_attr}}" title="{{str_nxt_conv_attr}}" data-action="next" tabindex="-1"> <i></i> </button> ',rightAlign_togglethread:"togglethread-right-align",cancellable:'<button id="btn-closemsg" class="btn btn-absolute btn-close-msg hidden" aria-label="{{str_close}}" title="{{str_close}}" data-action="closemsg" tabindex="-1"> <i></i> </button> '}},"1.0.0",{requires:["minty_module_toolbar_fragments_reply_group_conv"]});
YUI.add("mail-ui-convpane-bind",function(D){D.namespace("mail.ui");var A=D.mail.ui._ConvPane,C=A.prototype;var B=function(F,E){var G=this;D.use("mail-ui-proxyevents",function(){D.mail.ui.MailEventsProxy.handleUI({action:E},G.getMsgFid(F),null,[F]);});};C.handleUI=B;},"1.0.0");YUI.add("mail-ui-mailpane-read",function(e){function r(e,t,n){var r=this,i,o;n=n||r.message,o={fid:r.fid,mid:n.mid,pid:e},i=n.nonImgAttachments;for(var u=0;u<i.length;u++){var a=i[u];(a.type==="message"||a.type==="text")&&a.partId==e&&(o.filename=a.filename)}typeof t!="undefined"&&t!==""&&t!=="null"&&(o.tnefid=t),s([o])}function i(e,t,n){var r=this,i,o=[],u,a;n=n||r.message,u={image:n.imgAttachments,"non-image":n.nonImgAttachments,all:n.attachments},a=u[e]||[];for(var f=0;f<a.length;f++){var l=a[f],c={fid:r.fid,mid:n.mid,pid:l.partId},h=l.tnefId;if(l.type==="message"||l.type==="text")c.filename=l.filename;typeof h!="undefined"&&(c.tnefid=h),o.push(c)}t&&t.target&&(t.target.get("nodeName")==="A"?i={restoreFocusNode:t.target}:i={restoreFocusNode:t.target.ancestor("A")}),o.length&&s(o,i)}function s(n,r){e.use("mail-common-downloader-v"+(NeoConfig.downloaderVersion||"1"),function(){t.common.downloader.render(n,r)})}function o(){e.fire("openOptions",{view:"security"})}function u(n,r,i){var s=this,o,u;i=i||s.fid,r=r||s.message;if(r&&!s.loading_slow&&!s.loading_error&&!s.loading_moved&&!r.flags.isRead){o=e.mail.persist.MetaData.get("cg.pref.general.markasreadinterval");if(o!="999")return o=o?parseInt(o,10)*1e3:750,isNaN(o)&&(o=750),u=o===0,e.use("mail-controller-messages-ops",function(){var e=function(){var e=t.Controller.batch();return e.Messages.flag({fid:i,mid:r,setFlags:{read:1},enableRetry:!0},{suppressCodes:["*"]}),e};u||(s.tmFireRead&&(clearTimeout(s.tmFireRead),s.tmFireRead=null),s.tmFireRead=setTimeout(function(){var t=e&&e();t&&t.execute()},o)),n&&n(u?e:null)}),!0}return!1}function a(t){var n=t.target,r=n.get("parentNode"),i=null;n.hasAttribute("ymailto")?i=n.getAttribute("ymailto"):r.hasAttribute("ymailto")&&(i=r.getAttribute("ymailto")),i&&i.length>0&&(t.preventDefault(),e.use("mail-ui-shortcuts",function(e){e.mail.ui.ShortCuts.composeMailToMessage(i)})),n.test("a[rel=nofollow]")?(n.setAttribute("rel","noreferrer"),t.preventDefault(),n.simulate("click")):r.test("a[rel=nofollow]")&&(r.setAttribute("rel","noreferrer"),t.preventDefault(),r.simulate("click"))}e.namespace("mail.ui");var t=e.mail,n=function(){};e.mix(n.prototype,{bindPaneContent:function(){},onSuccess:function(){},setFullFormatters:function(){},postRender:function(){},downloadAttachment:r,downloadAllAttachments:i,loadOptions:o,markAsRead:u,handleBodyLinkClick:a}),e.mail.ui.MailPaneRead=n},"1.0.0",{requires:["mail-ui-common-string-utils","common-utils","common-utils-stats","mail-controller-base"]});
YUI.add("mail-ui-messagepane-warnings",function(e){function r(e){return window.confirm(t([n.str_warning_msg_read_form_part1,n.str_warning_msg_read_form_part2].join("  "),n))&&e.submit(),!1}function i(e){return e.rel==="nofollow"?!0:strings.str_cfg_tog_exlink_alert_page?(window.open(strings.str_cfg_url_exlink_alert_page+encodeURIComponent(e),"new"),!1):(window.confirm(t([n.str_warning_msg_read_link_part1,n.str_warning_msg_read_link_part2,n.str_warning_msg_read_link_part3].join("  "),n))&&window.open(e.href),!1)}function s(e){e.warningShown||(window.alert(t([n.str_warning_msg_read_password_part1,n.str_warning_msg_read_password_part2].join("  "),n)),e.warningShown=1)}e.namespace("mail.ui");var t=e.common.Utils.substitute,n=strings;e.mail.ui.Warnings={showFormWarning:r,showLinkWarning:i,showPasswordWarning:s},window.theMainWindow=e.mail.ui.Warnings},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-ui-convpane-read",function(e){function K(t,n){var r=[];return e.Array.each(t.slice(n,t.length),function(e){r.push(e.email)}),r.join(",")}function Q(e){var t={to:p.getName(e),rcpt_id:p.getAddress(e),rcpt_name:p.getName(e),show_hovercard:z===!0?"hcard":""};return t}function G(e,t,n,i){var s=e&&e.header,o=f.recipient_list,u=f.more_recipients_str,a=f.hide_recipients_str,l="",c=["to","cc","bcc"],h,d,v,m,g,y,b;i=i||[];if(s){for(d=0;d<c.length;d++)v=c[d],b=s[v]||[],h=f[v+"_group"],g=i[v]||!1,y=g?"":n+1===b.length?b.length:n,b.length&&(m={recipients_built:p.createRecipientList(b,o,t,y,Q,""),hide:W&&g&&(!y||b.length>parseInt(y,10))?r(a,{data_field:v},0,0,strings):"",more_built:!g&&b.length>parseInt(y,10)?r(u,{num_more_recipients:b.length-y,data_address:K(b,y),data_field:v,show_hovercard:z===!0?"hcard":""},0,0,strings):""},l+=r(h,m,null,null,strings));return l}}function Y(){e.fire("recalculateScrollToRepositionSend")}function Z(e){var t=this,n=e.srvmap,r,i,s="";if(!n){i=t.inboxservices||[],e.srvmap=n={};for(r=i.length-1;r>=0;r--)n[i[r].name]=i[r].value}return!strings.str_cfg_tog_certified_icon&&n.crt&&delete n.crt,(F||!n.crt)&&(n[j]||n.siu||t.msgicon)&&(n&&n[j]?s=I[n[j]]||"":t.msgicon&&(s=t.msgicon)),NeoConfig.isSSL&&s==="certified"&&(s="certified-ssl"),n.inboxService=s,s}function et(t,o,a,l,c,h){t||n.report("Shouldn't come into getMsgMarkUp with empty message");if(!t.header)return;var d=this,v=d.message,m=t.flags.hasAttachment,g,b=d.getMsgFid(t),w=b==="Draft"?!0:!1;return g={from:function(){var e=t.header.from;if(e){var n={from_name:p.getName(e),from_id:p.getAddress(e),show_hovercard:z===!0?"hcard":""};return r(f.from,n,null,null,strings)}},moneyball_native_format_flag:function(){var e=!1,n=t.header.from.email,r=O.value("mbNativeSender"),i=M.enabled("mbListNativeView");return n===r&&i&&(e=!0),e?f.moneyball_native_format_flag:""},super_collapsed:function(){return c?f.super_collapsed:""},isFlagged:function(){return t.flags.isFlagged?f.isFlagged:""},isFlagged1:function(){return t.flags.isFlagged?r(f.isFlagged1,null,null,null,strings):""},isFlagged2:function(){return t.flags.isFlagged?r(f.isFlagged2,null,null,null,strings):""},isFlagged_else:function(){return t.flags.isFlagged?"":r(f.isFlagged_else,null,null,null,strings)},isFlagged_else1:function(){return t.flags.isFlagged?"":r(f.isFlagged_else1,null,null,null,strings)},isUnread:function(){return t.flags.isRead?"":f.isUnread},inConvReplyBucket:function(){return U?f.inConvReplyBucket:""},snippet:function(){var n;return typeof t.snippet=="string"?n=t.snippet:t.header&&typeof t.header.snippet=="string"?n=t.header.snippet:n="",s(u(e.Lang.trim(n)))},expanded:function(){return o?f.expanded:""},ariaExpanded:function(){return o?"true":"false"},expanded_else:function(){return o?"":f.expanded_else},date:function(){var e=t.header.receivedDate*1e3;return!e&&d.getMsgFid(t)==="Sent"&&(e=t.header&&t.header.sentDate*1e3),n.dateFormatter(new Date(e),Neo.getDateFormat(e,!1,!0))},received_date:function(){return t.header.receivedDate?n.dateFormatter(new Date(t.header.receivedDate*1e3),strings.str_tog_dateformat_header_long_l10n):""},hasAttachmentDownload:function(){return m?r(f.hasAttachmentDownload):""},thread_reply:function(){return r(f.thread_reply,null,g,null,strings)},mid:function(){return y(t.mid)||""},hasDraft:function(){return w?r(f.hasDraft,null,null,null,strings):""},hasDraft1:function(){return w?r(f.hasDraft1,null,null,null,strings):""},hasDraft2:function(){return w?r(f.hasDraft2,null,null,null,strings):""},hasDraft_else:function(){return w?"":r(f.hasDraft_else,null,g,null,strings)},hasAttachment:function(){return m?r(f.hasAttachment,null,null,null,strings):""},recipients:function(e,n){return t=e||t,G(t,g,X,n)},ariaStr:function(n,i){var s=[],o=[],u=strings.str_thread_to_recipients,a,f,l=0,c;return t=n||t,t.header&&(s=t.header.to||[],s=s.concat(t.header.cc||[]),s=s.concat(t.header.bcc||[]),e.Array.each(s,function(e){o.push(p.getName(e))}),a=o.length,a&&(!i&&a>3&&(o=o.slice(0,3),l=a-3),f=o.join(strings.str_thread_to_concatenate_recipients_delimiter)),u=r(u,{recipients:f}),l&&(c=r(strings.str_thread_hdr_more_recipients_btn,{number:l}),u+=", "+c)),u},thread_attachments:function(){return m?r(f.thread_attachments,null,g):""},msg_blocked:function(){if(!o)return;return p.getBlockedMsgMarkup(t,f,g)},msg_has_photo_attachment:function(){var e=t,n=e?e.imgAttachments||[]:[];return n.length?r(f.msg_has_photo_attachment,e,g,null,strings):""},attached_photos:function(){return p.getAttPhotosMarkup(t,f,g)},msg_has_attachment:function(){var e=t,n=e?e.nonImgAttachments||[]:[];return!d.isChat(e)&&n.length?r(f.msg_has_attachment,e,g,null,strings):""},hide_attachments_else:function(){return r(f.hide_attachments_else,t,g,null,strings)},attached_files:function(){return p.getAttFilesMarkup(t,f,g)},msg_loading:function(){return t.loading_slow||t.loading_error||t.loading_moved?r(f.page_loading,null,g,null,strings):""},loading_error:function(){return t.loading_error?d.getFailureMarkup(t):""},msg_truncated:function(){return t.body&&t.isTruncated&&!d.disableTruncate?r(f.msg_truncated,null,null,null,strings):""},isInternal:function(){return NeoConfig.showFeedback?r(f.isInternal,null,null,null,strings):""},unsubscribe:function(e){return n.Features.enabled("unsubscribr")?r(e.unsubscribe,0,0,0,strings):""},flag_info:function(){var e=v&&v.srvmap&&v.srvmap.inboxService,t=e?"info-"+e:"";return t},flag_info_hover:function(){var e=v&&v.srvmap&&v.srvmap.inboxService,t=e==="certified"||e==="certified-ssl"?"info-"+e:"info-unread";return t},status_title:function(){var e=v&&v.srvmap&&v.srvmap.inboxService,n=e==="certified"||e==="certified-ssl"?r(strings.str_msg_list_info_verified_attr,strings):"";return n===""&&t&&t.flags&&(n=t.flags.isRead?strings.str_msg_list_click_mark_as_unread:strings.str_msg_list_click_mark_as_read),n},mark_unread:function(){var e="";return t&&t.flags&&(e=t.flags.isRead?strings.str_msg_list_read:strings.str_msg_list_unread),e},loadhide:function(){return h?r(f.loadhide
,null,g,null,strings):""},inConvReplyBucketBorder:function(){return U?f.inConvReplyBucketBorder:""},inConvReplyBucketWithIcons:function(){return U&&NeoConfig.expBucketId==="CMUSCVRT3"?f.inConvReplyBucketWithIcons:""},with_icons:function(){return NeoConfig.convBtmIcons?r(f.with_icons,null,g,null,strings):""},with_icons_else:function(){return NeoConfig.convBtmIcons?"":i(f.with_icons_else)}},d.messageFormatter||(d.messageFormatter=g),d.getInboxService(v),l?r(f.thread_reply,null,g,null,strings):r(f.thread_item,null,g,null,strings)}function tt(){var t=this,n=function(e){var n=e.s||"",i=e.o||0,s=e.f||t.readFormatters,o=e.a||0,u=e.strs||strings;return r(n,i,s,o,u)};t.showDetails=A.get("neo.pref.showHeaderDetails"),this.readFormatters={anyUnread:function(){var e=t.message;return e.totalUnread>0?f.anyUnread:""},anyFlagged:function(){var e=t.message;return e.totalFlagged>0?f.anyFlagged:""},anyFlagged1:function(){var e=t.message;return e.totalFlagged>0?r(f.anyFlagged1,null,null,null,strings):""},anyFlagged2:function(){var e=t.message;return e.totalFlagged>0?r(f.anyFlagged2,null,null,null,strings):""},anyFlagged_else:function(){var e=t.message;return e.totalFlagged<=0?r(f.anyFlagged_else,null,null,null,strings):""},anyFlagged_else1:function(){var e=t.message;return e.totalFlagged<=0?r(f.anyFlagged_else1,null,null,null,strings):""},ariaLabelStrMsgHeaderUnread:function(){var e=t.message;return e.totalUnread>0?strings.str_msg_list_convUnread:strings.str_msg_list_convRead},titleStrMsgHeaderUnread:function(){var e=t.message;return e.totalUnread>0?strings.str_msg_list_conv_click_mark_as_read:strings.str_msg_list_conv_click_mark_as_unread},qr_bar:function(){return r(f.qr_bar,{},t.readFormatters,null,strings,a)},popoutToolbar:function(){return $?f.popoutToolbar:""},show_formatter_well:function(){return $?"":r(f.show_formatter_well,{},t.readFormatters,null,strings,a)},show_popout_toolbar:function(){return $?r(f.show_popout_toolbar,{},t.readFormatters,null,strings,a):""},show_attachment_icon:function(){return NeoConfig.useAttComposerTT?r(f.show_attachment_icon,{},t.formatters,null,strings,a):""},spellCheckEnabled:function(){return M.enabled("spellCheck")?r(f.spellCheckEnabled,{},t.readFormatters,null,strings,a):""},thread_item:function(){var r,i=t.message,s=!0,o="",u,a,l=!1,c=0,h=0,p=0,d=0,v=!1;if(t.loading_error||!i.cid)return"";u=i.msgs,a=u&&u.length;if(a!==i.totalMsgs)return"";for(r=0;r<a;r++){var m=u[r],g,b=y(m.mid);if(e.Lang.isUndefined(m.header))return;r!==0&&r!==a-1&&h++,g=m.body?!0:!1,t.midObjMap[b]=r,t.fid==="Sent"?(m.fid==="Sent"&&r<_?(l=!1,d++):r>=_&&!l&&m.fid!=="Sent"?l=!1:r>=_&&!d&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!d&&a>_&&(l=!0)):t.fid==="Draft"?(m.fid==="Draft"&&r<_?(l=!1,p++):r>=_&&!l&&m.fid!=="Draft"&&u[r+1]&&u[r+1].fid!=="Draft"?l=!1:r>=_&&!p&&u[r+1]&&u[r+1].fid==="Draft"&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!p&&a>_&&(l=!0)):(!m.flags.isRead&&r<_?(l=!1,c++):r>=_&&!l&&m.flags.isRead?l=!1:r>=_&&!c&&(l=!0,r<a-1&&h--),r===a-1&&!l&&!c&&a>_&&(l=!0)),l&&!t.submessage&&!t.midtocid&&!v&&(o+=n({s:f.super_collapsed_btn,o:{collapsed_msg_count:h}}),v=!0),o+=t.getMsgMarkUp(m,g,null,null,!1,s)}return o},message_selection:function(){var e=t.numSelected>0&&!t.message?n({s:f.message_selection}):"";return e},message_selection_else:function(){return t.numSelected===1&&t.message?n({s:f.message_selection_else}):""},multiple_selected_msgs:function(){return t.numSelected>1?n({s:f.page_conversation_history,o:{num_selected_msgs:t.numSelected}}):""},num_selected_msgs:function(){return t.numSelected},multiple_selected_msgs_else:function(){return t.numSelected===1?n({s:f.page_conversation_history1}):""},folder_message:function(e){var r=e||t.message;if(t.loading_error||!r.cid)return;return n({s:f.folder_message,o:r})},folder_message1:function(e){var r=e||t.message,i=r&&r.header;return i&&(i.subject||i.to&&i.to[0]||i.from.name)?n({s:f.folder_message1,o:r}):""},expanded:function(){return t.showDetails?f.expanded:""},mail_search_enabled:function(e){var r=e||t.message;return strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===!1||!(r&&r[0]&&r[0].subject)?"":n({s:f.mail_search_enabled})},mail_search_enabled1:function(e){var r=e||t.message;return strings.str_cfg_tog_mailSearchEnabled!==undefined&&strings.str_cfg_tog_mailSearchEnabled===!1||!(r&&r[0]&&r[0].subject)?"":n({s:f.mail_search_enabled1})},msg_subject:function(){var n=e.mail.Tabs,r=p.getMsgSub(t.message),i,s;return t.loading_error&&(i=n.getActiveTab(),i&&i.prevTabId&&(s=n.getTabById(i.prevTabId),s&&s.widgetType==="search"&&(r=r.split("^_").join("")))),r},msg_subjectDir:function(){return p.getMsgSubDir(t.message)},page_loading:function(){return t.loading_slow||t.loading_error||t.loading_moved?n({s:f.page_loading}):""},conv_loading:function(){return t.loading_error?"":n({s:f.conv_loading})},nav_arrows:function(){return n({s:f.nav_arrows})},summary:function(){var e=t.message,n=e.totalMsgs;return n>1?"("+n+")":""},inConvReplyBucketBorder1:function(){return U?f.inConvReplyBucketBorder1:""},inConvReplyBucketBorder2:function(){return U?f.inConvReplyBucketBorder2:""},inConvReplyBucketBorder3:function(){return U?f.inConvReplyBucketBorder3:""},inConvReplyBucketClass:function(){return U?f.inConvReplyBucketClass:""},inConvReplyBucketDummy:function(){return U||M.enabled("messageReadPaneV2")?r(f.inConvReplyBucketDummy,null,null,null,strings):""},inConvReplyBucketDummy_else:function(){return U||M.enabled("messageReadPaneV2")?"":r(f.inConvReplyBucketDummy_else,null,null,null,strings)},notInMessageReadPaneV2:function(){return M.enabled("messageReadPaneV2")?"":f.notInMessageReadPaneV2}},t.setFull=1}function nt(t,r,i,s){var u=this,a,l=n.Stopwatch.get("MsgInPreview")||u.stopwatch,c=t&&t.cid,h,d,v,g,w,E,S=!1,x=[];u.wasCached=r||"";try{l&&l.start(3,"OnSuccessLMTRender"),clearTimeout(u.loadingTimer);if(c&&u.message&&(u.message.cid&&b(u.message.cid)===b(c)||u.midtocid&&e.Lang.isValue(u.getMessageIdxByMidLookup(u.midtocid,t.msgs,!0)))){u.loading_moved=0,u.resetRequestLoadingState
(!1),u.inboxservices=u.message.inboxservices||u.message.msgs&&u.message.msgs[0]&&u.message.msgs[0].inboxservices,u.msgicon=u.message.msgicon,u.midtocid?(u.message=t,S=!0):(u.message=t,u.allMsgsInConvInfo=t.msgs),u.message.toggleState="expanded";if(s&&t.fullmsg.mid){v=u.getMessageIdxByMidLookup(t.fullmsg.mid,u.message.msgs),t.fullmsg.cid=t.cid,t.fullmsg.header.snippet=t.msgs[v].header.snippet,t.fullmsg.fid=u.getMsgFid(t.msgs[v]),u.message.msgs[v]=t.fullmsg,u.primaryMid=t.fullmsg.mid,x.push(u.message.msgs[v]);for(d=0;d<x.length;d++)a=m.getQueryParams(x[d],"midRequest"),x[d].blockImages=a&&a.blockImages,E=u.midObjMap[y(x[d].mid)],p.extractQuotedText(x[d],f.quoted_text_collapse,f.quoted_text_expand,q,E)}u.setRefreshTimer(),u.fireEvent("getSuccess"),u.render(r);if(s&&v!==undefined&&v>=0){u.showMessages(v,[u.message.msgs[v]],!1,!1,l,S,!1,!1);if(!NeoConfig.hasConvV3)return}l&&l.start(1,"ThreadMsgRead"),w=u.submessage?u.submessage:u.midtocid?{mid:u.midtocid}:s&&t.fullmsg?t.fullmsg:u.message.msgs[u.message.msgs.length-1],v=u.getMessageIdxByMid(w.mid),g=u.getMsgNodeByMid(w.mid),w.fid==="Draft"?u.showMessages(v,[u.message.msgs[v]],!1,!1,l,!1,!1,!0):u.submessage?u.expandMessages(v,"adjacent","no",!0,{scroll_to_msg:!0},l,!0):u.midtocid?s||u.expandMessages(v,"one",!1,!0,{scroll_to_msg:!0},l,!0):u.fid==="Sent"?s?u.expandMessages(v,"other-send",!1,!0,null,l,!0):u.expandMessages(v,"send",!1,!0,null,l,!0):u.fid==="Draft"?u.expandMessages(v,"draft",!1,!0,null,l,!0):s?u.expandMessages(v,"other-unread",!1,!0,{no_focus:!0},l,!0):u.expandMessages(v,"unread",!1,!0,{no_focus:!0},l,!0),o.stat("convread","result=>success,env=>"+NeoConfig.mailEnv)}else t||u.loadExtra(function(){this.onFailure({msg:u.message,reason:h},i)},1)}catch(T){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1",T,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:1")}}function rt(){return this.activeComposeWidget.cv.view}function it(t){var n=this,r,i,s;n.activeComposeWidget&&n.activeComposeWidget.cv.view!==t&&n.activeComposeWidget.cv.view.save(),n.activeComposeWidget=null;for(r in n.composeWidgets)s=n.composeWidgets[r].cv.view,i=n.getComposeNodeByMid(r),s===t&&(n.activeComposeWidget=n.composeWidgets[r],i&&i.addClass("active"),e.fire("draftCardAdded"),Y(),!NeoConfig.smartscroll&&n.composeAction&&i&&(n.listNode.set("scrollTop",i.get("offsetTop")-10),n.composeAction=!1))}function st(e){var t=this,n,r,i,s,o,u=[],a=0;for(r in t.composeWidgets)i=t.composeWidgets[r].cv.view,i.get("dirty")&&u.push(i);if(u.length<=0)e&&e(!0);else{s=function(t,n){n.detach("compose:saveFail",o),n.dirty=!1,a--,a===0&&e&&e(!0)},o=function(t,n){n.detach("compose:saveSuccess",s),n.dirty=!0,e&&e(!1)},a=u.length;for(n=0;n<u.length;n++)i=u[n],i.once("compose:saveSuccess",s,null,i),i.once("compose:saveFail",o,null,i),i.save()}}function ot(){var e=this,t,n;t=e.composeWidgets;for(n in t)t[n].cv.view.closeCompose()}function ut(t,n){var r=this,i;if(r.convUserUnread||r.msgUserUnread&&r.msgUserUnread[y(n.mid)]||!r.get("active"))return;if(n&&!r.loading_slow&&!r.loading_error&&!r.loading_moved&&!n.flags.isRead){i=parseInt(e.mail.persist.MetaData.get("cg.pref.general.markasreadinterval"),10);if(i!==999)return i=i?i*1e3:750,isNaN(i)&&(i=750),i===0&&(i=100),r.flagMsgList.push({fid:t,msg:n}),e.use("mail-controller-messages-ops",function(){r.tmFireRead&&(clearTimeout(r.tmFireRead),r.tmFireRead=null),r.tmFireRead=setTimeout(function(){e.Array.forEach(r.flagMsgList,function(e){r.markAsReadBatch(e.fid,e.msg)}),r.readBatch&&r.readBatch.execute({suppressCodes:["*"]}),r.readBatch=null,r.flagMsgList=[]},i)}),!0}return!1}function at(e,t){var n=this;n.readBatch=n.readBatch||l.Controller.batch(),n.readBatch.Messages.flag({fid:e,mid:t,setFlags:{read:1},enableRetry:!0})}function ft(t,n,r){var i=this;try{n&&n.ancestor("body")?i.neoFire("rendered",[],t,n,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},r):i.once("convAddedToDOM",function(){n.ancestor("body")||(n=i.getMsgNodeByMid(t.mid)),i.neoFire("rendered",[],t,n,{headerClassName:"thread-body",insertPos:"append",att:{container:".thread-body",insertPos:"append"},rsvp:{container:".thread-item-header .contents",insertPos:"append"}},r)},n),n&&i.inspectMessageForBadContent(n,t)}catch(s){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2",s,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:2")}M.enabled("selectToSearch")&&e.use("mail-ui-pane-utils-s2s",function(e){e.mail.ui.PaneUtils.handleS2S(i)})}function lt(t){var n=this,r=n.listNode,i,s,o,u=e.ACWidgetInst;if(!r)return;i=r.get("scrollTop"),s=r.get("offsetHeight"),o=r.all("."+x),!t&&u&&u.isVisible()&&u.hide(),o.size()>1&&n.checkAdsOnScroll(i,s),clearTimeout(n.markAsReadTimer),n.markAsReadTimer=setTimeout(function(){n.checkMsgCardsOnScroll(o,t)},200)}function ct(t,n){var r=this,i=window.DARLA,s,o,u=200;e.Lang.isNumber(r.prevY)||(r.prevY=t),r.scrollAdTimer&&clearTimeout(r.scrollAdTimer),i&&(i.inProgress()||(s=Math.abs(r.prevY-t),o=n*i.scrollThreshold,s>o&&(r.scrollAdTimer=setTimeout(function(){e.mail.ui.darla.fireDarlaOnScroll(),r.prevY=t},u))))}function ht(t,n){if(M.enabled("markExpandedAsRead"))return;var r=this,i,s,o,u;r.message&&(s=r.message.msgs);if(!t||!s)return;i=t.size();for(u=0;u<i;u++)o=t.item(u),o.hasClass(T)&&o.hasClass(N)&&o.inRegion(r.listNode)&&(r.markConvMsgAsRead(r.getMsgFid(s[u]),s[u]),n&&e.fire("MailLog",{m:"Marking message as read silently",cid:s[u].cid,mid:s[u].mid}))}function pt(){var e=this,t=e.listNode,n="has-scrolled";!M.enabled("messageReadPaneV2")&&t&&(t.get("scrollTop")>B?e.hdr.addClass(n):e.hdr.removeClass(n)),e.scrollTimer&&window.clearTimeout(e.scrollTimer),e.scrollTimer=window.setTimeout(function()
{e.onPaneScroll()},200)}function dt(){var e=this,t=this.getRoot();e.listNode=t.one(".thread-item-list");if(!e.listNode||!e.message)return;e.listNode.on("scroll",pt,e)}function vt(e){var t=null,n,r,i=!1;if(!e||!e.getDOMNode())return;t=e.one(".msg-truncated");if(!t)return;n=e.all(".thread-quoted-body"),r=n&&n.size()>0,r&&(i=n.item(0).hasClass("expanded")),r&&!i?t.hide():t.show()}function mt(e,t,n){var r=!1;if(!(t&&t.getDOMNode()&&e.isTruncated&&t.one(".body")))return;r=d.hasOnlyNonDisplayableContent(t.one(".body")),r&&!this.loadingTrucatedMsg&&(this.loadingTrucatedMsg=!0,this.viewFullMsg(e,n),t.one(".msg-truncated").hide(),t.one(".body").setContent('<div class="s-loader"></div>'))}function gt(){var t=this,r=this.getRoot();t.listNode=r.one(".thread-item-list"),t.rteActiveHandler=e.on("compose:rte:active",function(n){n.cv.getDraftMID()&&(n.cv.scrollFocus=!1),e.later(0,t,t.setActiveCompose,[n.cv])}),t.after("activeChange",function(e){var t=this;e.newVal||t.saveDraftAction(null,!0)}),t.on("activeChange",function(e){e.newVal&&t.refreshOnActive&&t.updatePaneContent()}),t.on("closeChange",function(e){e.newVal&&t.closeAllCompose()}),t.threadHeaderHandler=r.delegate(["click","keydown"],function(r){if(r.type==="keydown"&&r.keyCode!==13)return;var i;r.stopPropagation();var s,o=n.getDataAction(r).action,u=t.message,a=r.target;i="";switch(o){case"thread-flag":s=u.totalFlagged?"unflagged":"flagged",i=u.totalFlagged?"unflag_thrd_hdr":"flag_thrd_hdr",t.handleUI(u,s);break;case"thread-unread":s=u.totalUnread?"read":"unread",i=u.totalUnread?"read_thrd_hdr":"unread_thrd_hdr",s==="unread"?(t.convUserUnread=!0,r.target.setAttribute("aria-label",strings.str_msg_list_convUnread),r.target.setAttribute("title",strings.str_msg_list_convRead_attr)):(r.target.setAttribute("aria-label",strings.str_msg_list_convRead),r.target.setAttribute("title",strings.str_msg_list_convUnread_attr)),t.handleUI(u,s);break;case"thread-toggle":s=u.toggleState==="expanded"?"collapse":"expandall",t.handleToggleAllMessageCards(a,s,u,t.getMsgFid(u));break;case"update":t.saveDraftAction(function(){t.loadPaneContent(7,null,{force:!0},null)})}i&&e.fire("mt:click",{action:i})},w),r.delegate(["focus","blur"],function(e){e.type==="focus"?e&&e.currentTarget&&!e.currentTarget.hasClass("thread-focus")&&(e.currentTarget.addClass("thread-focus"),e.currentTarget.hasClass("thread-item")&&(t.selNode=e.currentTarget)):e.type==="blur"&&e&&e.currentTarget&&e.currentTarget.hasClass("thread-focus")&&(e.currentTarget.removeClass("thread-focus"),e.currentTarget.hasClass("thread-item")&&(t.selNode=null))},".thread-item, .add-to-conv, .supercollapsed"),t.threadItemHandler=r.delegate(["click","keydown"],function(r){if(!(r.type!=="keydown"||r.keyCode===13&&!r.target.hasClass("recipients")))return;r.type==="keydown"&&r.stopPropagation(),r.target.getAttribute("href")==="#"&&r.halt(),e.fire("as:close-window-click",r);var i,s,o,u,a=r.target,f=a.get("parentNode"),c=r.currentTarget,h=n.getDataAction(r).action,p=a.hasClass("thread-item")?a:a.ancestor(".thread-item",!0),d,v,m,g=t.message.msgs,y,b=r.type==="keydown";(f.get("nodeName")==="A"||a.get("nodeName")==="A")&&t.handleBodyLinkClick(r),p&&(m=p.getAttribute("data-mid"),m&&(d=t.getMessageIdxByMid(m),v=g[d],t.selNode=p)),h==="contact-card-menu"&&!p.hasClass("expanded")&&(h="select-thread"),o="",e.fire("MailLog",{m:"Initializing Action from Conversation Pane",action:h});switch(h){case"thread-super-collapse":t.expandSuperCollapsedNodes();break;case"select-thread":if(a.hasClass("thread-item")&&b||(a.hasClass("thread-item-header")||a.ancestor(".thread-item-header")||a.hasClass("thread-item")&&!p.hasClass("expanded"))&&!a.hasClass("more_recp")&&!a.hasClass("info-hover")&&!a.hasClass("flag"))p.hasClass("expanded")?!p.hasClass("collapsing")&&!p.hasClass("expanding")&&(t.collapseMessage(p),o="collapse_thrd_msg_hdr",t.selNode=p,t.focusMessageCard()):(e.fire("MessagePane:expandClick",{cid:t.message.cid,mid:v.mid}),t.selNode!==p&&(t.selNode=p,t.focusMessageCard()),t.expandMessageTimers[m]=e.later(5e3,null,function(){var r={yid:NeoConfig.loginId,cid:t.message.cid,mid:v.mid};n.netError("Expand Message Failed:"+e.JSON.stringify(r))}),t.expandMessages(d,"one","yes",!1),o="expand_thrd_msg_hdr");break;case"quoted-text":var w,E=p.all(".thread-quoted-body"),S,x,T=p.one(".thread-quoted-body");E&&E.size()>0&&(w=!E.item(0).hasClass("expanded"),o=w?"expand_qtd_thrd_msg":"collapse_qtd_thrd_msg",S=p.one(".thread-quoted-text"),S&&(S.one(".icon").toggleClass("icon-chevron-down"),S.one(".icon").toggleClass("icon-chevron-right"),e.fire("ToolTips:hideTooltips"),S.one(".qtd-expansion-text").set("text",w?strings.str_qtd_collapse:strings.str_qtd_expand),S.one(".qtd-expansion-text").set("aria-label",w?strings.str_qtd_collapse:strings.str_qtd_expand),S.setAttribute("title",w?strings.str_qtd_collapse:strings.str_qtd_expand)),E.each(function(t){w?(t.addClass("no-transition"),t.setStyles({display:"block",transition:""}),x=parseInt(t.getComputedStyle("height"),10)+"px",t.setStyle("height",0),t.removeClass("no-transition").addClass("expanded"),e.later(0,t,t.setStyle,["height",x]),e.later(200,null,function(e){Y(),e.setStyles({transition:"none",height:"auto"})},[t])):(x=parseInt(t.getComputedStyle("height"),10)+"px",t.setStyle("transition",""),t.setStyle("height",x),t.removeClass("expanded"),e.later(0,t,t.setStyle,["height",0]),e.later(200,null,function(e){Y(),e.setStyles({display:"none",height:"auto"})},[t]))}),vt(p),w?e.later(0,null,function(){T.setAttribute("role","gridcell"),T.setAttribute("tabindex","0"),T.focus()}):T.setAttribute("tabindex",-1));break;case"thread-item-flag":i=v.flags.isFlagged?"unflagged":"flagged",o=v.flags.isFlagged?"unflag_thrd_msg_hdr":"flag_thrd_msg_hdr",t.handleUI(v,i);break;case"thread-item-delete":i="delete",t.handleUI(v,i);break;case"thread-item-unread":i=v.flags.isRead?"unread":"read",i==="unread"&&(t.msgUserUnread||(t.msgUserUnread={}),t.msgUserUnread[m]=!0),o=v.flags.isRead?"unread_thrd_msg_hdr":"read_thrd_msg_hdr",t.handleUI(v,
i);break;case"reply_all":case"reply_sender":case"forward":case"thread-item-replyall":s={},s.action=h==="thread-item-replyall"?"reply_all":h,e.fire("rc:flow",{name:h}),h==="thread-item-replyall"?o="quick_reply_all_thrd_msg":c.hasClass("add-to-conv")?o="quick_"+h+"_tlbr_thrd_msg":o=h+"_thrd_msg",v||(d=g.length-1,v=g[d]),t.composeAction=!0,NeoConfig.useAttComposerTT&&(!e.Tictac||!e.Tictac.attach)?e.once("tictacs-loaded:ws:postLoad",function(){t.initReplyForward(s.action,v)}):t.initReplyForward(s.action,v);break;case"edit-to":t.composeWidgets[m]&&(p.one(".thread-reply-to").setStyle("display","none"),p.one(".thread-reply-to-edit").setStyle("display","block"));break;case"menu":p.hasClass("quickReply")||(t.loadMenu(r,v,p,d),o="actnMnu_thrd_msg");break;case"show-images":t.unblockImages(v,d),o="show_images_thrd_msg";break;case"mail-options":t.loadOptions(),o="options_thrd_msg";break;case"attach-download-all":case"attach-download-all-photos":var N=h==="attach-download-all-photos"?"image":"non-image";t.downloadAllAttachments(N,r,v);break;case"attach-download":var C=0,k="";c&&(C=c.get("id"),k=c.getAttribute("tnefid")),t.downloadAttachment(C,k,v);break;case"retry-msg-load":t.expandMessages(d,"one","yes",!1),o="retry_thrd_msg";break;case"retry-conv-load":t.retryLoad(),o="retry_thrd_hdr";break;case"view-full-msg":t.viewFullMsg(v,d);break;case"thread-item-edit":s={},s.action="edit",e.fire("editMessage",e.mix(s,{fid:t.getMsgFid(v),oMsg:v}));break;case"contact-card-menu":M.enabled("lozengeContactCard")||e.use("contacts-ui-contact-popup",function(){var t=a.getAttribute("data-name"),n=a.getAttribute("data-address"),r=l.ContactPopup.TYPE_INTERMEDIATE,i=a;l.ContactPopup.showContactMenu(r,i,{email:n,name:t,editable:!1,copyable:!0}),i.menu&&i.menu.getMenuNode().on("menu:state",function(t){t.state==="hide"&&!e.common.Utils.isControlActive()&&i.focus()})});break;case"hide":y=a.getAttribute("data-field"),V[y]=!1,p.one(".recipients").set("innerHTML",t.messageFormatter.recipients(v,V)),p.one(".recipients").setAttribute("aria-label",t.messageFormatter.ariaStr(v,!0)),p.one(".recipients").setAttribute("title",t.messageFormatter.ariaStr(v,!0));break;case"more":y=a.getAttribute("data-field"),V[y]=!0,p.one(".recipients").set("innerHTML",t.messageFormatter.recipients(v,V)),p.one(".recipients").setAttribute("aria-label",t.messageFormatter.ariaStr(v,!0)),p.one(".recipients").setAttribute("title",t.messageFormatter.ariaStr(v,!0)),e.later(0,null,function(){p.one(".recipients").focus()}),e.mail.e2e&&e.mail.e2e.hasStarted&&e.mail.e2e.hasStarted()&&e.mail.e2e.isValid()&&e.mail.e2e.installReadGlass()}e.fire("ConvPane",h),u={action:o,append:{t1:"thrdRdTb"}},o&&e.fire("mt:click",u)},".thread-item, .msg-attachments .file-attach li, .conv-loadingpane, .supercollapsed, .add-to-conv"),e.on("ds:conv:change",function(){}),e.on("ds:folder:rename",function(e,n){var r,i=0;if(t&&t.message&&t.message!==null){r=t.message.msgs;if(e.folderInfo.fid===t.message.fid){t.message.fid=n.folderInfo.fid;for(i=0;i<r.length;i++)e.folderInfo.fid===r[i].fid&&(r[i].fid=n.folderInfo.fid,r[i].folderInfo&&r[i].folderInfo.fid!==undefined&&(r[i].folderInfo.fid=n.folderInfo.fid),r[i].sourceFolderInfo&&r[i].sourceFolderInfo.fid!==undefined&&(r[i].sourceFolderInfo.fid=n.folderInfo.fid))}}}),t.refreshHandler=e.on("ds:conv:refresh",function(r,i,s){var o,u,a,f=!0,l,c;if(!t.message||!t.message.cid)return;u=b(t.message.cid),r==="lft"?o=s[u]:r==="lmt"&&s[0]&&b(s[0].cid)===u&&(o=s[0],f=!1,a=o.checksum);if(o){l=t.lftCongruencyCheck(o,t.message);if(l)if(!t.fullView&&!t.get("active"))t.saveDraftAction(function(){try{t.loadPaneContent(8,null,{force:f,checksum:a},null)}catch(i){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3",i,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:3"),e.use("common-utils-error",function(){n.error.report("loadpane convpanerefresherror "+r,i,1,1,1)})}});else{if(r!=="lmt"||!t.currentLmtContext||!(t.currentLmtContext.draftMID||t.currentLmtContext.newMsg&&t.currentLmtContext.newMsg.fid==="Draft"))c=t.getRoot().one(E)||t.getRoot().one(S),c&&c.replace('<span class="badge" data-action="update">'+l+"</span>");t.setRefreshTimer()}}}),t.newMessageHandler=e.on("newConvMessage",function(e){t.composeAction=!0,t.get("active")&&t.initReplyForward(e.action,e.oMsg)}),t.eventsBound=!0}function yt(e,t){var n=!0;return e.totalMsgs>t.totalMsgs?(n=!1,e.totalMsgs-t.totalMsgs):0}function bt(e,t,n){var r,i,s={oldIdx:-1,newIdx:-1,remainder:!0};r=i=0;while(r<e.msgs.length||i<t.msgs.length)r<e.msgs.length&&n.draftMID&&y(e.msgs[r].mid)===y(n.draftMID)?(s.oldIdx=r,r++):i<t.msgs.length&&y(t.msgs[i].mid)===y(n.newMsg.mid)?(s.newIdx=i,i++):(i<t.msgs.length&&r<e.msgs.length&&y(e.msgs[r].mid)!==y(t.msgs[i].mid)&&(s.remainder=!1),r++,i++);if(r!==e.msgs.length||i!==t.msgs.length)s.remainder=!1;return s}function wt(){var e=this,t=e.listNode;t.all(".super-hidden").removeClass("super-hidden"),t.one(".supercollapsed")&&t.one(".supercollapsed").remove()}function Et(t){var n=this,r,i=t||n.message,s=i.totalMsgs,o,u="",a,f,l,c,h,p,d=e.one("#inboxcontainer"),v=d.hasClass("prevPaneVisible")&&!d.hasClass("offscreen"),m=[],g;n.composeWidgets=[];for(r=0;r<s;r++){var y=i.msgs[r];y&&y.fid==="Draft"&&m.push(r)}for(r=0;r<m.length;r++){g=m[r],a=i.msgs[g],c=!0;if(!a.oMsgMid){var b=n.getMessageIdxByMid(a.mid);if(b>0)for(var w=b-1;w>=0;w--)if(a.inReplyTo===i.msgs[w].mimeMsgId){a.oMsgMid=i.msgs[w].mid;break}}f=a,o=n.getMsgNodeByMid(a.mid),a.oMsgMid?(l=n.message.msgs[n.getMessageIdxByMid(a.oMsgMid)],h=n.getMsgNodeByMid(a.oMsgMid)):(l=a,h=n.getMsgNodeByMid(n.message.msgs[s-1].mid)),o&&g!==s-1&&(o.remove(),o=null),g===n.message.msgs.length-1&&n.quickReplyBox&&n.quickReplyBox.hide(),s>=_&&(u=g!==0&&g!==s-1&&h.hasClass("super-hidden")&&n.fid!=="Draft"?"super-hidden":"",g===s-1&&(h=n.listNode.one(".supercollapsed")?n.listNode.one(".supercollapsed"):h)),(n.fid==="Draft"&&g===m[m.length-1
]||g===s-1)&&!v&&(c=!1),a.cookedHeader&&a.cookedHeader.subject&&a.oMsgMid?p=!1:p=!0,l.fid||(l.fid=n.getMsgFid(a.fid)),n.initializeCompose({action:"edit",fid:n.getMsgFid(a),oMsg:a,parentMsg:l,showSubject:p},h,!0,c,u),o&&o.remove()}n.once("convAddedToDOM",function(){n.fid==="Draft"&&n.parentCW.msgList&&!a.oMsgMid&&s===1&&(n.subjectHandle=e.one("#subject-field").on("valueChange",n.updateSubject))})}function St(t,n,r,i,s){var o=this,u,a,f,l,c,h,p,d=typeof r!="undefined"?r:!1,v=t&&t.action==="forward",m=t&&t.showSubject,g,b=typeof s!="undefined"?s:"",w=typeof i!="undefined"?i:!1,E=y(t.parentMsg.mid),S="",x="quickReply";o.dirty=!0,u=o.composeWidgets[E];if(!d&&u)l=u.cv.draft.origin,f=l.action,f!==t.action?u.cv.view.header.switchReplyMode(t.action):u.cv.view.setFocus("body"),o.activeComposeWidget?o.setActiveCompose(u.cv.view):o.activeComposeWidget=u;else{d?(a=" loadhide active",S=' data-mid = "'+y(t.oMsg.mid)+'"'):(a=" active",S=""),n||(n=o.getMsgNodeByMid(o.message.msgs[o.message.msgs.length-1].mid)),n.insert('<div class = "thread-item '+x+" expanded"+a+" "+b+'" '+S+' tabIndex="-1" data-draftmid="'+E+'"> <div class="compose-loading-wrapper"><div class="cm-loadingpane"><div class="s-loader"></div></div></div></div>',"after"),g=n.next(),c={isQuickReply:!0,noFocus:w,containerNode:o.listNode,showSubject:m,maxHeightFn:function(){return o.listNode.get("offsetHeight")-20}},h={closeAction:function(){var t=g&&g.one("#rtetext");e.UA.gecko>0&&t&&(t.focus(),t.blur()),p.view.closeCompose(),delete o.composeWidgets[E],o.activeComposeWidget&&o.activeComposeWidget.cv===p&&(o.activeComposeWidget=null,o.richcompose&&!o.hasDrafts()&&o.destroyRichCompose()),e.fire("draftCardRemoved"),g.remove(!0),o.message&&o.message.msgs.length>0&&o.message.msgs[o.message.msgs.length-1].fid!=="Draft"&&o.quickReplyBox&&(o.quickReplyBox.show(),o.quickReplyBox.removeClass("loadhide"),o.quickReplyBox.focus())},bindComplete:function(e){v&&o.expandReplyCard(g,e.ccv.view)},updateTitle:function(e){o.fullView&&o.parentCW&&(e.sending?o.parentCW.tab.elTab.addClass("sending"):(o.parentCW.tab.elTab.removeClass("sending"),o.setTitle()))},showDeleteDraftDialog:function(e){e&&e.sdcbk(!1)},qrCancel:function(){p.view.cancelCompose()},switchToTab:function(){o.parentCW&&o.parentCW.tab!==e.mail.Tabs.getActiveTab()&&e.mail.Tabs.switchToTab(o.parentCW.tab)},darlaEvent:function(e){e.action=e.type,o.fire("darlaEvent",e)}};var T=["mail-ui-composeview-compose-loader","tictac-attach-main"],N=function(){e.use(T,function(){var n={},r=new e.mail.ui.Compose.ComposeLoader(n);p=r.create_conv_compose_view(t,d,g,c,h),M.enabled("richcomposeInQuickReply")&&e.use("mail-ui-richcompose-view",function(e){o.richcompose?o.richcompose.addComposeView(p.view):o.richcompose=new e.mail.Views.RichCompose(o,p.view)}),o.composeWidgets[E]={cv:p}})};T.push("mail-controller-compose-v3"),T.push("mail-ui-rteview-v3"),T.push("mail-ui-rte-formatter-v3"),NeoConfig.useAttComposerTT&&(!e.Tictac||!e.Tictac.attach)?e.once("tictacs-loaded:ws:postLoad",function(){N()}):N()}}function xt(){var e=!1,t;for(t in this.composeWidgets)e=!0;return e}function Tt(t,r,i){var s=this,o,u,a,f,l,c;if(r){o=s.getMessageIdxByMid(r.mid),u=s.getMsgNodeByMid(r.mid),c=y(r.mid);if(!u)return;f=e.one('[data-draftmid="'+c+'"]');if(i&&f){l=n.getVal(s.composeWidgets[c],"cv.view.focusNode"),l?l.focus():f.focus();return}t==="forward"?a=!0:a=!1,o===s.message.msgs.length-1&&s.quickReplyBox&&s.quickReplyBox.hide(),s.initializeCompose({action:t,fid:s.getMsgFid(r),oMsg:r,parentMsg:r,showSubject:a},u),e.fire("draftCardAdded"),Y()}}function Nt(t,n,r){function l(t){var l,c=o.ancestor("div"),h=c?c.one(".card-actions-menu"):null,p=["removeAddress","spam","notspam","notmymail","sendercompromised","phished","delete"],d=t.dataAction;if(t.dataAction==="conv-help")return;t.dataAction==="bug"?(u=encodeURI(r.getAttribute("data-mid")),a=u.lastIndexOf("_")+1,f="php/qtd_r.php?cid="+i.message.cid+"&mid="+(a?u.slice(a):u)+"&fid="+s,NeoConfig.isCorpmail&&(f+="&isCorpMail=1"),window.open(f,"_bug")):e.Array.indexOf(p,d)!==-1&&h&&h.menu&&h.menu.hide();if(NeoConfig.hasConvRefactor)if(t.dataAction==="reply_sender"||t.dataAction==="forward"){i.initReplyForward(t.dataAction,n);return}var v={action:t.dataAction,context:"msg",id:r?r.get("id"):0,forwardAsAttachment:0,fid:s,item:t.item,hasMsgList:!1,tbAction:!1};e.mail.ui.MessageEvents.handleUI(v,s,null,[n?n:null]),l=t.dataAction+"_thrd_msg",l&&e.fire("mt:click",{action:l,append:{t1:"thrdRdTb"}})}var i=this,s=i.getMsgFid(n),o=t.target,u,a,f;t.preventDefault(),e.use("common-ui-menu-helper",function(e){var n=e.common.ui.MenuHelper,r=o.ancestor("div"),i=r.one(".card-actions-menu");i.addClass("pressed"),e.use("mail-ui-inboxmenu-base","mail-ui-messageevents",function(e){e.mail.ui.InboxMenu.insert("menu-bubble-actions",function(){var r=e.one("#menu-bubble-actions");n.create(i,{menu:r,flushLeft:!1,isContext:!1,xy:[t.clientX,t.clientY],blur:!0},function(){r.on("menuSelected",l),r.after("menu:state",function(t){var n=t.state;n==="hide"&&(i.removeClass("pressed"),i.unplug(e.Plugin.Menu),this.destroy(!0))})})},s,{fid:s})})})}function Ct(t,r,i,s,o,u,a){var l=this,h,d,v,g,b,w,E,S=l.message,x=null,T,N,C=o&&o.no_show_hidden_cards?!0:!1,k=o&&o.scroll_to_msg?!!o.scroll_to_msg:!1,L=o&&o.no_focus?!0:!1;l.messageFound=0,u&&u.start(2,"LoadMessageCard"),v=new n.Stopwatch("LoadMessageCard"),x=e.later(500,l,function(){l.loadExtra(function(){if(!l.messageFound)for(T=0;T<r.length;T++)E=l.getMsgNodeByMid(S.msgs[r[T]].mid),E&&(E.hasClass("expanded")||E.addClass("loading"))},1)}),g={success:function(n,s){e.fire("MessagePane:loadMessageSuccessStart",n);var o=g&&g.respProps&&g.respProps.wasCached?!0:!1,d=g&&g.respProps&&g.respProps.callPerf,b,w=0,T=0,N,A=new Date;u&&(u.start(1,"GDMFetchEnd"),u.YCMSGGetEnd2=A,u.wasCached2=o,u.BECallTime2=d),v&&(v.wasCached=o,v.YCMSGGetEnd=A,v.BECallTime=d,v.stop());if(!l.isConvActive(S.cid))return;for(T=0;T<r.length;T++){N=r[T];if(l.message.msgs&&l.message.msgs[N]){if(!l.message.msgs[N].flags||!l.message.msgs
[N].header)l.message.msgs[N]=c.Messages.toMessage(l.getMsgFid(l.message.msgs[N]),l.message.msgs[N]);n[w]&&(n[w].header.snippet=l.message.msgs[N].header.snippet,n[w].fid=l.getMsgFid(l.message.msgs[N]),l.message.msgs[N]=n[w],h=m.getQueryParams(n[w],"midRequest"),n[w].blockImages=h&&h.blockImages,b=l.midObjMap[y(n[w].mid)],p.extractQuotedText(n[w],f.quoted_text_collapse,f.quoted_text_expand,q,b))}w++}l.showMessages(t,n,!1,i,u,k,C,!1,L),s&&s.length&&(a==="one"||a==="all")&&l.showNotification(t,s),l.messageFound=1;if(x){x.cancel();for(w=0;w<r.length;w++)E=l.getMsgNodeByMid(S.msgs[r[w]].mid),E.removeClass("loading")}L||(l.selNode||(l.selNode=e.all(".thread-item").item(t)),l.focusMessageCard())},failure:function(e){l.loadExtra(function(){var n=S.msgs[t],r=l.getMsgNodeByMid(n);e.data=n,n.body={},n.body.display=l.onMsgFailure.apply(l,[e,!1]),u&&u.stop(l.fullView?"MsgInTabFailure":"MsgInPreviewFailure"),l.showMessage(n,0,r,!1,i)},1),l.messageFound=1,l.primaryMid=null;if(x){x.cancel();for(T=0;T<r.length;T++)E=l.getMsgNodeByMid(S.msgs[r[T]].mid),E.removeClass("loading")}},errorPosition:401,suppressCodes:["*"]},b=[];for(T=0;T<r.length;T++)b.push(S.msgs[r[T]]);if(b.length===1&&l.message.msgs.length>1){w=l.getMsgNodeByMid(b[0].mid),N=function(){var e=w.one(".thread-body"),t=w.one(".thread-body .body"),n=e&&e.getAttribute("original_content"),r=l.getMsgFid(b[0])!=="Draft",i=t&&t.get("children").size()>0;return n||!o&&r&&i};if(N()){l.messageFound=1,l.showMessage(b[0],r[0],w,!1,"yes"),l.listNode.all(".loadhide").removeClass("loadhide"),l.getRoot()&&l.getRoot().one(".conv-loading").addClass("hidden");return}}e.fire("MessagePane:loadMessageCardsStart",l.message,b),d=l.requestAllMessages(b,l.message.fid,g,o,{stopwatch:u,RSstopwatch:v}),l.abortRequests(),l.outboundReq&&(l.request=d,l.requestType="loadcard")}function kt(t){var n=this,r=n.getMessageIdxByMid(t.mid),i=n.getMsgNodeByMid(t.mid),s=n.message.msgs[r];return!e.Lang.isValue(r)||!i||!s?!1:(i.hasClass("expanded")?n.scrollToMsg(s):(n.scrollOnExpansion=!0,n.expandMessages(r,"one","yes",!1)),!0)}function Lt(t){var n=this,r=n.getMsgNodeByMid(t.mid),i=n.getMessageIdxByMid(t.mid),s,o;i===0?n.listNode.set("scrollTop",0):(o=r.get("offsetTop")-12,e.use("anim",function(){var r=new e.Anim({node:n.listNode,duration:n.fullView?.2:0,to:{scroll:[0,o]}});r.run(),r.on("end",function(){s=n.getMsgFid(t),n.markConvMsgAsRead(s,t)})})),n.scrollOnExpansion=!1}function At(e,t,n){var r=this;r.toggleAllMessageCards(e,t,n)}function Ot(e,t,n){var r=this,i,s={};r.expandSuperCollapsedNodes(),r.lastExpandedMsgIdx=0,t==="expandall"?(n.toggleState="expanded",i=r.getMessageIdxByMid(r.message.msgs[0].mid),s.no_focus=!0,r.expandMessages(i,"all",!1,"no",s),e&&e.removeClass("thread-cards-collapsed"),e&&e.addClass("thread-cards-expanded"),e.setAttribute("title",strings.str_collapse_all_attr),e.one(".icon-text").setContent(strings.str_collapse_all)):(n.toggleState="collapsed",r.collapseAllMessageCards(),e&&e.removeClass("thread-cards-expanded"),e&&e.addClass("thread-cards-collapsed"),e.setAttribute("title",strings.str_expand_all_attr),e.one(".icon-text").setContent(strings.str_expand_all))}function Mt(e){var t=this,n=t.lastExpandedMsgIdx;if(!(t.message.msgs.length>n)){t.fetchMoreTimer=null;return}t.fetchMoreTimer=setTimeout(function(){t.expandMessages(n,"all",!1,"no",e)},100)}function _t(t,n,r,i,s,o,u){var a=this,f=a.message,l,c,h=null,p=[],d,v=0,m,g,y;switch(n){case"all":a.lastExpandedMsgIdx=a.lastExpandedMsgIdx?a.lastExpandedMsgIdx:0,u=!1,t=0,v=0;for(a.lastExpandedMsgIdx;a.lastExpandedMsgIdx<f.msgs.length;a.lastExpandedMsgIdx++){if(!(v<L)){a.fetchMoreMsgs(s);break}if(a.getMsgFid(f.msgs[a.lastExpandedMsgIdx])==="Draft")continue;p.push(a.lastExpandedMsgIdx),v++}a.scrollLoad=!0,a.expandAllMode=!0;break;case"one":p.push(t);break;case"unread":case"other-unread":m=n==="other-unread"?t:0,u=u&&n==="unread",y=function(e){a.expandMessages(e+1,"other-unread",!1,!1,{scroll_to_msg:!1,no_show_hidden_cards:!0,no_focus:!0})};for(d=m;d<f.msgs.length;d++){if(a.getMsgFid(f.msgs[d])==="Draft"||n==="other-unread"&&d===0)continue;if(!f.msgs[d].flags.isRead){if(!(v<k))break;if(h===null&&n==="unread"){h=d,t=h,p.push(d),g=d,a.fetchOther=e.Lang.later(P,a,y,g);break}n==="other-unread"&&p.push(d),v++}}!p.length&&n!=="other-unread"&&(t=f.msgs.length-1,p.push(t));break;case"adjacent":l=t,t+C+1>f.msgs.length?c=f.msgs.length:c=t+C+1;for(l;l<c;l++)p.push(l);break;case"send":case"other-send":t=null;for(d=0;d<f.msgs.length;d++)a.getMsgFid(f.msgs[d])==="Sent"&&(p.push(d),t=d);n==="other-send"&&p.length&&p.pop();break;case"draft":t=null,u=!1,a.listNode.all(".loadhide").removeClass("loadhide"),a.getRoot()&&a.getRoot().one(".conv-loading").addClass("hidden")}a.selMsgIdx=t,u&&e.Lang.isNumber(t)&&(a.primaryMid=a.message.msgs[t].mid),a.loadMessageCards(t,p,r,i,s,o,n)}function Dt(e){var t=this,n=parseInt(e.getComputedStyle("height"),10);e.setStyles({height:n+"px",overflow:"hidden"}),setTimeout(function(){e.setStyle("transition",""),e.setStyle("height",D+"px"),M.enabled("messageReadPaneV2")&&e.removeClass("expanded")},0),setTimeout(function(){e.removeClass("expanded"),e.setAttribute("aria-expanded","false"),e.one(".thread-body").setContent(""),t.fire("darlaEvent",{action:t.fullView?"message_tabpane":"msgread_reading_pane"}),t.fire("MessagePane:unload",e),Y()},200)}function Pt(t,n,r,i,s,o,u){function E(e,t){h=a.getMsgFid(e),t.inRegion(a.listNode)&&t.hasClass("expanded")&&t.hasClass("unread")&&a.markConvMsgAsRead(h,e)}var a=this,f,l=t.mid,c=this.getMsgMarkUp(t,!0,i),h,p=s!==!1,v,m,g,b,w;try{if(r.hasClass("collapsing")||r.hasClass("expanding"))return;return r.hasClass("thread-focus")&&(w=!0),r.replace(c),r=a.getMsgNodeByMid(l),w&&(a.selNode=r,a.focusMessageCard()),r.removeClass("loadhide"),t.body&&(r.one(".body").setContent(d.processBodyMarkup(t.body.display||"")),vt(r),a.autoLoadNonDisplaybleTruncMsg(t,r,n),p&&a.initialRender?(f=parseInt(r.getComputedStyle("height"),10),r.setStyles({transition:"none",height:D+"px"}),u&&a.scrollOnExpansion&&
a.scrollToMsg(t),M.enabled("markExpandedAsRead")||E(t,r),a.fire("darlaEvent",{action:a.fullView?"message_tabpane":"msgread_reading_pane"}),setTimeout(function(){r.setStyle("transition",""),r.setStyle("height",f+"px")},0),e.later(200,r,r.setStyles,{height:"auto",overflow:"visible",transition:"none"})):r.setStyles({height:"auto",overflow:"visible",transition:"none"}),d.plainTextMessage(t.part)?(v=r.one(".thread-body .body"))!==null&&(b="addClass"):b="removeClass",b&&v&&v.parentNode&&(v[b]("plaintextMsg"),v.parentNode[b]("compose"),b=undefined),r.removeClass("loading"),a.scrollTop&&(g=a.get("rootNode").one(R),setTimeout(function(){g.set("scrollTop",a.scrollTop)},200))),t.loading_error||a.convMsgRenderComplete(t,r,o),m=a.expandMessageTimers[y(t.mid)],m&&m.cancel(),e.fire("MessagePane:messageExpandDone",{mid:t.mid,cid:a.message.cid}),Y(),r}catch(S){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4",S,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-convpaneread:4")}}function Ht(e,t){var n,r,i=t||[],s,o=this;for(n=0;n<i.length;n++)r=i[n],s=o.getMsgNodeByMid(r.mid),s&&(s.addClass("load-error"),s.one(".load-error-msg").setContent(r.msgPermDeleted?strings.str_msg_deleted_error:strings.str_msg_load_error_generic))}function Bt(t,r,i,s,o,u,a,f,l){function b(){var n,r,i;r=e.Lang.isArray(t)?t[0]:t,n=c.getMsgNodeByMid(c.message.msgs[r].mid);if(!c.expandAllMode){l||(c.selNode=n);if(!a||y&&r>0)i=n,setTimeout(function(){a||(c.listNode&&c.listNode.all(".loadhide").removeClass("loadhide"),g.one(".conv-loading")&&g.one(".conv-loading").addClass("hidden")),y&&r>0&&c.listNode&&c.listNode.set("scrollTop",i.get("offsetTop")-12)},0)}else c.selNode=null}var c=this,h=0,p,d,v,m,g=this.getRoot(),y=u===!0;o&&o.start(1,"MessageInDOM");for(h=0;h<r.length;h++)p=r[h],d=c.getMessageIdxByMid(p.mid),v=c.getMsgNodeByMid(p.mid),f?(v.hasClass("expanded")||v.addClass("expanded"),c.convMsgRenderComplete(p,v,o)):p.fid!=="Draft"&&c.showMessage(p,d,v,i,s,o,y),M.enabled("markExpandedAsRead")&&c.markConvMsgAsRead(c.getMsgFid(p),p);f&&(g.all(".loadhide").removeClass("loadhide"),g.one(".conv-loading").addClass("hidden")),c.initialRender=!0,o&&(c.fire("renderConvComplete"),c.fullView&&c.fire("read-stat:renderCompleteOnUpdate"),NeoConfig.hasConvView&&setTimeout(function(){e.fire("tutorConvMsgPaneRendered")},200)),h=c.primaryMid?1:0,m=function(){var e=new n.Stopwatch(c.fullView?"MsgInTab":"MsgInPreview");e.wasCached=!0,e.stop()};for(;h<r.length;h++)setTimeout(m,(h+1)*250);c.primaryMid=null,c.parentNode&&c.parentNode.ancestor("body")?(b(),setTimeout(function(){M.enabled("markExpandedAsRead")?c.markExpandedMsgsAsRead():c.checkMsgCardsOnScroll(c.getAllCards())},300)):c.once("activeChange",function(){b(),setTimeout(function(){M.enabled("markExpandedAsRead")?c.markExpandedMsgsAsRead():c.checkMsgCardsOnScroll(c.getAllCards())},300)})}function jt(){var e=0,t=this.message.msgs;for(e=0;e<t.length;e++){var n=t[e];!n.flags.isRead&&n.body&&this.markConvMsgAsRead(this.getMsgFid(n),n)}}function Ft(){var e=this;return e.listNode?e.listNode.all("."+x):null}function It(e,t){t.scrollFocus&&this.listNode.set("scrollTop",e.get("offsetTop")-5)}function qt(e,t){var n=this,r={truncateAt:null},i=n.get("rootNode").one(R);n.scrollTop=i.get("scrollTop"),n.disableTruncate=1,n.expandMessages(t,"one","yes",!1,r)}function Rt(e,t){var n=this,r={midRequest:{blockImages:"none"}};n.expandMessages(t,"one","yes",!1,r)}function Ut(e,t,n){var r=this,i=r.message;t||(i.body=i.attachments=i.imgAttachments=i.nonImgAttachments=0),r.loadMessage(1,e,n)}function zt(){var e=this,t=e.loading_slow?2:1;e.loading_slow=e.loading_error=e.loading_moved=0,t>0&&t<=6&&(e.numRetries=e.numRetries?e.numRetries+1:1,e.numRetries>=e.maxRetries),e.loading_slow=e.loading_error=e.loading_moved=0,e.fireEvent("retry"),e.loadPaneContent(6,t),e.set("transferFocus",1)}function Wt(t,n){var r=this,i=t||[],s,o,u=i.length;if(NeoConfig.enableMessagePrefetch){e.fire("prefetchConversations",{fid:r.fid,cids:i});return}for(o=0;o<u;o++)s||(s=v.batch()),s.setAsReadOp(!0),g.batchAddConvPrefetch(s,o,r.fid,i[o],n);s&&s.execute({suppressCodes:["*"],backgroundLogs:["*"]})}function Xt(){var t=this,n;!NeoConfig.backButtonFull&&t.fullView===!0&&e.fire("initPage"),t.quickReplyBox&&(t.quickReplyBox.one("#switchtext-plain").addClass("hidden"),t.quickReplyBox.one("#switchtext-rich").removeClass("hidden")),NeoConfig.hasConvPerf&&t.fid!=="%40B%40Bulk"&&t.fid!=="Trash"&&!t.midtocid&&setTimeout(function(){t.prefetch(t.neighbors,"Neighbors")},Math.min(P+50,H)),t.fullView?n="thread_tabpane":n="msgread_reading_pane",e.fire("mt:view",{action:n})}function Vt(){}function $t(e,t){var n=this,r,i,s,o,u,a,f,l,p;r=e.msg,s=e.replace||0;if(n.message){i=e.pos!==undefined?e.pos:n.message.msgs.length,a=r.fid,r.header||(r=c.Messages.toMessage(a,r)),n.message.msgs.splice(i,s,r),n.message.midMap.splice(i,s,{fid:r.fid,mid:r.mid}),n.message=h.Conversations.calcConvSummary(n.message),p=n.message.msgs,u=p.length;for(o=0;o<u;o++)l=y(p[o].mid),n.midObjMap[l]=o;t&&(f=n.getMsgMarkUp(r,!1),n.quickReplyBox?n.listNode.insertBefore(f,n.quickReplyBox):n.listNode.append(f),n.expandMessages(n.message.msgs.length-1,"one","yes")),n.updateCount()}}function Jt(){var e=this,t,n=e.message.totalMsgs,r=e.getRoot().one(E);r&&(n>1?t="("+n+")":t="",r.set("innerHTML",t))}function Kt(){var t=e.one("#subject-field"),n=e.one(w+" .thread-subject");t.get("value")!==""?(n.set("innerHTML",t.get("value")),n.set("title",t.get("value"))):(n.set("innerHTML",strings["str_msg-view_no_subject"]),n.set("title",strings["str_msg-view_no_subject"]))}e.namespace("mail.ui");var t=e.mail.ui._ConvPane,n=e.common.Utils,r=n.substitute,i=n.ezSub,s=n.escapeHtml,o=n.ymmastats,u=n.unescapeHtml,a=e.ui.Templates,f=a._shared_module_thread_thread_display_rollup,l=e.mail,c=l.model.DataStore,h=l.model.ConvStore,p=l.ui.PaneUtils,d=l.ui.MessagePaneUtils,v=l.Controller,m=l&&l.Controller?l.Controller
.Messages:{},g=l&&l.Controller?l.Controller.Conversations:{},y=c.Messages.getPermMidPart,b=h.Conversations.getPermCidPart,w=".message-header",E=w+" .summary",S=w+" .badge",x="thread-item",T="expanded",N="unread",C=2,k=NeoConfig.convMsgsToOpenCount||5,L=NeoConfig.convMsgsToOpenCount||5,A=e.mail.persist.MetaData,O=n.settings,M=n.features,_=O.value("SUPER_COLLAPSE_THRESHOLD")||6,D=M.enabled("messageReadPaneV2")?24:21,P=10,H=175,B=5,j=strings.str_cfg_tog_hkr_siu===!0?"hkr_siu":"cg_siu",F=strings.str_cfg_tog_hkr_siu===!0,I={"http://mail.yimg.com/a/i/cal/bell4.gif":"bell","http://mail.yimg.com/a/i/us/pim/ybang_16x16_1.gif":"certified"},q=[],R=".thread-item-list",U=M.enabled("convReplyBucket"),z=M.enabled("lozengeContactCard"),W=M.enabled("hideRecipients"),X=O.value("recipientThresholdVal")||5,V={to:!1,cc:!1,bcc:!1},$=M.enabled("rtePopoutToolbar"),J=function(e){var t=this;e=e||{},J.superclass.constructor.call(t,e),t.loadingTrucatedMsg=!1};e.extend(J,l.ui.MailPaneRead,{setFullFormatters:tt,onSuccess:nt,bindPaneContent:gt,retryLoad:zt,unblockImages:Rt,viewFullMsg:qt,autoLoadNonDisplaybleTruncMsg:mt,changeRequest:Ut,searchRecipients:Vt,postRender:Xt,prefetch:Wt,getMsgMarkUp:et,selectMessage:kt,scrollToMsg:Lt,expandMessages:_t,collapseMessage:Dt,loadMessageCards:Ct,showMessage:Pt,showMessages:Bt,showNotification:Ht,setActiveCompose:it,getActiveCompose:rt,hasDrafts:xt,saveDrafts:st,insertMsgAtPos:$t,loadMenu:Nt,expandReplyCard:It,toggleAllMessageCards:Ot,handleToggleAllMessageCards:At,lftCongruencyCheck:yt,lftSendSaveCongruencyCheck:bt,expandSuperCollapsedNodes:wt,initializeCompose:St,initializeAllDrafts:Et,initReplyForward:Tt,updateCount:Jt,updateSubject:Kt,closeAllCompose:ot,markConvMsgAsRead:ut,convMsgRenderComplete:ft,bindContentUI:dt,fetchMoreMsgs:Mt,checkMsgCardsOnScroll:ht,checkAdsOnScroll:ct,scheduleScrollHandler:pt,onPaneScroll:lt,getAllCards:Ft,markAsReadBatch:at,getInboxService:Z,markExpandedMsgsAsRead:jt}),e.mix(t.prototype,J.prototype),e.mix(t.prototype,l.ui.MailPaneRead.prototype)},"1.0.0",{requires:["_shared_module_thread_thread_display_rollup","common-persist-user-data","common-ui-tabs-base","common-utils-stats","contacts-api","contacts-api-utils","mail-persist-meta-data","mail-platform","mail-ui-common-fonts","mail-ui-convpane-base","mail-ui-convpane-bind","mail-ui-mailpane-read","mail-ui-messagepane-utils","mail-ui-messagepane-warnings","mod-conversation-history_css","mail-common-utils-features","mail-common-utils-settings","mail-ui-pane-utils","common-utils"]});
YUI.add("mail-common-precache-thread",function(E){E.namespace("mail.ui");var A=E.mail,B=A.ui.ConvList,D=A.model.ConvStore.Conversations,C="unreadConv";NeoConfig.preCacheAlgorithm=C;B.getNeighbors=function(R,N,T,H,M){if(!(R&&R.length&&N>=-1&&N<=R.length-1&&NeoConfig.hasConvView)){return;}var P=M,F=[],L=[],S=[],O=1,I=0,G=0,K=M||2,J=1;function Q(U){var V;if((V=R[U])&&!D.isCached(H,V.cid)){if(V&&V.totalUnread>0){F.push(V);}else{L.push(V);}return 1;}return 0;}while(O){if(G<K&&!Q(N-J)){G++;}if(I<K&&!Q(N+J)){I++;}O=((F.length+L.length)<P)&&!(G===K&&I===K);J++;if(J>100){break;}}S=F.concat(L);S=S.splice(0,S.length>=P?P:S.length);for(J=0;J<S.length;J++){T.push(S[J]);}};},"1.0.0",{requires:["mail-ui-convlist-base"]});