YUI.add("common-ui-dd",function(B){var F=150,H=B.one("body"),D=B.Node.create("<div></div>"),I=function(){var L=H.get("docHeight"),K=H.get("docWidth");D.setStyles({height:L+"px",width:K+"px"});},C=false,A,J=B.common.Utils;var G="transparent";D.setStyles({opacity:"0",position:"absolute",zIndex:"99999",overflow:"hidden",backgroundColor:G,display:"none",height:"5px",width:"5px",borderWidth:"0 0 0 2px !important"});D.set("id",B.stamp(D));B.on("window:resize",I);H.prepend(D);var E=function(N){this.handles=[];var Q=N.scope,P=false,K=N.node,O=function(S){this.dragging=true;A=null;this.startXY=[S.pageX,S.pageY];this.lastXY=S.target.getXY();S.dd=this;this.f1=K.on("mousemove",B.bind(L,this));this.f2=D.on("mousemove",B.bind(L,this));this.f3=H.on("mousemove",B.bind(L,this));if(N.start){N.start.apply(Q,[S]);if(S.notDragging){this.dragging=false;}}},R=function(S){if(S.button===1&&!A&&S.target&&S.target.get("type")!=="text"){C=S.target;A=B.later(F,this,O,S);}},M=function(S){if(this.dragging){this.f1.detach();this.f2.detach();this.f3.detach();S.dd=this;D.setStyle("display","none");P=false;this.dragging=false;if(N.end){N.end.apply(Q,[S]);}S.halt(true);return false;}if(A){A.cancel();A=null;}},L=function(S){if(this.dragging&&N.move){if(!P&&this.dragging){P=true;I();D.setStyle("display","block");if(N.cursor){D.setStyle("cursor",N.cursor);}else{D.setStyle("cursor","default");}}S.dd=this;S.target.lastXY=[S.pageX,S.pageY];S.target.startXY=this.startXY;N.move.apply(Q,[S]);return false;}};J.setSelect(D,false);J.setSelect(B.one("#msg-list"),false);J.setSelect(B.one("#shellnavigation"),false);if(N.dragSelector){this.handles.push(K.delegate("mousedown",B.bind(R,this),N.dragSelector));this.handles.push(K.delegate("mouseup",B.bind(M,this),N.dragSelector));}else{this.handles.push(K.on("mousedown",B.bind(R,this)));this.handles.push(K.on("mouseup",B.bind(M,this)));}this.handles.push(D.on("mouseup",B.bind(M,this)));this.handles.push(H.on("mouseup",B.bind(M,this)));};E.prototype.destroy=function(){var L=this.handles;if(L){var M=L.length,K;for(K=0;K<M;K++){if(L[K]){L[K].detach();L[K]=null;}}}};B.namespace("mail").DD=E;},"1.0.0",{requires:["node","common-utils"]});YUI.add("mail-ui-messagesview-resize",function(H){H.namespace("mail.MessagesViewResize");var E=H.common.persist.getCookie(),G="pos.vslider",F=function(){};function A(J){var N=this,L=J.cursor||"row-resize",I,M,K;N.id=J.id||"rail-resize-hori";N.drag_node=M=H.one("#"+N.id);N.realParent=I=J.messagesview.get("parentNode")||J.messagesview.get("tabNode");N.inbox=I.one("div.inbox");N.tripane=I.one("div.tripane");N.on=(typeof J.on!==undefined)?J.on:1;N.msgsView=J.messagesview;N.OFFSET_STYLE=N.OFFSET_STYLE||"offsetHeight";N.INBOX_STYLE=N.INBOX_STYLE||"height";N.TRIPANE_STYLE=N.TRIPANE_STYLE||"top";N.DRAG_STYLE=N.DRAG_STYLE||"top";N.COOKIE_NAME=N.COOKIE_NAME||G;N.PREFIX=N.PREFIX||"";N.MIN_PANE=NeoConfig.minBottomPreviewHeight;N.MIN_LIST=N.MIN_LIST||100;N.DEFAULT=NeoConfig.minBottomPreviewHeight;if(!M){N.drag_node=M=H.Node.create('<div onmousedown="return false" unselectable="on" style="position:absolute;z-index:1" id="'+N.id+'"></div>');K=E.get(G);if(K&&parseInt(K,10)<NeoConfig.minBottomPreviewHeight){K=NeoConfig.minBottomPreviewHeight;}M.setStyles(J.styles||{top:K||N.DEFAULT});I.append(M);}(new H.mail.DD({scope:this,start:N.start,end:N.endUp,move:N.moveMouse,node:N.drag_node,cursor:L,disable:H.one("#msg-list")}));N.checkDisplay();}A.prototype={checkDisplay:function(){var N=this,L=E.get(N.COOKIE_NAME)||(N.DEFAULT+""),K,M,J,I;if(L){if(N.PREFIX&&L.charAt(0)===N.PREFIX){L=parseInt(L.substr(1),10);}L=parseInt(L,10);if(L<NeoConfig.minBottomPreviewHeight){L=NeoConfig.minBottomPreviewHeight;}if(N.on){K=H.one("#shellcontent");M=K?K.get(N.OFFSET_STYLE):10000000;if((L+N.MIN_PANE)>M){J=M-N.MIN_PANE;I=J>N.MIN_LIST;if(I){N.inbox.setStyle(N.INBOX_STYLE,J);N.tripane.setStyle(N.TRIPANE_STYLE,J+6);N.drag_node.setStyle(N.DRAG_STYLE,J);E.set(N.COOKIE_NAME,(N.PREFIX+J));N.msgsView.positionToolbarItems(true);}else{if(!H.common.Utils.features.enabled("TripaneNoMinWidth")){N.msgsView.togglePreviewPane(true);N.autoClosed=true;N.on=false;}}}}else{if(N.autoClosed&&NeoConfig.vertPane){K=H.one("#shellcontent");M=K?K.get(N.OFFSET_STYLE):10000000;if((L+N.MIN_PANE)<=M){N.on=true;N.autoClosed=false;N.msgsView.togglePreviewPane(true);}}}}},setDisplay:function(I){this.drag_node.setStyle("display",(I?"block":"none"));this.on=I?1:0;},start:F,endUp:function(){var I=parseInt(this.drag_node.getStyle("top"),10);E.set(G,I);H.fire("recalculateScrollToRepositionSend");H.fire("msgsview:splitterdone");},moveMouse:function(N){var M=this,J=N.pageY,P=H.one("body").get("offsetHeight"),K=H.one("#inboxcontainer").get("offsetTop"),O=H.one("#shellcontent").get("offsetTop"),L=H.one("#main").get("offsetTop")+H.one("#shellinner").get("offsetTop")+K+O,I=J-L,Q=M.MIN_PANE;if(J>(P-Q)){I=P-L-Q;}if(I<=Q){I=Q;}M.drag_node.setStyle("top",I-3);M.inbox.setStyle("height",I-3);M.tripane.setStyle("top",I-3);}};H.namespace("mail.ui").MessagesViewResize=A;function C(K){var I=["nsdate","nssubj","subj","from","to","date","size"];for(var J=0;J<I.length;J++){if(K.lastIndexOf(I[J])>-1){return I[J];}}}function D(K,L){var J=C(K.get("className")),I;if(J){I=Math.round(K.getData("col-right"));E.set("column_resize."+J+".width_pct",(100-(L+I)));E.set("column_resize."+J+".left_pct",L);}}var B={init:function(I){this.element=I;this.resizeableColumns=this.element.all(".flex > div");this.createResizeWidgets();},createResizeWidgets:function(){var J=H.one("div.flex");if(!J){return;}var I=J.get("offsetWidth");this.resizeableColumns.each(function(M,X){var T=this;if(!M.getData("col-right")){var Y,U,Q=M.get("offsetLeft"),V=M.get("offsetWidth");Q=Q>0?Q:0;V=V>0?V:0;Y=Math.round(Q/I*100);U=Math.round((I-(V+Q))/I*100);M.setData("col-left",Y);M.setData("col-right",U);}if(!X){return;}var L=H.Node.create('<div onmousedown="return false" unselectable="on" class="rail-resize" style="border: 3px solid transparent" id="resize-'+M.getAttribute("data-action")+'"></div>');M.append(L);var S=0,W,P,Z,N;var K=function(){var a=M.get("region");N=M.previous();while(N&&!N.getData("col-right")){N=N.previous();}P=N?N.get("region").left+75:75;W=a.left+a.width-75;Z=M.get("parentNode").get("offsetWidth");};var R=function(d){if(!S){S=d.target.startXY[0];}var h,g,b,e,f,c,a=d.target.lastXY[0];if(a<P||a>W){return false;}h=S-a;S=a;g=Math.round(h/Z*100*1000)/1000;b=H.StyleSheet("ColResize");e=Math.round(M.getData("col-left"))-g;c=C(M.get("className"));if(c){M.setData("col-left",e);H.all("div.flex ."+c).setStyles({left:e+"%"});b.set("div div.flex div."+c,{left:e+"%"});}f=Math.round(N.getData("col-right"))+g;c=C(N.get("className"));if(c){N.setData("col-right",f);H.all("div.flex ."+c).setStyle("right",f+"%");b.set("div div.flex div."+c,{right:f+"%"});}};var O=function(){var a=0;S=0;L.setStyle("left",-2);T.resizeableColumns.each(function(b){D(b,a);a+=(100-Math.round(b.getData("col-right")));});N=null;};(new H.mail.DD({scope:this,start:K,move:R,end:O,node:L,cursor:"col-resize"}));},this);}};H.all(".list-header").each(function(I){B.init(I);});H.namespace("mail.ui").MessagesViewColResize=B;H.namespace("test.MsgView.Resize");H.mix(H.test.MsgView.Resize,{retrieveClass:C,persistNode:D});},"1.0.0",{requires:["common-persist-cookie-data","stylesheet","node","common-ui-dd","common-persist-user-data","mail-common-utils-features"]});YUI.add("_shared_module_offscreen_bin_drag_drop",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_drag_drop={base:'<div class="msgDragProxy"> <i></i> <span></span> <b class="counter">{{num_emails_dragging}}</b></div>'};},"1.0.0");YUI.add("mail-ui-messagesview-dd",function(D){D.namespace("mail.MessagesViewDD");var A=NeoConfig,E=["Draft","%40C%40Chats"],B=10,C="MessagesView";D.mail.MessagesViewDD={PREVSUBNAV:"",setDD:function(Q){var T=D.one("#storm-listnav"),G=D.one("div#main"),N=false,R=100,H=D.one("#shellnavigation"),S=D.one("#custom-folders"),J=D.one("#Folders"),P=false,L={scrollTimer:null,dd:null,pageX:0,pageY:0,clientX:0,clientY:0,timerCB:null,start:function(V,Y,X,W,U,Z){this.timerCB=V;this.dd=Y;this.pageX=X;this.pageY=W;this.clientX=U;this.clientY=Z;this.scrollTimer=D.Lang.later(R,this,this.ssHandler,null,true);},update:function(U){this.pageY=U;},ssHandler:function(){this.timerCB(this.dd,this.pageX,this.pageY,this.clientX,this.clientY);},isActive:function(){return(this.scrollTimer!==null);},hasMoved:function(U,V){return(U!=this.clientX||V!=this.clientY);},clear:function(){if(this.scrollTimer){this.scrollTimer.cancel();delete this.scrollTimer;this.scrollTimer=null;}}};D.publish("dropMessages",{emitFacade:true,defaultFn:function(Y){var X=Y.msgs,V=Y.fromFid,W=Y.toFid,U=Y.theList;if(D.mail.ui.MessageEvents){D.mail.ui.MessageEvents.handleUI({action:"move",fid:W},V,U,X);if(W==="Trash"){D.fire("darlaEvent",{action:"dd_msg_to_trash"});}else{if(V==="Trash"){D.fire("darlaEvent",{action:"dd_msg_to_folder"});}}}}});D.publish("dropConvs",{emitFacade:true,defaultFn:function(Y){var X=Y.msgs,V=Y.fromFid,W=Y.toFid,U=Y.theList;if(D.mail.ui.ConvEvents){Q.handleUI({action:"move",fid:W},V,U,X);if(W==="Trash"){D.fire("darlaEvent",{action:"dd_msg_to_trash"});}else{if(V==="Trash"){D.fire("darlaEvent",{action:"dd_msg_to_folder"});}}}}});var F=function(W){var V=D.one("body");D.mail.MessagesViewDD.PREVSUBNAV=V.getAttribute("data-open");var U=function(Z){function X(c){var b=true,Y=Z.common.Utils.substitute(Z.ui.Templates._shared_module_offscreen_bin_drag_drop.base,{num_emails_dragging:c.arr.length},null,null,strings);if(A.hasConv){for(var a in c.map){var d=Q.msgList.getMsgFid(c.map[a]);if(d!=="Draft"&&d!=="Sent"){b=false;break;}}}else{b=false;}if(W.dd.dragging&&c.arr.length&&Z.Array.indexOf(E,Q.fid)===-1&&!b){W.dd.proxy=Z.Node.create(Y);Z.one("body").prepend(W.dd.proxy);W.dd.proxy.setXY([-100,-100]);W.dd.shellbottom=H.get("winHeight");W.dd.shelltop=H.getY();Z.fire(C+":dragstart");}else{W.notDragging=true;}}if(Q.hasMsgList){Q.msgList.vlist.getSelected(X);}else{X([Q.msgPane.get("message")]);}P=V.getAttribute("data-open")==="Folders"?true:false;};L.clear();if(W.target.hasClass("list-view-items")||W.target.getAttribute("draggable")==="false"){W.notDragging=true;return;}if(!N){D.use(A.hasConv?"mail-ui-convevents":"mail-ui-messageevents",U);N=true;}else{U(D);}};var O=function(W,Y,X){var Z,V=D.mail.MessagesViewDD.currentDrop,U,a;if(Y.getAttribute("data-fid")){Z=Y.getAttribute("data-fid");if(X){U=Y.one("a")?Y.one("a"):Y;}else{U=Y.one("i")?Y.one("i"):Y;}if(W.proxy.one("span").inRegion(U)&&Q.fid!==Z&&Z!=="Draft"&&Z!=="Sent"&&Z!=="%40C%40Chats"){if(V){V.removeClass("popping");}Y&&Y.addClass("popping");D.mail.MessagesViewDD.currentDrop=Y;a=true;}else{if(Y.hasClass("popping")){Y.removeClass("popping");D.mail.MessagesViewDD.currentDrop=null;}}}return a;};var M=function(U){if(L.isActive()&&!L.hasMoved(U.clientX,U.clientY)){return;}L.clear();I(U.dd,U.pageX,U.pageY,U.clientX,U.clientY);};var I=function(e,a,Z,X,V){var g,Y,f,d,U,b,h,W=e.shelltop,c=e.shellbottom;d=Y=f=30;if(e.proxy){if(e.proxy._node){e.proxy.setStyle("top",Z-10);e.proxy.setStyle("left",a-1);}if(!P){if(e.proxy.inRegion(J)){G.addClass("dragging-message");P=true;if(A.nav){J.addClass("nav-open");}}}if(e.proxy.inRegion(H)){if(e.proxy.inRegion(S)||(S.one(".listnav-subfolder")&&e.proxy.inRegion(S.one(".listnav-subfolder")))){S.all("li").each(function(i){O(e,i,false);});}else{if(e.proxy.inRegion(T)){T.all("li.sysfolder").each(function(i){var j=O(e,i,true);if(j){D.fire("navigation:switch",{"type":"none"});P=false;}});}else{if(D.mail.MessagesViewDD.currentDrop){D.mail.MessagesViewDD.currentDrop.removeClass("popping");D.mail.MessagesViewDD.currentDrop=null;}}}if(Z<W+d){U=b=true;}else{if(Z>c-Y){U=true;b=false;}}if(U){if(b){g=H.get("scrollTop");H.set("scrollTop",g-f);h=Z;}else{g=H.get("scrollTop");H.set("scrollTop",g+f);h=Z;}if(!L.isActive()){L.start(I,e,a,Z,X,V);}L.update(h);}else{L.clear();}}else{if(D.mail.MessagesViewDD.currentDrop){D.mail.MessagesViewDD.currentDrop.removeClass("popping");D.mail.MessagesViewDD.currentDrop=null;L.clear();}}}};var K=function(Y){var U,X,V,Z,W=D.mail.MessagesViewDD.PREVSUBNAV;L.clear();if(Y.dd.proxy){Y.dd.proxy.remove(true);if(D.mail.MessagesViewDD.currentDrop){D.mail.MessagesViewDD.currentDrop.removeClass("popping");U=D.mail.MessagesViewDD.currentDrop.getAttribute("data-fid");Z=A.hasConv;V=Z?"dropConvs":"dropMessages";X=function(a){if(Q.hasMsgList){a.fire(V,{fromFid:Q.fid,toFid:U,theList:Q.msgList});}else{a.fire(V,{fromFid:Q.fid,toFid:U,msgs:[Q.msgPane.get("message")]});}};if(!N){D.use(Z?"mail-ui-convevents":"mail-ui-messageevents",X);N=true;}else{X(D);}}else{if(Y.dd.originNode){if(Math.abs(Y.pageX-Y.dd.startXY[0])<=B&&Math.abs(Y.pageY-Y.dd.startXY[1])<=B){D.one(Y.dd.originNode.simulate("click"));}}}}D.mail.MessagesViewDD.currentDrop=null;D.fire(C+":dragend");G.removeClass("dragging-message");D.fire("navigation:switch",{"type":W});D.mail.MessagesViewDD.PREVSUBNAV="";};(new D.mail.DD({start:F,move:M,end:K,node:D.one("div.list-view-items")}));}};},"1.0.0",{requires:["mail-model-datastore","common-utils","node-base","common-ui-dd","_shared_module_offscreen_bin_drag_drop"]});