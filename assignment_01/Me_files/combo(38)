YUI.add("mail-ui-convpane-error",function(e){function l(e){var t=this,n="",r;return t.filterFailError?"":(t.conv_deleted_error?r=u.conv_deleted_error:t.msg_deleted_error?(n=f.getMsgSub(this.message),r=u.msg_deleted_error):e?(n=e&&e.header&&e.header.subject?e.header.subject:strings["str_msg-view_no_subject"],r=u.loading_error):(n=f.getMsgSub(this.message),r=u.conv_loading_error),o(r,{msg_subject:i.escapeHtml(n)},t.readFormatters,0,strings))}function c(){var e=this,t=e.message||{},n=e.sourceFolderInfo||0,r,s,a="";return t.mid&&(r=n?n.fid:"",s=n?n.name:"",r&&(a=o(u.diff_folder_error,{newFid:r,foldername:i.escapeHtml(s)},0,0,strings))),a||(a=e.getFailureMarkup()),a}function h(){return o(u.loading_slow,0,0,0,strings)}function p(){var e=this;e.outboundReq&&(e.augmentFormatters(),e.slowLoad=e.msg_deleted_error=e.conv_deleted_error=e.loading_error=e.loading_moved=0,e.loading_slow=1,e.render())}function d(t,n){function x(e){var t;return typeof e=="string"&&(t=e.match(/Client\.([\w\W]+)$/)||e.match(/Server\.([\w\W]+)$/)),t&&t[1]||e}var r=this,o=e.mail,u=o.model.DataStore,f,l,c,h=r.retryPrefix(),p=t.reason,d=t.data&&t.data.status,v=n?"preloadFailure":"loadConvFailure",m=i.Stopwatch,g=m.get("MsgInPreview"),y,b,w,E={GetCidsInvalidMids:!0,MessageFetchFailed:!0,MessageIdsNotFound:!0,MessageNotFound:!0,GetMessageInvalidId:!0,MessageSelectionNotFound:!0,MessageIdsDeleted:!0,MessageNotFoundInNonBulk:!0,"EC-4001":!0,ERROR:!0},S={ConvIdCouldNotBeFound:!0,InvalidConvId:!0,MalformedConvId:!0};s.stat("convread","result=>failure,env=>"+NeoConfig.mailEnv),r.filterFailError=r.msg_deleted_error=r.conv_deleted_error=0,r.isTae4=r.isTae46=!1,t.code==="BatchItemError"?(w=t.fault&&t.fault.detail&&t.fault.detail[0]&&t.fault.detail[0].code,w=x(w)):w=t.reason&&t.reason.code&&x(t.reason.code)||t.code&&x(t.code),y=u.Folders.get(r.fid),c=t?t.data:0,E[w]===!0?(r.isTae4=!0,b="TAE4:GDM:FAILURE:"+r.numRetries+":",r.numRetries>=r.maxRetries?r.canRetry=!1:r.canRetry=!0,w==="EC-4001"&&(r.filterFailError=1)):S[w]===!0&&(r.canRetry=!1,r.isTae46=!0,w==="ConvIdCouldNotBeFound"&&r.numRetries<r.maxRetries&&(r.canRetry=!0)),g&&(a.cleanUpStopwatch(g),g.stop("MsgInPreviewFailure")),g=r.stopwatch,g&&g.stop("MsgInTabFailure"),r.augmentFormatters(),f=t.cid,r.resetRequestLoadingState(!0);if(t.reason===e.mail.Controller.Messages.Error.moved)r.fireEvent("moved",l),r.sourceFolderInfo=c.sourceFolderInfo?c.sourceFolderInfo:0,r.loading_moved=1;else if(t.code!==e.common.net.Error.abort){if(w==="InvalidConvId")r.conv_deleted_error=1;else if(w==="MessageIdsDeleted"||w==="MessageNotFoundInNonBulk")r.msg_deleted_error=1;r.fireEvent("getFailure",l),r.loading_error=1}(r.loading_error||r.loading_moved)&&r.render()}function v(t,n){var r=this,s,f,l=r.retryPrefix(),c=t.reason,h=n?"preloadFailure":"loadMessageFailure",p=i.Stopwatch,d=p.get("MsgInPreview");clearTimeout(r.slowLoad),d&&(a.cleanUpStopwatch(d),d.stop("MsgInPreviewFailure")),d=r.stopwatch,d&&d.stop("MsgInTabFailure"),r.augmentFormatters();try{f=t?t.data:0,f&&!f.mid&&f.callback&&(f=f.callback.args.primeMsg),s=f?f.mid:0}catch(v){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-mail-ui-mailpane-conv-error:1",v,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-mail-ui-mailpane-conv-error:1"),s=""}r.outboundReq=r.request=null,clearTimeout(r.slowLoad),r.isRetrying=r.loading_slow=0,t.reason===e.mail.Controller.Messages.Error.moved?(r.fireEvent("moved",s),r.sourceFolderInfo=f.sourceFolderInfo?f.sourceFolderInfo:0,f.loading_moved=1):t.code!==e.common.net.Error.abort&&(r.fireEvent("getFailure",s),f.loading_error=1);if(f.loading_error||f.loading_moved)return o(u.msg_loading,f,r.readFormatters,null,strings)}function m(){var t=this,n,r=3;t.maxRetries=r,t.readFormatters.loading_slow||e.mix(t.readFormatters,{show_tae:function(){if(t.isTae4||t.isTae46)return n=t.isTae4?"4":"46",o(u.show_tae,{tae_code:n},null,0,strings)},loading_slow:function(){return t.loading_slow?t.getSlowMarkup():""},conv_loading_error:function(){return t.loading_error?t.getFailureMarkup():""},diff_folder_error:function(){return t.loading_moved?t.getMovedMarkup():""},loading_error:function(e){return t.getFailureMarkup(e)},multi_retry_else:function(e){return o(u.multi_retry_else,e,t.readFormatters,0,strings)},is_perm:function(){return t.numRetries>=r?o(u.is_perm,{msg_fail_tae_code:45},0,0,strings):""},is_perm_else:function(e){return t.numRetries<r?o(u.is_perm_else,e,t.readFormatters,0,strings):""},can_retry:function(){return t.canRetry?o(u.can_retry,null,0,0,strings):""}})}e.namespace("mail.ui");var t=e.mail,n=t.ui,r=n._ConvPane,i=e.common.Utils,s=i.ymmastats,o=i.substitute,u=e.ui.Templates._shared_module_thread_thread_display_rollup,a=n.MessagePaneUtils,f=n.PaneUtils;e.mix(r.prototype,{getFailureMarkup:l,getMovedMarkup:c,getSlowMarkup:h,onFailure:d,onMsgFailure:v,handleSlowRequest:p,augmentFormatters:m})},"1.0.0",{requires:["common-utils","_shared_module_thread_thread_display_rollup","mail-ui-pane-utils"]});
