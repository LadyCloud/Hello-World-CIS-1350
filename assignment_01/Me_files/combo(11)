YUI.add("_shared_module_rte_well_tabs_compose_fresh",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_rte_well_tabs_compose_fresh={base:'<div class="rte"> <ul role="tablist" aria-describedby="tablist-instr"> </ul></div>'};},"1.0.0");YUI.add("_shared_module_compose_dropzone",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_compose_dropzone={base:'<div class="compose-droparea"> <div class="dropzone-text"> <span class="icon icon-attachment"></span> <span>{{str_comp_drag_here}}</span> </div></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_list",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_list={base:'<div id="menu-list" class="optionMenu rte-menu"> <ul> <li data-action="insertunorderedlist"><a href="#" title="{{str_rte_bullet_list_attr}}"><i class="icon icon-list-bullets" title="{{str_rte_bullet_list_attr}}"></i></a></li> <li data-action="insertnumberedlist"><a href="#" title="{{str_rte_numbered_list_attr}}"><i class="icon icon-list-numbers" title="{{str_rte_numbered_list_attr}}"></i></a></li> </ul></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_text_align",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_text_align={base:'<div id="menu-text-align" class="optionMenu rte-menu"> <ul> <li data-action="align-l"><a href="#"><i class="icon icon-align-left" title="{{str_rte_align_l}}"></i></a></li> <li data-action="align-c"><a href="#"><i class="icon icon-align-center" title="{{str_rte_align_c}}"></i></a></li> <li data-action="align-r"><a href="#"><i class="icon icon-align-right" title="{{str_rte_align_r}}"></i></a></li> </ul></div>'};},"1.0.0");YUI.add("_shared_module_offscreen_bin_compose_menu_indent",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_compose_menu_indent={base:'<div id="menu-indent" class="optionMenu rte-menu"> <ul> <li data-action="indent"><a href="#" title="{{str_rte_indentation_more_attr}}"><i class="icon icon-indent" title="{{str_rte_indentation_more_attr}}"></i></a></li> <li data-action="outdent"><a href="#" title="{{str_rte_indentation_less_attr}}"><i class="icon icon-outdent" title="{{str_rte_indentation_less_attr}}"></i></a></li> </ul></div>'};},"1.0.0");YUI.add("mail-captcha-turnkey-iframe",function(B){var A=B.namespace("Mail.Captcha.Turnkey").Iframe=function(E,C){this.el=document.createElement("iframe");var D=B.one(this.el);D.setAttribute("frameborder",0);D.setAttribute("scrolling",0);D.setAttribute("width",E);D.setAttribute("height",C);};B.mix(A.prototype,{cleanup:function(){this.el.parentNode.removeChild(this.el);},getDoc:function(){return this.el.contentDocument;},getBody:function(){return this.getDoc().body;},getHead:function(){return this.getDoc().head;},write:function(C){var D=B.common.Utils.unescapeHtml(C);D=D.replace(/http:\/\/l.yimg.com\//g,"https://s.yimg.com/");this.getDoc().write(D);},makeIframeContent:function(C){return""+"<html><head><style>"+(C.css||"")+"</style><script>"+(C.js||"")+"<\/script></head><body>"+(C.html||"")+"</body></html>";},exec:function(E){var C=Array.prototype.slice.call(arguments,1),D=this.getIn(E);if(typeof D!=="function"){throw new Error(typeof(D)+" is not a function");}return D.apply(this,C);},getIn:function(D,C){if(!D){return;}if(!C){C=this.el.contentWindow;}if(typeof D==="string"){D=D.split(".");}if(D.length===1){return C[D[0]];}var E=D.splice(0,1)[0];C=C[E];if(!C){return;}return this.getIn(D,C);},assocIn:function(E,D,C){if(!E){return;}if(!C){C=this.el.contentWindow;}if(typeof E==="string"){E=E.split(".");}if(E.length===1){C[E[0]]=D;return(C[E[0]]);}var F=E.splice(0,1)[0];C=C[F]||(C[F]={});return this.assocIn(E,D,C);}});},"0.0.1",{requires:["node","common-utils"]});YUI.add("mail-captcha-turnkey-view",function(E){var B=350,C=180,A='<div style="width:'+B+"px;height:"+C+'px;"></div>',F={X:50,Y:130};var D=E.namespace("Mail.Captcha.Turnkey").View=function(G){var H=this;this.markup=G.markup;this.script=G.script;this.css=G.css;this.el=document.createElement("div");this.yel=E.one(this.el);this.iframe=new E.Mail.Captcha.Turnkey.Iframe(B,C);this._onComplete=E.bind(this._onComplete,this);this._onReject=E.bind(this._onReject,this);this.content=G.content;E.Object.each(this.events,function(I,J){H.yel.on(J,E.bind(H[I],H));});};E.mix(D.prototype,{COMPLETE_CALLBACK:"YAHOO.CAPTCHA.hook.complete",REJECT_CALLBACK:"YAHOO.CAPTCHA.hook.reject",TEMPLATE:'<div class="captcha-iframe"></div>',events:{"click":"_submitHandler"},_submitHandler:function(){this.injectCallbacks();this.iframe.exec("YAHOO.CAPTCHA.hook");if(this.captchaDlg){this.captchaDlg.destroy();}},_createCaptchaDialog:function(I){var J=this,G={hd:strings.str_comp_captcha_modal_header,bd:A,centered:true},H={ok:{handler:I.okCallback,stopDestroy:true},cancel:{handler:I.cancelCallback,stopDestroy:false}};E.common.ui.DialogHelper.confirm(G,H,function(L){var K=L._parentNode.one(".modal-bd");L.set("width",I.width+"px");L.set("height",I.height+"px");L._parentNode.one(".modal").setStyle("width",I.width+"px");J.el.innerHTML=J.TEMPLATE;E.one(J.el).one(".captcha-iframe").appendChild(J.iframe.el);K.setContent("");K.appendChild(J.el);J.embedTurnkeyCaptcha();if(typeof(I.createdCallback)==="function"){I.createdCallback(L);}});},_createInvisibleCaptcha:function(){this.invisibleCaptchanNode=E.Node.create('<div class="invisible-captcha-node"></div>');this.invisibleCaptchanNode.appendChild(this.iframe.el);E.one("body").appendChild(this.invisibleCaptchanNode);this.embedTurnkeyCaptcha();this._submitHandler();E.all(".invisible-captcha-node").setStyle("display","none");},render:function(){var H=this,G={okCallback:E.bind(this._submitHandler,this),cancelCallback:function(I){H._reject(I);},width:(B+F.X),height:(C+F.Y),createdCallback:function(I){H.captchaDlg=I;}};if(H.content.Mode==="invisible"){H._createInvisibleCaptcha();}else{H._createCaptchaDialog(G);}},invoke:function(H,G){this._resolve=H;this._reject=G;},embedTurnkeyCaptcha:function(){var G=this.iframe.makeIframeContent({html:this.markup,css:this.css,js:this.script});this.iframe.write(G);},injectCallbacks:function(){this.iframe.assocIn(this.COMPLETE_CALLBACK,this._onComplete);this.iframe.assocIn(this.REJECT_CALLBACK,this._onReject);},cleanup:function(){this.el.parentNode.removeChild(this.el);},_onComplete:function(G){this._resolve(G);},_onReject:function(G){this._reject(G);}});},"0.0.1",{requires:["common-ui-dialog-helper","mail-captcha-turnkey-iframe","oop","node"]});YUI.add("mail-views-send-validation-error-handlers",function(e){function t(e){this.composeView=e}t.prototype={SEND_STATES:{ADDRESS_INVALID:"addInvld",ADDRESS_EMPTY:"addEmpty",SUBJECT_AND_CONTENT_INVALID:"sbCntInvld",SPAM_DETECTED:"spame"},_makeInvalidAddressMessage:function(t){return strings.str_comp_invalidAddressA+"<br><br>"+e.common.Utils.escapeHtml(t)+"<br><br>"+e.common.Utils.substitute(strings.str_comp_invalidAddressB,null,null,null,strings)},handleAddressInvalid:function(e){var t=strings.str_comp_title_invalidAddr,n=this._makeInvalidAddressMessage(e);this.composeView._alertProblem(t,n),this.composeView.lastSendState=this.SEND_STATES.ADDRESS_INVALID},handleNoRecipients:function(){var t=strings.str_comp_title_emptyToField,n=strings.str_comp_emptyToField;this.composeView._alertProblem(t,n),this.composeView._registerFocus(e.one("#to-field")),this.composeView.lastSendState=this.SEND_STATES.ADDRESS_EMPTY},handleTooManyRecipients:function(){var e=strings.str_comp_dialogheader,t=strings.str_comp_send_toomanyrecipients;this.composeView._alertProblem(e,t)},handleUploadInProgress:function(){var e=strings.str_comp_dialogheader,t=strings.str_comp_still_uploading;this.composeView._alertProblem(e,t)},handleBadAttachments:function(e){var t=e?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments,n=e?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments;this.composeView._alertProblem(t,n)},handleEmptyMessage:function(t,n){var r=strings.str_modal_send_msg_title,i=strings.str_comp_invalidSubject,s=strings.str_comp_send,o=this;this.composeView.confirm(r,i,function(){t()},function(){n(),o.composeView.restoreAfterDialog(e.one("#subject-field"))},s),this.composeView.lastSendState=this.SEND_STATES.SUBJECT_AND_CONTENT_INVALID},handleSpame:function(){var e=strings.str_comp_title_spame,t=strings.str_comp_spame;this.composeView._alertProblem(e,t),this.composeView.lastSendState=this.SEND_STATES.SPAM_DETECTED},handleCaptcha:function(t,n,r){r.captchaAnswer=null;var i=r.captcha.captchaPayload.createResponse.Content,s=new e.Mail.Captcha.Turnkey.View({markup:i.Turnkey,script:i.Javascript.CONTENT,css:i.CSS.CONTENT,content:i});(new Promise(function(e,t){s.render(),s.invoke(e,t)})).then(function(e){r.captchaAnswer=e,t()})["catch"](n)},handleNewRecipients:function(t,n,r){var i=e.mail.Controller.ReplyProcessor,s=r.draft,o={to:s.to,cc:s.cc},u,a;u=i.getParentMsg(s,{fetchGDM:!0}),u.then(function(f){var l=new e.Mail.Models.Serializers.DraftGdmUnserializer,c={},h={},p,d,v;c.oMsg=f,c.action="reply_all",c.fid=e.common.Utils.getVal(s,"origin.parentMsg.fid"),p=i.getHeaderContent(c),d=i.matchRecipients(o,p),d.hasNewRecipients&&l.hasNonInlineAttachments(c.oMsg)?(a={ok:function(){e.fire("mt:click",{action:"cmps_dlg_attch_rply_ok"}),l.addNonInlineAttachments(s,f),r&&(r.attachOnSend=!0),t()},cancel:function(r){v=e.common.Utils.getVal(r,"item").hasClass("icon")&&e.common.Utils.getVal(r,"item").hasClass("close"),v?(e.fire("mt:click",{action:"cmps_dlg_attch_rply_cls"}),n()):(e.fire("mt:click",{action:"cmps_dlg_attch_rply_no"}),t()),t()}},h={hd:strings.str_comp_new_recipient_added,bd:strings.str_comp_new_recipient_body,suppressRestoreFocus:!0},e.common.ui.DialogHelper.confirm(h,{ok:{text:strings.str_comp_new_recipient_dialogue_ok_button,handler:a.ok},cancel:{text:strings.str_comp_new_recipient_dialogue_cancel_button,handler:a.cancel}})):t(f)},function(t){n(t)})}},e.namespace("mail.Views").SendValidationErrorHandlers=t},"1.0.0",{requires:["common-utils","node","mail-captcha-turnkey-view","mail-controller-reply-processor","mail-models-serializers-draft-gdm-unserializer"]});
YUI.add("mail-ui-composetictacapi",function(e){function o(e){var t=[],n=e.map(function(e,n){var r=e.label,i=e.className||"";if(i!=="parent-attach-file")return'<li class="'+i+'" role="presentation">'+'<a role="menuitem" data-action="'+n+'" tabindex="-1">'+r+"</a></li>";t.push(u(e))});return n.unshift("<ul>"),n.push("</ul>"),t.unshift(n.join("")),t.join("")}function u(e){var t=e.className,n=e.label,r=0;return'<ul><li class="'+t+'" role="presentation">'+'<a role="menuitem" data-action="attachFromParent" tabindex="-1">'+n+"</a></li> </ul>"}function a(e){var t=this;t._handles=[],t.editor=e,t.editor.once("ready",function(){s.get("composeEditor").forEach(t._plugEditorPlugin,t),t._handles.push(s.on("added:composeEditor",t._plugEditorPlugin,t))})}var t=e.common.ui.MenuHelper,n=e.mail.Controller.ReplyProcessor,r=e.common.Utils.features,i=e.common.Utils,s=e.Mail.Services.Plugins;a.prototype={render:function(e){var t=this;t._parent=e,t._renderMenu(),t._handles.push(s.on("added:composeUploader",t._renderMenu,t))},bindUI:function(){},destroy:function(){var e=this;e._menuContainer&&(e._menuContainer.remove(),e._menuContainer.destroy(!0)),e._handles.forEach(function(e){e.detach()})},_plugEditorPlugin:function(e){var t=this;e.getPlugin().then(function(e){t.editor.getRTE().plug(e)})},_attachFromComputerMenuitem:function(){var e=this;return{label:strings.str_comp_attachment_from_computer,className:"menu-attach-file",choose:function(){return window.setTimeout(function(){e._parent.one("#attachment-button-input").getDOMNode().click()},1),Promise.resolve([])}}},_showIncludeOriginalAttachOptn:function(t){var r=this,s=i.getVal(r,"editor.composeView.draft"),o=i.getVal(r,"editor.composeView.draft.origin"),a=i.getVal(o,"action"),f,l,c,h,p,d;c=e.common.Utils.getVal(s,"attachments"),c.forEach(function(e){e.isInline()||(l=!0)}),a==="edit"&&!l&&(d=s.makeInReplyTo(),i.getVal(d,"replied")&&(a="reply_sender")),p=n.getParentMsg(s,{fetchGDM:!1}),p.then(function(n){var i=0,s=n.attachments,o;if(!n)return;for(i=0;i<s.length;i++){o=s[i];if(o.disposition!=="inline"&&o.referencedInline!==!0){h=!0;break}}r._menuContainer&&(!l&&h&&a==="reply_all"||a==="reply_sender")&&(t.push(r._includeParentAttachment()),r._menuContainer.append(u(r._includeParentAttachment())))},function(t){})},_includeParentAttachment:function(){var t=this,r=i.getVal(t,"editor.composeView.controller"),s;return{label:strings.str_comp_attach_parent,className:"parent-attach-file",attachmentHandler:function(){var i=t.editor.rte.composeView.draft;s=n.includeAttachment(i,{fetchGDM:!0}),s.then(function(){var n=e.one(".parent-attach-file");n&&(n.addClass("disabled"),r.attachInReply=!1),Promise.resolve([])},function(){Promise.reject([])})}}},_renderMenu:function(){var n=this,u=i.getVal(n,"editor.composeView.draft.origin");n._uploaders=s.get("composeUploader");if(n._uploaders.length===0)return;window.FormData&&window.FileReader&&n._uploaders.unshift(n._attachFromComputerMenuitem()),r.enabled("attachInReply")&&e.common.Utils.getVal(u,"parentMsg.flags.hasAttachment")&&n._showIncludeOriginalAttachOptn(n._uploaders),n._menuContainer&&(n._menuContainer.remove(),n._menuContainer.destroy(!0)),n._menuBtn=n._parent.one(".attach-btn-menu"),n._menuBtn.removeClass("hidden"),n._menuBtn.on("click",function(r){t.create(r.currentTarget,{menu:n._menuContainer,blur:!0},function(){r.preventDefault(),n._menuContainer.on("menuSelected",function(t){var r,i=n._uploaders.length;t.dataAction==="attachFromParent"?(r=e.one(".parent-attach-file"),r&&!r.hasClass("disabled")&&(e.fire("mt:click",{action:"cmps_attchReply_mnu"}),n._uploaders[i-1].attachmentHandler())):n._uploadMenuOptionSelected(t.dataAction)})})}),n._menuContainer=e.Node.create('<div class="optionMenu"></div>'),n._menuContainer.append(o(n._uploaders)),e.one("body").append(n._menuContainer)},_uploadMenuOptionSelected:function(e){var t=this,n=t._uploaders[e];n.choose().then(function(e){t.editor.getRTE().fire("cardify",e.cardInfo,e.type)},function(){})}},e.namespace("mail.Views").ComposeTictacApi=a},"1.0.0",{requires:["event-custom","common-ui-menu-helper","mail-services-plugins","mail-controller-reply-processor","mail-common-utils-features"]});
YUI.add("rte-file-utils",function(e){var t={dragObjContainsFiles:function(e){var t=0;if(e.dataTransfer.types)for(t=0;t<e.dataTransfer.types.length;t++)if(e.dataTransfer.types[t]==="Files")return!0;return!1},dragObjContainsOnlyImages:function(e){var t=0,n;if(!e.dataTransfer||!e.dataTransfer.types||!e.dataTransfer.items&&!e.dataTransfer.files)return!1;n=e.dataTransfer.items||e.dataTransfer.files;for(t=0;t<n.length;t++)if(n[t].type.indexOf("image")!==0)return!1;return!0},dragShouldShowDropzone:function(e){var t=0;if(e.dataTransfer.types)for(t=0;t<e.dataTransfer.types.length;t++)if(e.dataTransfer.types[t]==="Files"||e.dataTransfer.types[t]==="showdroptarget")return!0;return!1},dragObjectIsOnlyText:function(e){var t=0,n=e.dataTransfer,r;if(n&&n.types)for(t=0;t<n.types.length;t++){r=n.types[t];if(r!=="text/plain"&&r!=="text/html"&&r!=="text/_moz_htmlinfo"&&r!=="text/_moz_htmlcontext"&&r.toLowerCase()!=="text"&&r.toLowerCase()!=="public.utf8-plain-text"&&n.getData(r))return!1}return!0},getFilteredFile:function(e,t){var n=e.dataTransfer&&e.dataTransfer.files||[],r=[];return n=[].slice.call(n),r=n.filter(function(e){switch(t){case"image":return e.type.indexOf("image")>=0;case"nonimage":return e.type.indexOf("image")<0;default:return!0}}),r},inlineImageEnabled:function(){return window.FileReader&&window.URL&&e.mail.Core.feature("inlineimage").isOn()&&e.mail.Core.feature("ymrte").isOn()},canProcessImage:function(e){return e.dataTransfer&&e.dataTransfer.types&&window.FileReader&&window.URL?!0:!1},doesClipboardContainFiles:function(e){var t=e.clipboardData&&e.clipboardData.types;return t&&t.length>0?(t=Array.prototype.slice.call(t,0),t&&t.indexOf("Files")>=0?!0:!1):!1},getFileFromDataURI:function(e){var t=e.match(/^data:(.+)?;(.+?),/),n,r,i,s,o,u,a;if(!t||!window.atob)return null;i=e.split(",")[1],t[2]==="base64"?n=atob(i):n=window.unescape(i),u=n.length,r=t[1],s=new Uint8Array(u);for(o=0;o<u;o++)s[o]=n.charCodeAt(o);return a=new Blob([s],{type:r}),a.name="datauri-file."+r.substring(6),a},getFilesfrmDragObj:function(e){return e.dataTransfer.files||[]},getImageFilesfrmClipBoard:function(e){var t=0,n=[],r,i;i=e.clipboardData.items||e.clipboardData.files;for(t=0;t<i.length;t++){r=i[t].getAsFile?i[t].getAsFile():i[t];if(!(r&&r.type.indexOf("image")>=0))return[];r.name="blob.jpg",n.push(r)}return n}};e.namespace("mail.rte").fileUtil=t},"0.0.1",{requires:[]});
YUI.add("mail-ui-fullcompose-v3",function(e){function S(t){var n=this,r,i;n.composeViewRendered&&(n.isDraft?r="draft":(i=n.draft&&n.draft.get&&n.draft.origin,r=i?i.action:null),r=r||"new",e.Lang.later(90,null,function(){n.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+r})})),t.cbk&&t.cbk()}function x(e){var t=this;t.get("isQuickReply")||t.header.hideACWidget(),t.dirty&&t.dirty!=="ForceClose"&&NeoConfig.saveOnHideCompose&&(t.isAutoSave=!0,t.save()),t.hiliteCP&&t.hiliteCP.hide(),t.textCP&&t.textCP.hide(),e.cbk&&e.cbk()}function T(){var e=this,n=e.baseNode,r=n.one(".cm-subject-field"),i=n.one("input.cm-subject-field");return i.ancestor("div").removeClass(v),{subjectVal:t(r.get("value")),subjectDir:NeoConfig.bidi?r.getStyle("direction"):null}}function N(){var t=this,n=t.draft,r=t.closeSrc,i,s=n.origin;s&&s.action!==null?s=s.action:s="new",i={action:"cmps_tab_cls",append:{t1:"cmpsTb",ltxt:s,cmpsType:t.get("isQuickReply")?"QR":"fullCmps"}};switch(r){case"closeBtn":break;case"escKey":i.append.actn="keybrd";break;case"cancelBtn":i.action="tlbr_cancelcompose"}t.set("close",1),e.fire("mt:click",i)}function C(){var t=this,n=t.attComposer,r;t.blockSave=!0,t.saveTimer&&t.saveTimer.cancel(),t.resizeRTEDelayTimer&&t.resizeRTEDelayTimer.cancel(),t._clearOriginTimers(),t.hiliteCP&&t.hiliteCP.hide(),t.textCP&&t.textCP.hide(),!e.Lang.isNull(t.spellCheckView)&&!e.Lang.isUndefined(t.spellCheckView)&&t.spellCheckView.destroy(),t.spellCheckView=null,n&&(n.cleanup(),t.attComposer=null),t.tray&&t.tray.destroy(),r=t.rteFormatter,r&&(r.fontFamilyOptions&&r.fontFamilyOptions.remove().destroy(!0),r.fontSizeMenu&&r.fontSizeMenu.remove().destroy(!0),r.fontNameMenu&&r.fontNameMenu.remove().destroy(!0),r.formatButtons&&r.formatButtons.remove().destroy(!0),r.fontColorMenu&&r.fontColorMenu.remove().destroy(!0),r.textIndentation&&r.textIndentation.remove().destroy(!0),r.textAlignment&&r.textAlignment.remove().destroy(!0),r.textLists&&r.textLists.remove().destroy(!0),r.emotionMenu&&r.emotionMenu.remove().destroy(!0)),t.rtSwitch=null,t.baseNode&&(e.each(t.handles,function(e){e.detach()}),t.handles=null,t.baseNode.remove().destroy(!0)),t.composeTictacApi.destroy(),t.rteFormatter&&(t.rteFormatter.destroy(),t.rteFormatter=null),t.header=null,t.formatters=null,t.container=null,e.fire("compose:rte:blur"),E.superclass.ondestroy.call(this,arguments)}function k(){var e=this,t,n=e.baseNode.one(".ac-input.focus .recipient-input input");n&&e.header._lozengeIt(n),t=e.baseNode.all(".compose-header .field .hLozenge");if(t.size()>100){this._warnTooManyRecipients();return}e._invokeSend(!0)}function L(){var e=this;e._cancelSaveTimer(),e.controller.send()}function A(){e.use("common-ui-dialog-helper",function(){a.ui.DialogHelper.alert({hd:strings.str_comp_dialogheader,bd:strings.str_comp_send_toomanyrecipients,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})})}function O(t){if(!this.dropzone){var n=c(h._shared_module_compose_dropzone.base,{},0,0,strings);this.dropzone=e.Node.create(n),t?(this.baseNode.one(".footer-separator").appendChild(this.dropzone),this.baseNode.one(".footer-separator").setStyles({position:"relative",maxHeight:"200px"}),this.baseNode.one(".bottomToolbar").removeClass("smartFixed")):this.baseNode.appendChild(this.dropzone)}}function M(){this.dropzone&&(this.dropzone.remove(),this.dropzone=null,o.inlineImageEnabled()&&(this.baseNode.one(".footer-separator").setStyles({position:null,maxHeight:null}),this.doResizeRTE(),e.fire("recalculateScrollToRepositionSend")))}function _(e){var t=e.cloneNode(!0),n=e.parentNode;return t.value=null,n.replaceChild(t,e)}function D(){function u(e){return"quoted-text"===e.getAttribute("data-action")}function a(n){u(n.target)&&(t._expandQuotedReply(),e.fire("mt:click",{action:"cmps_qtd_txt"}))}var t=this,n=t.draft,r=t.handles,s;t.attachIcon=t.baseNode.one(".attachment-button-attach"),NeoConfig.backButtonFull||e.fire("initPage"),r.push(t.editor.on({keyDown:function(n){var r=!1;e.fire("HoverCard:hideHoverCard");if(n.ctrlKey||n.metaKey||n.altKey||n.shiftKey||n.keyCode===27||n.keyCode===40)r=t.get("keydownHandler")?t.get("keydownHandler")(n):t.onKeyDown(n);r?n.halt():(t._setDirty(),t.uploadFormDirty&&H(t),setTimeout(function(){t.get("isQuickReply")&&t.resizeRTE()},0))},focus:function(n){t._registerFocus(n.editor),t.header._removeLozengeHighlights(),e.fire("compose:rte:active",{editor:n.editor,cv:t})},blur:function(n){e.fire("compose:rte:blur",{editor:n.editor,cv:t})},nodeChange:function(e){e&&(e.type==="paste"||e.type==="drop"||e.type==="undoLoadState")&&t._setDirty()},ready:function(){t.postRender(),t.focusNode&&t.setFocus(t.focusNode)}})),r.push(n.on("compose:restoreFocus",function(){t.focusNode instanceof e.Node?t._restoreFocus():t.setFocus("body",0,1)},t)),r.push(t.baseNode.delegate("click",function(n){var r=n.currentTarget,i=r.get("parentNode"),s=i.hasClass("cc-btn")?"cc":"bcc",o=i.get("id");n.halt(!1);var u=o==="btn-show-"+s+"-in-to"||o==="btn-show-"+s+"-in-cc",a="cmps_"+(u?"shw"+s:"hd"+s);t.header._cmdBccSwitch(u,"bcc"),t.header._cmdBccSwitch(u,"cc"),e.fire("mt:click",{action:a,append:{t1:"cmpsTb"}}),t._restoreFocus()},"span.cc-btn a, span.bcc-btn a")),r.push(t.compArea.on("click",a)),r.push(t.compArea.on("key",a,"enter")),r.push(t.compArea.on("key",function(e){var n,r;e.keyCode===38?u(e.target)?t.editor.setFocus():e.target.ancestor(".attachments-well",!0,"#rtetext")&&(r=t.baseNode.one(".compose-quoted-text:not(.hidden) .qtd-expansion-text"),r?r.focus():t.editor.setFocus()):e.keyCode===40&&u(e.target)&&(n=t.baseNode.one(".attachments-well:not(.hidden)"),n&&n.focus()),e.stopPropagation()},"down:38,40")),r.push(t.baseNode.delegate("click",function(){t._clearOriginTimers(),t._displayLoading(),i.fetchOrigin(n,t.isDraft,t._getTextMode())},"a.retryOrigin")),t.on("renderComplete",function(){t.contentLoaded=!0,e.use("mail-controller-sendconfirm","mail-ui-sendconfirmview-base-conv",function(){})}),t._addFocusListenersFresh(),r.push(t.baseNode.on("keydown",
function(e){var n,r=e.target;e.keyCode===13&&r.ancestor("div.rte-well-container")&&(e.halt(),t.focusNode=r,n=r.one("b"),n&&n.simulate("click"))})),r.push(t.baseNode.delegate("click",function(e){var n=f.getDataAction(e).action;t.handleComposeAction(n,e)},".bottomToolbar > span")),r.push(t.baseNode.delegate({click:function(){H(t)},focus:function(){var e=t.baseNode.one("#attachment-button-input");e.ancestor("span").addClass("focused")},blur:function(){var e=t.baseNode.one("#attachment-button-input");e.ancestor("span").removeClass("focused")},change:function(){var e=this.getDOMNode();window.FormData&&window.FileReader?t.fire("attachmentUpload",{files:[].slice.call(e.files)}):e.value!==""&&(this.uploadFormDirty=!0,t.fire("attachmentUploadForm",{inputEl:e}))}},"#attachment-button-input")),t.baseNode.one(".attachments-pane").removeClass("hidden"),r.push(t.baseNode.on("drop",function(e){var n=e._event.dataTransfer.files;n&&n.length&&t.fire("attachmentUpload",{files:[].slice.call(n)})})),s={dragover:function(n){var r=o.inlineImageEnabled();if(e.Array.indexOf(n._event.dataTransfer.types,"Files")>=0||e.Array.indexOf(n._event.dataTransfer.types,"showdroptarget")>=0)clearTimeout(t._dragTimer),t._showDropzone(r);n.preventDefault()},dragleave:function(e){var n=window.innerWidth,r=window.innerHeight,i=e.clientX,s=e.clientY;i<=0||i>=n||s<=0||s>=r?t._hideDropzone():(clearTimeout(t._dragTimer),t._dragTimer=setTimeout(function(){t._hideDropzone()},300))},drop:function(n){t._hideDropzone(),e.fire("dropHandled"),n.preventDefault()}},window.FileReader&&r.push(e.one("body").on(s)),r.push(e.on("dropHandled",function(){t._hideDropzone()})),r.push(e.on("windowresize",function(){t.resizeRTE()})),t._showSendBtn(!1),t.composeTictacApi.bindUI()}function P(){var t=this.baseNode.one(".attachment-button-form"),n=t.one("#jsonString"),r=2,i=this.draft.attachments.filter(function(e){return e.state()==="pending"}),s=JSON.parse(this.draft.jsonify({iframeUpload:{multipartName:"uploadfile"}}));s.actions.responseContentType="text/plain",i.forEach(function(e){e.setPartId(r),r++,e.setProgress(.5)}),n||(n=e.Node.create('<input type="hidden" name="jsonString" id="jsonString">'),t.insertBefore(n,t.get("firstChild"))),n.set("value",JSON.stringify(s)),this.draft.formId=t.get("id")}function H(e){var t=e.baseNode.one(".attachment-button-form");t&&t._node.reset(),e.uploadFormDirty=!1}function B(e){e?this.neoFire("composeEvent",{action:"showSendBtn"}):this.neoFire("composeEvent",{action:"hideSendBtn"})}function j(){var e=this,t=e.rteFormatter,n=e.handles;t.bindUI(),n.push(t.on("formatter:action",function(t){e._setDirty(),e._setComposePreference(t.act,t.val)})),n.push(e.after("isRichTextChanged",function(){e.editor.set("isRich",!NeoConfig.low_bandwidth&&e.isRichText),e.rteFormatter&&e.rteFormatter._switchEditMode(e.isRichText)})),e._intlBindUIRTE()}function F(){var t=this,n=l.enabled("spellCheck"),r,i,s,o;r=t.rteFormatter=new e.mail.ui.RTEFormatter({isBidi:NeoConfig.bidi,isSpellCheckEnabled:n,editor:t.editor,globalPathImage:t.formatters.global_path_img()}),r.renderUI(t.baseNode.one(".rte-well-container")),r._switchEditMode(t._isRTEActive()),t._bindWellUIFresh(),i=t.richFontInfo.fontFamily,s=t.richFontInfo.fontSize,s&&(o=parseInt(s.replace("pt",""),10),o=e.Array.indexOf(g,o),o>=0&&(r.selectedFSIndex=o+1)),r.selectedFNIndex=i,n&&t._initializeSpellCheck(),t._bindTextSwitchFresh()}function I(){var t=this,n,r,i=t.getRTEDocNode(),s=t.compArea.one(".compose-quoted-text"),o=i.one(".yahoo_quoted"),u=t.quotedTextBody,a;i.append(t.quotedTextBody),t.quotedTextBody="",p._insertEmptyLineBeforeQuotedText(i),o&&o.setStyle("display","block"),n=f.getVal(t.draft.origin,"yqtdPrefix");if(n)for(r=0;r<n.length;r++)a=t.getRTEDocNode().one("."+n[r]+"yahoo_quoted"),a&&a.setStyle("display","block");s&&s.remove(),e.fire("processedEditorHtml",{processHtml:function(t){var r=e.Node.create("<div>"+t+u+"</div>");return p._expandQuotedText(r,n)},rteNode:i}),e.fire("recalculateScrollToRepositionSend"),t.resizeRTE()}function q(){var e=this;e.hasRTEFormatter&&e.initializeRTEFormatter(),e.baseNode.one(".attachments-pane").addClass(d)}function R(){}function U(t){var n=this,r,s;if(t){n.parent=t,r=c(h._shared_module_compose_fresh_conv.base,n.draft,n.formatters,null,strings,h),t.append(r),n.baseNode=t.one(".compose"),n.get("isQuickReply")||(n.baseNode.addClass("full-compose"),n.baseNode.addClass("content")),n.compArea=n.baseNode.one("div.compose-message").one("div.inner"),n.loadingArea=n.compArea.one("div.msg-loadingpane"),n.footer=n.baseNode.one(".footer-separator");var o=i.getDefaultFontInfo(!n._isRTEActive());n.richFontInfo.fontFamily=o.fontFamily,n.richFontInfo.fontSize=o.fontSize,s=n.baseNode.one("div.cm-plaintext"),s&&s.get("parentNode").removeChild(s),e.UA.gecko&&n.compArea.ancestor("td").setStyle("height","0"),n.header.enableHeader(!1),n._renderWellsFresh(),n.bindUI(),n.header.render(),n.header.bind(),n.composeViewRendered=!0,n.editor.render(n.baseNode);var u=n.baseNode.one(".attachments-well");z(this,u)}}function z(t,n){t.tray=new e.Tray({model:t.draft,container:n,filesView:n.one(".file-attach"),thumbnailsView:n.one(".thumbnails-attach")}),t.tray.on("attachmentRemoved",function(){t._setDirty(),t.save()}),t.tray.render()}function W(){var e=this,t=e.footer.getY();e.footer.setStyles({position:"fixed",top:t+"px"})}function X(){NeoConfig.tabs&&!NeoConfig.hasConvView?(this.resizeRTEDelayTimer&&this.resizeRTEDelayTimer.cancel(),this.resizeRTEDelayTimer=e.later(300,this,this.doResizeRTE)):this.doResizeRTE()}function V(){var t=this,n,r,i=7,s=0,o,u=0,a,f,c=l.enabled("richcompose"),h=c?500:300,p=953,d=t.baseNode.one("div.attachments-well");u=d?d.getStyle("height"):0,u=u==="auto"?0:parseInt(u,10),o=e.one("body").get("offsetHeight");if(t.get("close"))return;if(!t.get("isQuickReply")){n=parseInt(t.compArea.getY(),10),r=parseInt(t.compArea.getComputedStyle("paddingBottom"),10),o=e.one("body").get("offsetHeight"),a=o-n-w-r;var v=a-.2*o;v>h&&(v=h);if(l.enabled("fullheightcompose")||c&&o<=p)
v=a-i,s=20,t.baseNode.one("#to").addClass("fullheight-input"),t.baseNode.one("#cc").addClass("fullheight-input"),t.baseNode.one("#bcc").addClass("fullheight-input");t.compArea.setStyles({maxHeight:a+"px",minHeight:v+"px"}),f=v-u-s>0?v-u-s:0,t.editor.rteArea.setStyles({minHeight:f+"px"})}else if(!NeoConfig.smartscroll){parseInt(t.baseNode.getStyle("height"),10)>t.maxHeight&&(t.maxHeightFn&&(t.maxHeight=t.maxHeightFn()),t.compArea.setStyles({maxHeight:t.maxHeight-parseInt(t.header.hdr.getStyle("height"),10)-w+"px"}));var m=t.baseNode.get("parentNode").get("offsetTop")-t.containerNode.get("scrollTop")+parseInt(t.baseNode.getStyle("height"),10)+6-t.containerNode.get("offsetHeight");m>0&&t.containerNode.set("scrollTop",t.containerNode.get("scrollTop")+m)}}function $(){function i(i){var s=i.params,o,u,a,f,l={format:1};if(!l.hasOwnProperty(s.tab))return;if(!t.baseNode)return;s.tooltip=s.tooltip||"";if(s.tab!=="format")return;u=s.name||"Stationery",a='<span class="btn menu" data-app="'+i.appInstance+'">'+'<a class="icon '+u+'" href="#" title="'+s.tooltip+'">'+'<i role="presentation" class="plaintext">'+s.label+"</i></a></span>",f=n(a);try{t.baseNode.one("."+s.tab+"-pane").one(".om-buttons").append(f)}catch(c){}o=e.stamp(f),r.push(f.on("click",function(e){e.preventDefault(),i.handler(o,t)})),r.push(e.on("om:click_btn",function(e){if(!e.app||!e.app.instance||!e.tab)return;i.appInstance===e.app.instance&&i.handler(o,t)}))}var t=this,r=t.handles;e.each(u,i),r.push(e.on("om:compose_add_btn",function(){i(u[u.length-1])}))}function J(t,r,i){var s=this,o=s.handles,u=n('<ul class="om-buttons"></ul>'),a=s.baseNode.one("div.rte-well-container");e.UA.ie===0&&(u.appendChild(t),a.addClass("largefiles")),e.Tictac&&e.Tictac.flickr&&(u.appendChild(i),o.push(i.on("click",function(t){e.fire("mt:click",{action:"cmps_attflk",append:{t1:"cmpsTb"}}),t.preventDefault()})),a.addClass("largefiles")),e.Tictac&&e.Tictac.dropbox&&(u.appendChild(r),o.push(r.on("click",function(t){e.fire("mt:click",{action:"cmps_attlgfl",append:{t1:"cmpsTb"}}),t.preventDefault()})),a.addClass("largefiles")),s.attComposer&&(s.attComposer.attachLargeBtn=u),o.push(e.on("om:click_btn",function(e){if(!e.app||!e.app.instance||!e.tab)return}))}function K(){var t=this,n,r,s,o,u,a,f=t.draft;t._bindDraft(),t._isOrigin()?(t.slowOriginReqTimer=setTimeout(function(){t._handleSlowOriginRequest()},b),t.loadingTimer=setTimeout(function(){t._displayLoading()},y),t.editor.hideArea(),i.fetchOrigin(f,t.isDraft,t._getTextMode(),t.stopwatch),t.isDraft?t.hasHardDraft=!0:(s=f.origin,e.Lang.later(90,null,function(){t.neoFire("composeEvent",{action:"darlaEvent",type:"compose_"+s.action})})),n=f.origin.oMsg,r=n&&n.header&&n.header.to,a=n&&n.header&&n.header.xapparentlyto,t.header.setReplyFrom(r,a),o=n.header?n.header.from:n.from,o&&t.isDraft&&e.later(10,t,function(){t.header._setFromMenu(o)})):(t.header.setHeader(f),u=f.cc&&f.cc.length>0||f.bcc&&f.bcc.length>0,t._allowEditing(f.body.html,u),t.dirty=t.controller.isPopulated()?!0:!1,e.later(0,t,Et,[f.to&&f.to.length>0?"body":"to"]),t.neoFire("composeEvent",{action:"darlaEvent",type:"compose_new"})),t._initOpenMailButtons(),e.fire("FullCompose:fullComposeReady",{rte:t.editor,rteActive:t._isRTEActive(),context:t}),e.fire("compose-stat:fullComposeReady"),e.fire("read-stat:draftRendered"),!NeoConfig.smartscroll&&t.get("isQuickReply")&&t.compArea.setStyles({minHeight:"150px",maxHeight:t.maxHeight-parseInt(t.header.hdr.getStyle("height"),10)-w-6+"px"}),t.resizeRTE()}function Q(){function i(){var t;if(r[e.rteTabIndex]==="#switchtext-plain"||r[e.rteTabIndex]==="#switchtext-rich")return n.one(r[e.rteTabIndex]);if(!e._isRTEActive()&&r[e.rteTabIndex]===".attach-btn-menu a")return e.rteTabIndex=r.length-1,n.one(r[e.rteTabIndex]);do t=n.one(r[++e.rteTabIndex]);while(!t||t.ancestor().hasClass(d)||t.ancestor().getStyle("display")==="none");return t}function s(){var t;if(e.rteTabIndex===0)return n.one(r[e.rteTabIndex]);if(!e._isRTEActive()&&r[e.rteTabIndex]==="#switchtext-plain")return e.rteTabIndex=1,n.one(r[e.rteTabIndex]);do t=n.one(r[--e.rteTabIndex]);while(!t||t.ancestor().hasClass(d)||t.ancestor().getStyle("display")==="none");return t}function o(t){var n,r,o=e.baseNode.one(".attachments-pane");switch(t.keyCode){case 9:t.shiftKey||(n=e.baseNode.one(".attachments-well"),n&&!n.hasClass(d)?(r=n.one('li.attachmentVisible span.left a[tabIndex="0"]'),r||(r=n.one("li.attachmentVisible span.left a"),r&&r.set("tabIndex",0))):(t.target.blur(),e.setFocus("body"),t.halt()));break;case 13:case 32:t.target!==o?t.target._node.click():t.target.one("input")&&t.target.one("input")._node.click();break;case 37:t.target&&t.target.set("tabIndex",-1),r=s(),r&&r.set("tabIndex",0),r.focus();break;case 39:t.target&&t.target.set("tabIndex",-1),r=i(),r&&r.set("tabIndex",0),r.focus();break;default:}}var e=this,t=e.handles,n=e.baseNode.one("div.rte-well-container"),r=[".attachments-pane","#btn-fontname","#btn-fontsize","span.bold","span.italic","span.underline","#btn-forecolor","#btn-backcolor","#btn-insertunordered","#btn-insertnumbered","#btn-outdent","#btn-indent","span.align-l","span.align-c","span.align-r","#links","#emoticon","span.Stationery","#spellCheck","#btn-spell-langs","#switchtext-plain","#switchtext-rich"];t.push(n.delegate("keydown",o,'div.attachments-pane, span[role="button"]'))}function G(){var e=window.getSelection().getRangeAt(0),t=e.cloneRange(),n=this.getRTEDocNode().getDOMNode(),r=new Range;return r.selectNodeContents(n),t.selectNodeContents(n),t.setEnd(e.endContainer,e.endOffset),t.toString&&r.toString&&t.toString().trim()===r.toString().trim()}function Y(t){var n=this,r=t.keyCode,i=(t.ctrlKey||t.metaKey)&&!t.altKey&&!t.shiftKey,s=e.UA.os,o=t.ctrlKey&&(s==="linux"||s==="windows"||s==="win")||t.metaKey&&(s==="macintosh"||s==="mac"),u,a;switch(r){case 27:a=e&&e.one(".btn-close-msg"),a&&a._node.click();break;case 40:if(n._isAtEndOfRTE()){var f=n.baseNode.one(".compose-quoted-text:not(.hidden) .qtd-expansion-text"),l=n.baseNode.one(".attachments-well:not(.hidden)"
);f?f.focus():l&&l.focus()}break;case 85:o&&t.shiftKey&&!e.UA.ie&&(!e.UA.gecko||e.UA.gecko>1.92)&&(u=n.baseNode.one(".attachments-pane input"),u._node.click(),t.halt());break;case 13:if(o&&!t.altKey){var c={spid:"sent",append:{t1:"cmpsTb",actn:"keybrd",cmpsType:n.get("isQuickReply")?"QR":"fullCmps"},action:"tlbr_send"};return n.lastSendState&&(c.append.ltxt=n.lastSendState),e.fire("mt:click",c),n.send(),t.frameEvent&&t.frameEvent.halt(),t.halt(),!0}if(t.target.get("nodeName")==="A")return t.target.simulate("click"),!0;break;case 65:i&&n._expandQuotedReply();break;case 83:if(i)return n.isAutoSave=!1,n.save(),t.frameEvent&&t.frameEvent.halt(),t.halt(),!0;break;case 88:if((t.ctrlKey||t.metaKey)&&t.shiftKey&&!t.altKey)return t.frameEvent.halt(),NeoConfig.bidi&&(n.editor.invokeCommand("swapdir",null),n.fire("formatter:action",{act:"swapdir",val:null})),!0;break;case 89:if((t.ctrlKey||t.metaKey)&&t.shiftKey&&!t.altKey)return t.halt(),n.allowEdit&&n._cmdTextSwitch(),!0;break;case 219:case 221:e.fire("tabview:handleKeyDown",t);break;default:}return t.frameEvent&&(t.frameEvent.stopPropagation(),t.shiftKey&&r===9),i?!0:!1}function Z(e){var t=this,n=t.baseNode.one("div.rte-well-container"),r,i=n.one(".attachments-well");t.rteTabIndex=0,i&&!i.hasClass(d)?(i.all("li.attachmentVisible span.left a").each(function(e){!r&&e.get("tabIndex")===0&&(r=e)}),r||(r=i.one("li.attachmentVisible span.left a"),r&&r.set("tabIndex",0))):(r=n.one(".attachments-pane"),r&&r.set("tabIndex",0)),r&&t.setFocus(r),e.frameEvent.halt()}function et(t){var n=e.Node.getDOMNode(t);return n!==null?n.tagName.toUpperCase()==="DIV":!1}function tt(){var t=this,n={msg:{mid:t.draft.mid},fid:"Sent"},r=l.enabled("NotificationsV2");if(r){var i=function(t,r){r==="view"&&e.fire("openMessage",n)};e.use("common-ui-notification-v2",function(e){e.common.ui.NotificationV2.notify(strings.str_comp_msg_sent,{type:"info",cbk:i,duration:4e3,speed:"fast"})})}else{var s=new e.common.ui.Notification({type:"fade",className:"top",parent:"shellcontent",parentType:"id"}),o=e.ui.Templates._shared_module_offscreen_bin_notification_notifications.send_success;s.on("clickEvent",function(t){switch(t.action){case"closeNotification":s.destroy();break;case"view":e.fire("openMessage",n)}}),s.notify(c(o,null,null,null,strings),4e3)}}function nt(){var e=this,t;e.lastSaveType=e.isAutoSave?1:0,e.resetSaveTimer(),e.isAutoSave||(e.hasHardDraft=!0),e.isAutoSave=!1,e.dirty=!1,t=f.dateFormatter(new Date,strings.str_tog_dateformat_rsstime_l10n),t=c(strings.str_comp_saved,0,0,0,{saved_time:t}),e.updateSaveStatusText(t),e.fire("compose:saveSuccess")}function rt(t){var n=this,r,i;n.lastSaveType=-1,n.neoFire("composeEvent",{action:"saveComplete",saveSuccess:!1}),!n.isAutoSave&&!t.notificationDisplayed&&(i=strings.str_error_MessageSaveFailed,e.common.ui.NotificationV2.notify(i,{type:"error",close:!0,speed:"show-medium"})),n.isAutoSave=!1,n._setDirty(),r=strings.str_comp_saveasdraftfail,n.updateSaveStatusText(r),n.fire("compose:saveFail")}function it(e){var t=this;t.baseNode.one(".save-draft-msg")&&t.baseNode.one(".save-draft-msg").removeClass("hidden").set("innerHTML",e)}function st(t){var n=this,r;r=strings.str_tae_unabletosendmsg,n.showComposeShim(!1),t.notificationDisplayed||(t.code==="EP-4010"?n.notifySendAbuse():e.common.ui.NotificationV2.notify(r,{type:"error",close:!0,speed:"show-medium"}))}function ot(){var e=this;e.sendValidationHandlers.handleSpame()}function ut(){var t=this.baseNode.one("#bcc"),n;e.use("minty_module_offscreen_bin_tooltip_growth_onboarding",function(e){n=h.minty_module_offscreen_bin_tooltip_growth_onboarding,e.fire("onboard:tip",{node:t,template:f.ezSub(n.base,{},n),fn:function(){e.fire("onboard:tipclose")},classNames:["growth-onboarding"],offset:[0,t.get("offsetHeight")-130]}),e.one("document").once("click",function(){e.fire("onboard:tipclose")})})}function at(e){var t=this;t.baseNode.one(".composeshim")[e?"removeClass":"addClass"]("hidden"),e?t.baseNode.addClass("sending"):t.baseNode.removeClass("sending"),t.neoFire("composeEvent",{action:"updateTitle",sending:e})}function ft(){var e=this,t=e.draft.attachments,n=e.handles;n.push(t.on("added",function(){e._setDirty(),e.resizeRTE()})),n.push(t.on("deleted",function(){e._setDirty(),setTimeout(function(){e.resizeRTE()},50)})),n.push(t.on("updated",function(t){e.resizeRTE();if(!t.isUploadDone())return;e._setDirty()}))}function lt(e){var t=this;e.reply?t.replyContentChangeAfter(e):e.uiUpdate||(t.draft.body.html?t.editor.setContent(t.draft.body.html,!e.textConvert):t.editor.setContent(t.draft.body.html))}function ct(e){var t=this,n=t.draft,r;if(!e.reply)return;t.header.setHeader(n),r=n.subject,t.neoFire("composeEvent",{action:"replyheaderLoad",subject:r})}function ht(e){var t=this,n,r=t.draft;t._setTextMode(e.isRichText),t._setClean(),n=r.cc&&r.cc.length>0||r.bcc&&r.bcc.length>0,t._allowEditing(t.draft.body.html,n),t.header.enableSwitchReplyButton(),t.get("noFocus")||t.setFocus(r.to&&r.to.length>0?"body":"to")}function pt(){var t=this;t.rtSwitch||(t.rtSwitch=t.baseNode.all("span.switchtext")),t.rtSwitch.each(function(n){t.handles.push(n.on("click",function(n){e.fire("mt:click",{action:"cmps_stchpt",append:{t1:"cmpsTb",ltxt:t._isRTEActive()?"plaintext":"richtext"}}),n.halt(!1),t.allowEdit&&t._cmdTextSwitch()}))})}function dt(){function s(){t.editor.fire("beforeModeSwitch"),t.draft.setBody(null,t.getContent()),t._setDirty()}function o(e,n){t._setTextMode(!1),t.draft.setBody(null,n),t.draft.notifyBodyChanged({textConvert:!0}),r&&r.removeClass("narrow-rightPV")}function u(){t._setTextMode(!0),n&&!n.isToolBarFit()?r&&r.addClass("narrow-rightPV"):r&&r.removeClass("narrow-rightPV")}function a(){s(),t._expandQuotedReply(),o(t.draft,t.editor.getContentAsPlainText()),t.resizeRTE(),t.setFocus("body"),t.editor.fire("afterModeSwitch")}var t=this,n=e.mail.ui.MailView&&e.mail.ui.MailView.prototype,r=e.one("#shellcontent"),i;t._isRTEActive()?t.editor.hasContent()?(i=!0,t.confirm(strings.str_rte_plaintext,strings.str_comp_conf_plainText
,a)):a():(s(),u(t.draft),t.editor.fire("afterModeSwitch")),!i&&t.setFocus("body")}function vt(){return!NeoConfig.low_bandwidth&&this._getTextMode()}function mt(){return this.spellCheckView&&this._isRTEActive()}function gt(e){return this.baseNode.one(".cm-"+e+" ul li")}function yt(){return this.editor.getContent()+this.quotedTextBody}function bt(){return this.editor.richFontInfo}function wt(){return this.editor.getRTE()}function Et(t,n,r){var i=this,s=!0,o,u=i.editor.getRTE();if(typeof t=="string"){o=i.baseNode.one(".compose-header");if(o)switch(t){case"to":case"cc":case"bcc":case"subject":o=i.baseNode.one(".compose-header"),t=o.one(".cm-"+t+"-field");break;case"body":t=u,s=r&&e.UA.os==="macintosh"&&e.UA.chrome>=11?0:i.editor.get("ready")}}s&&(t===u?i.editor.setFocus(n):t&&t.focus()),t&&i._registerFocus(t)}function St(e,t){return'<div class="'+t+'">'+e+"</div>"}function xt(t,n){var r=this,i,s,o,u,a,l=[],c,h,p="yahoo_quoted";r._clearOriginTimers(),r.header.enableHeader(!0),r.editor.showArea(),r.loadingArea.addClass(d),r._activateWellFresh();if(t)if(r.get("isQuickReply")&&r.draft.origin.action!=="forward"){r.isDraft||(u=e.UA.ie===9?"&nbsp;":e.Selection.CURSOR,t="<p>"+u+"</p>"+t),r.editor.setContent(t,!1);if(r.isDraft){i=f.getVal(r.draft.origin,"yqtdPrefix");for(s=0;s<i.length;s++)c="."+i[s]+p,o=r.getRTEDocNode().one(c),o&&(h=St(o.getContent(),c),l.push(h),o.remove());this.quotedTextBody=l.join("")}else o=r.getRTEDocNode().one("."+p);o&&r.baseNode.one(".compose-quoted-text")&&r.baseNode.one(".compose-quoted-text").removeClass("hidden"),a=r.getRTEDocNode().one("."+p),a&&(this.quotedTextBody="<br>"+St(a.getContent(),p),a.remove())}else r.editor.setContent(t,!r.isDraft);r.header.allowEditing(t,n),r.composeTictacApi.render(r.baseNode.one(".attachments-pane")),r.allowEdit=!0,r.fire("renderComplete")}function Tt(e,t){var n=null;switch(e){case"fontname":n="userUIPref.composeFontFamily",t+="|1";break;case"fontsize":n="userUIPref.composeFontSize",t=parseInt(t,10),t=g[--t];break;default:}n&&t&&Jt(n,t)}function Nt(){var t=this,n;t._formatPane||(t._formatPane=t.baseNode.one(".format-pane")),t.spellCheckBtn=t._formatPane.one('[data-action="spellcheck"]'),t.spellCheckMenuBtn=t.spellCheckBtn.next(),n=e.one("#menu-spell-langs"),t.handles.push(t.spellCheckBtn.on("click",function(e){e.preventDefault(),t._isSpellCheckActive()?t.spellCheckView.destroy():t._doSpellCheck(n?n.one(".active").get("text"):null)}),t.spellCheckMenuBtn.on("click",function(e){e.preventDefault(),t._openSpellCheckMenu(e)}),t.on("SpellCheck:destroy",function(){t.spellCheckView=null,t.spellCorrections=null,t.spellCheckBtn.removeClass("active")}))}function Ct(e){var t=this;t.closeSrc="cancelBtn",e&&(t.dirty="ForceClose"),t.canClose()&&t.neoFire("composeEvent",{action:"closeAction"})}function kt(t){var n=!0,r={},i="",s=this;switch(t){case"send":r.spid="sent",s.lastSendState&&(i=s.lastSendState),s.send();break;case"savedraft":s.blockSave=!0,s._invokeSaveDraft();break;case"cancelcompose":n=!1,s.cancelCompose();break;case"delete":s.doDiscardDraft(!1),s.dirty="ForceClose",s.neoFire("composeEvent",{action:"closeAction",forceClose:!0})}n&&(r.append={t1:"cmpsTb",cmpsType:s.get("isQuickReply")?"QR":"fullCmps"},r.action="tlbr_"+t,i&&(r.append.ltxt=i),e.fire("mt:click",r))}function Lt(e){var t=this,n,r=t.baseNode.one(".attachment-button-attach");e?n=t.draft.after("stateChanged",function(e){if(e&&e.next&&e.next!=="saved")return;n.detach(),t.neoFire("composeEvent",{action:"closeAction",forceClose:!0}),r.fire("compose:close")}):(r.fire("compose:close"),t.neoFire("composeEvent",{action:"closeAction",forceClose:!0}))}function At(){}function Ot(){var t=this;if(t._isSpellCheckActive())return;t.spellCheckView===null&&(l.enabled("spellCheck")?(t.spellCorrections=new e.mail.Model.SpellCorrections,t.spellCheckView=new r.ui.SpellCheckView(t,t.draft,t.spellCorrections),t.spellCheckBtn.addClass("active")):t.spellCheckView=!1)}function Mt(t){var n=this;e.use("mail-ui-composeview-spellcheck-v3",function(){n._activateSpellCheck(),n._isSpellCheckActive()&&(n.spellCheckView.doSpellCheck(t),n.setFocus("body"),n.neoFire("composeEvent",{action:"darlaEvent",type:"spell_chk"}))})}function _t(t){var n=this;e.use("mail-ui-composeview-spellcheck-v3",function(){n._activateSpellCheck(),n._isSpellCheckActive()&&n.spellCheckView.showLangMenu(t)})}function Dt(){return this.editor.getRTE().getInstance()}function Pt(){return this.editor.getDoc()}function Ht(e){var t=this,n,i=r.model.DataStore.Messages.getPermMidPart;if(e.flavor!==t.flavor)return!1;if(e&&e.oMsg&&t.getDraftMID())return i(t.getDraftMID())===i(e.oMsg.mid);if(!t._isOrigin())if(!e||!e.oMsg)return!0;return e&&e.oMsg?(n=t.draft.get.origin,e.action===n.action&&e.fid===n.fid&&e.oMsg.mid===n.oMsg.mid&&e.forwardAsAttachment===n.forwardAsAttachment):!1}function Bt(){var e=this,t=e.draft.origin;return t.action&&t.fid&&t.oMsg}function jt(){var e=this,t;t=e.draft.origin,e._clearOriginTimers(),e._writeLoadingHtml(t.errInfo==="ok"?"pop":"slow")}function Ft(){var e=this;e._writeLoadingHtml("start")}function It(e,t){this.editor.setContent(e,t)}function qt(e){var t=this;t.loadingArea.hasChildNodes()&&t.loadingArea.get("children").remove().destroy(!0),t.loadingArea.appendChild(n(c(m.base,null,t.loadFormatters,e,strings,h)))}function Rt(){var e=this;e.slowOriginReqTimer&&clearTimeout(e.slowOriginReqTimer),e.loadingTimer&&clearTimeout(e.loadingTimer)}function Ut(e){var t=this,n,r,i=t.baseNode.one(".save-draft-msg");n=function(){return e?strings.str_comp_saving_draft:t.lastSaveType===-1?c(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:t.lastSave}):t.lastSave?t.lastSaveType===1?c(strings.str_comp_autosave,0,0,0,{autosave_time:t.lastSave}):c(strings.str_comp_saved,0,0,0,{saved_time:t.lastSave}):""},r=n(),i.removeClass("hidden"),i.set("innerHTML",r)}function zt(t){var n=this,r,i;n.allowSend?e.use("common-ui-dialog-helper",function(){n.allowSend=!1,r={hd:t?strings.str_rte_attachments_alert_virus_title:strings.str_comp_dialogtitle_invalidSendAttachments
,bd:t?strings.str_rte_attachments_alert_virus:strings.str_comp_dialogbody_invalidSendAttachments,suppressRestoreFocus:!0},i=function(){n.allowSend=!0,n._restoreFocus()},a.ui.DialogHelper.alert(r,{ok:{handler:i},cancel:{handler:i}})}):n._restoreFocus()}function Wt(e){var t=e||this.getSaveNotification(),n;if(!t)return;n=this.baseNode&&this.baseNode.one(".bottomToolbar"),n&&n.one(".save-draft-msg").setContent(t)}function Xt(){var e=this;return e.lastSaveType===-1?c(strings.str_comp_saveasdraftfail,0,0,0,{autosave_time:e.lastSave}):e.lastSave&&e.lastSaveType===1?c(strings.str_comp_saved_fresh,0,0,0,{saved_time:e.lastSave}):""}function Vt(){var t=this,n;return n={bidi:NeoConfig.bidi,isRTL:NeoConfig.isRTL,isFullSSL:NeoConfig.isSSL,isRich:t._isRTEActive(),getDefaultFontInfo:i.getDefaultFontInfo,convertToPlain:e.bind(e.mail.Controller.TextProcessor.convertToPlain,e.mail.Controller.TextProcessor),smartscroll:NeoConfig.smartscroll&&t.get("isQuickReply")},n}function $t(){return this.draft.to.length>0||this.draft.cc.length>0||this.draft.bcc.length>0||this.draft.subject.trim()!==""||this.draft.body.html!==""||this.draft.body.text!==""}function Jt(t,n){e.common.persist.UserData.set(t,n),setTimeout(function(){e.common.persist.UserData.saveOne(t)},10)}function Kt(e){this.editor.getRTE().fire("cardify",e.cardInfo,e.type)}function Qt(e){var t=strings.str_comp_attachment_size_exceeded,n=c(t,0,0,0,{num:e});a.ui.DialogHelper.alert({hd:strings.str_comp_attachment_size_limit,bd:n,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})}function Gt(t){var n=strings.str_comp_attachment_size_zero,r=t.map(function(t){return e.Escape.html(t.name)}),i="<strong>"+r.join(", ")+"</strong>",s=c(n,0,0,0,{filenames:i});a.ui.DialogHelper.alert({hd:strings.str_comp_attachment_size_limit,bd:s,suppressRestoreFocus:!0},{ok:{handler:function(){}}})}function Yt(){a.ui.DialogHelper.alert({hd:strings.str_comp_attach_error,bd:strings.str_comp_attach_num_files_exceeded,suppressRestoreFocus:!0},{ok:{handler:function(){}},cancel:{handler:function(){}}})}var t=e.Lang.trim,n=e.Node.create,r=e.mail,i=e.mail.Controller.ReplyProcessor,s=e.mail.Views.ComposeTictacApi,o=e.mail.rte.fileUtil,u=[],a=e.common,f=a.Utils,l=e.common.Utils.features,c=f.substitute,h=e.ui.Templates,p=e.mail.Controller.HtmlProcessor,d="hidden",v="focus",m=h._shared_module_compose_loading,g=[10,13,16,0,24,32,48],y=2e3,b=7e3,w=67,E=function(t,n,i,o,u){var a=this,f;E.superclass.constructor.call(a,t,n,o,u),a.spellCheckView=null,a.spellCheckLang=null,a.wordsToIgnore=[],a.slowOriginReqTimer=null,a.keepHdrFocus=!1,a.formatShortcutTimer=null,a.mouseFocusEvent=!1,a.composeViewRendered=!1,a.rteTabIndex=0,a.type="fullCompose",a.handles=[],a.lastSendState=null,a.closeSrc="closeBtn",a.containerNode=u.containerNode,a.hasRTEFormatter=!0,a.flavor="compose",a.addAttrs({keydownHandler:{value:null},isQuickReply:{value:!1},noFocus:{value:!1}},u),u.maxHeightFn&&(a.maxHeightFn=u.maxHeightFn,a.maxHeight=a.maxHeightFn()),f=a._getEditorConfig(),f.composeView=a,a.editor=new r.RTEView(f),a.composeTictacApi=new s(a.editor),a.addChild(a.editor),a.loadFormatters={start:function(e,t){return t==="start"?c(m.start,null,null,null,strings):""},slow:function(e,t){return t==="slow"?c(m.slow,null,null,null,strings):""},error:function(e,t){return t==="err"?c(m.error,null,null,null,strings):""},populate:function(e,t){return t==="pop"?c(m.populate,null,null,null,strings):""}},NeoConfig.bidi&&e.use("comms-intl-bidihighlight"),a.neoEvent("composeEvent",{emitFacade:!0,broadcast:1}),this.neoFire("composeEvent",{action:"addChild",subview:this}),this.set("active",!0),this.sendValidationHandlers=new e.mail.Views.SendValidationErrorHandlers(this),a.quotedTextBody=""};e.extend(E,e.mail.Views.MailCompose),E.prototype._bindDraft=function(){var e=this,t=e.draft,n;e.handles||(e.handles=[]),n=e.handles,n.push(t.on("stateChanged",function(t){t.prev==="savingAndSending"||t.prev==="sending"||t.prev==="sent"||t.prev==="captchaing"&&t.next==="unsaved"?t.next==="final"?e.sendSuccess():t.err&&e.sendFailure(t.err):(t.next==="saved"||t.next==="saving"||t.next==="unsaved"&&t.err)&&e._updateSaveStatus(t.next,t.err),(t.next==="savingAndSending"||t.next==="sending")&&e.showComposeShim(!0),(t.next==="saved"||t.next==="unsaved")&&e.showComposeShim(!1)})),n.push(t.on("bodyChanged",function(t){e.contentChangeAfter(t)})),n.push(t.on("headerChanged",function(t){e.headerChangeAfter(t)})),n.push(t.on("originChanged",function(){var t=f.getVal(e.draft.origin,"errInfo","ok");t!=="ok"&&(e._clearOriginTimers(),t.code!==a.net.Error.abort&&e._writeLoadingHtml("err"))}))},E.prototype._updateSaveStatus=function(t,n){var r=this,i=e.mail.ui.MailView&&e.mail.ui.MailView.prototype,s=e.one("#shellcontent");t==="saving"?r.draft.isUploadingInlineImages()?r.updateSaveStatusText(strings.str_comp_inline_image_attach_progress):r.updateSaveStatusText(strings.str_comp_saving_draft):t==="saved"&&r.allowEdit?r.saveSuccess():t==="unsaved"&&n&&r.saveFailure(n),i&&!i.isToolBarFit()?s&&s.addClass("narrow-rightPV"):s&&s.removeClass("narrow-rightPV")},E.prototype=e.mix(E.prototype,{NAME:"FullCompose",render:U,bindUI:D,_bindWellUIFresh:j,onKeyDown:Y,onFocus:et,closeCompose:N,hasContent:$t,getContent:yt,getFontInfo:bt,getRTE:wt,getRTEInstance:Dt,getRTEDocNode:Pt,getFirstNode:gt,setFocus:Et,contentChangeAfter:lt,headerChangeAfter:ct,replyContentChangeAfter:ht,updateSaveText:Ut,postRender:K,matchOrigin:Ht,setContent:It,addCards:Kt,addAttachMenuItems:J,showAttachmentSizeDialog:Qt,showAttachmentEmptyDialog:Gt,showAttachmentCountDialog:Yt,_initOpenMailButtons:$,_addFocusListenersFresh:Q,_handleShiftTabFresh:Z,_handleSendAction:k,handleComposeAction:kt,_intlBindUIRTE:At,_allowEditing:xt,_isRTEActive:vt,_isAtEndOfRTE:G,_closeAfterWarning:Lt,_activateWellFresh:R,_renderWellsFresh:q,_bindTextSwitchFresh:pt,_cmdTextSwitch:dt,_showDropzone:O,_hideDropzone:M,_moveInputFileNode:_,_alertInvalidAttachments:zt,_initializeSpellCheck:Nt,_activateSpellCheck:Ot,_isSpellCheckActive
:mt,_doSpellCheck:Mt,_openSpellCheckMenu:_t,_isOrigin:Bt,_handleSlowOriginRequest:jt,_displayLoading:Ft,_writeLoadingHtml:qt,_clearOriginTimers:Rt,_setComposePreference:Tt,_bindAttachmentsTT:ft,_warnTooManyRecipients:A,send:L,_showSendBtn:B,_expandQuotedReply:I,showComposeView:S,hideComposeView:x,getSubjectInfo:T,initializeRTEFormatter:F,getSaveNotification:Xt,setSaveNotification:Wt,cancelCompose:Ct,resizeRTE:X,doResizeRTE:V,fixBottom:W,savePref:Jt,updateUploadForm:P,notifySendAbuse:ot,_getEditorConfig:Vt,sendSuccess:tt,saveSuccess:nt,saveFailure:rt,sendFailure:st,updateSaveStatusText:it,showComposeShim:at,showGrowthTooltip:ut,ondestroy:C},!0),e.namespace("mail.Views").Compose=E},"1.0.0",{requires:["mail-ui-mailcompose-v3","mail-ui-messagepane-utils","attachments-fresh_css","mail-ui-tray","escape","mail-ui-composeview-attach","editor-base","mail-common-utils-features","editor-para","editor-br","node","stylesheet","mail-controller-reply-processor","mail-controller-signature-processor","mail-controller-html-processor","common-persist-user-data","mail-models-draft","contacts-api-utils","contacts-api","filter-contacts","plugin","comms-bidi-textentry","comms-editor-autobidi","comms-intl-bidi","editor-bidi","_shared_module_compose_fresh_conv","_shared_module_toolbar_compose_fresh","_shared_module_compose_loading","_shared_module_offscreen_bin_compose","_shared_module_offscreen_bin_compose_menu_spellcheck","_shared_module_offscreen_bin_compose_modal_cancel_compose","_shared_module_rte_well_content_format_fresh","_shared_module_rte_well_content_format_pop_out","_shared_module_rte_well_content_emoticons_fresh","_shared_module_rte_well_content_fontnamesize_fresh","_shared_module_rte_well_content_attachments_fresh","_shared_module_rte_well_tabs_compose_fresh","_shared_module_offscreen_bin_notification_notifications","_shared_module_compose_dropzone","common-ui-toolbar-base","common-ui-menu-helper","_shared_module_offscreen_bin_compose_menu_list","_shared_module_offscreen_bin_compose_menu_text_align","_shared_module_offscreen_bin_compose_menu_indent","mail-views-send-validation-error-handlers","mail-ui-composetictacapi","rte-file-utils","mail-ui-mailview-base"]});
YUI.add("mail-core-net-policies-compose-policy",function(B){var A=function(){this.requests={};};B.mix(A.prototype,{enforce:function(E,D,C){B.Object.each(this.requests,function(F,H,G){E.cancel(H);});},add:function(E,D,C){if(!C.upload){this.requests[E]=C;}}});B.namespace("Mail.Core.Net.Policies").ComposePolicy=A;},"1.0.0",{requires:[]});YUI.add("mail-core-net-helpers-multipart-request-wrapper",function(B){var A={wrap:function(G){if(!G){return null;}var E=(new Date()).getTime(),I="------------------------------"+E,F="",H,D="\r\n";function C(J){F+=J+D;}H="multipart/form-data; boundary="+I;B.Array.each(G,function(J){C("--"+I);C('Content-Disposition: form-data; name="'+J.name+'"');C("Content-Type: "+J.contentType);C("");C(J.content);});C("--"+I+"--");return{data:F,contentType:H};}};B.namespace("Mail.Core.Net.Helpers").MultipartRequestWrapper=A;},"1.0.0",{requires:[]});YUI.add("mail-core-net-request",function(e){var t=0,n=e.mail.Error;e.namespace("Mail.Core.Net").Request={BATCH_TIMEOUT:35e3,BATCH_URL:"/ws/v3/batch?",EXPIRY_RETRY_COUNT:1,DEFAULT_TIMEOUT:1e4,HTTP_CONN_ERRS:[0,502,900,12002,12152,12007,12029,12030,12031,13030],MAX_RETRIES:2,_suspendCode:0,get:function(e,t,n){var r;return n||!this._isBatchable(e)?(t=this._initConfig(t),r=t.options,r.method="GET",this.send(e,t)):this.batchJSON({uri:e,method:"GET"})},post:function(t,n,r,i){var s;return i||!this._isBatchable(t)?(r=this._initConfig(r),s=r.options,s.method="POST",s.data=n,s.headers=s.headers||{},!s.headers["Content-Type"]&&!this._isFormData(n)&&!s.form&&(s.headers["Content-Type"]="application/json"),s.headers["Content-Type"]==="application/json"&&typeof n!="string"&&(s.data=e.JSON.stringify(n)),s.headers["Accept-Language"]=NeoConfig.lang,s.form&&(s.data=undefined),this.send(t,r)):this.batchJSON({uri:t,method:"POST",payloadType:"embedded",payload:n})},_initConfig:function(e){return e=e||{},e.options=e.options||{},e},_isBatchable:function(e){return e.indexOf("/mailsearch/v2/search")!==0},_parseUrlForSessionId:function(t){return e.common.Utils.getVal(e.common.Utils.parseJSON(t),"error.details.wssid")},_logRequest:function(t,n){e.fire("MailLog",{m:"v3 Request received",url:t,info:n||""})},_logResponse:function(t,n){e.fire("MailLog",{m:"v3 Response received",url:t,info:n||""})},logBatchRequest:function(t){var n=0,r={},i,s;for(n=0;n<t.length;n++)s=e.common.Utils.parseJSON(t[n].content),i=s.requests,this.unserializeRequests(i,r);return r},unserializeRequests:function(e,t){var n=0,r;if(!e)return;for(n=0;n<e.length;n++)e[n]&&(t[e[n].id]=e[n].uri,r=e[n].requests,this.unserializeRequests(r,t))},_parseJSONBatchResponse:function(t){var n=e.common.Utils,r,i,s,o,u,a,f,l,c,h,p;s=n.parseJSON(t.response||t.responseText),f={},c={},l=s.result.status.successRequests;for(r=0;r<l.length;r++)c[l[r].id]=l[r];o=n.getVal(s,"result.responses");if(o)for(r=0;r<o.length;r++)u=o[r],a={id:u.id,httpCode:u.httpCode?u.httpCode:void 0,headers:u.headers,response:u.response},i=c[u.id],i?(a.status=i,a.success=!0):a.success=!1,f[u.id]=a;h=s.result.status.failedRequests;for(r=0;r<h.length;r++)p=h[r],f[p.id]||(a={id:p.id,httpCode:p.httpCode?p.httpCode:void 0,response:{error:p.error},success:!1},f[p.id]=a);return f.url=t.url,f},batchJSON:function(n,r){var i=e.Array(n),s,o;return e.Array.each(i,function(){n.id=n.id||"r"+t++}),o={requests:i},r=this._initConfig(r),s=r.options,s&&s.responseType==="json"&&(o.responseType="json"),s.headers=s.headers||{},s.headers["Content-Type"]="application/json",this.executeBatch(e.JSON.stringify(o,null,4),r)},batchMultipart:function(t,n){var r=e.Lang.isArray(t)?t:[t],i,s,o;return i=e.Mail.Core.Net.Helpers.MultipartRequestWrapper.wrap(r),n=this._initConfig(n),s=n.options,s.headers=s.headers||{},s.headers["Content-Type"]=i.contentType,o=this.logBatchRequest(t),this.executeBatch(i.data,n,o)},executeBatch:function(t,n,r){var i=this,s,o,u,a;return n=this._initConfig(n),a=n.options,a.headers.Accept=a.headers.Accept||"application/json",a.method="POST",a.data=t,a.timeout=this.BATCH_TIMEOUT,o=this.send(this.BATCH_URL,n,!0),s=o.then(function(e){return u=i._parseJSONBatchResponse(e),u.errDetail=i._handleBatchItemCallError(u,n,r),u}),e.mix(s,{io:o.io}),s},send:function(t,r,i,s){var o=this,u,a,f,l,c,h=e.common.net.Session.genReqID();return o._suspendCode!==0?(f=o._suspendCode,new Promise(function(e,t){t({code:f})})):(s||(s=0),t.indexOf("?")===-1&&(t+="?"),l=new Promise(function(f,l){function p(){c&&(c.cancel(),c=void 0)}function d(t,r){var s,a,c,h;p(),o._logResponse(u),s=o._getResponseJSON(r),e.Lang.isObject(s)?(n.cleanUpOnSuceess(),c=i?r:s,c.url=u,f(c)):(h={code:s,url:u,resource:u,status:r.status?r.status:0},s==="Malformed-mail"&&(h.rawText=r.response||r.responseText,h.url=u),a=n.handleV3([h]),l({status:r.status,res:r,errDetail:a}))}function v(a,c){var h,d;p(),e.common.Utils.getVal(c,"statusText")!=="timeoutClient"&&o._logResponse(u),h=o._createErrorObjectIO(c,r,u),h.url=u;switch(h.code){case"EC-4003":o._handleSessionExpiryError(f,l,c.responseText,t,r,i,s);return;case"EC-4008":case"relogin":o._handleReloginError(f,l,t,r,i,s);return;case"conn":if(o._handleConnectionError(f,l,t,r,i,s))return;break;case"abort":return;default:}d=n.handleV3(o._createErrorV3([h],r)),l({status:c.status,res:c,errDetail:d})}function m(e,t){var n;o._isFormData(r.options.data)?(n=t.status>=200&&t.status<300?d:v,n(t.status,t)):r.options.form&&(n=t.error?v:d,n(undefined,t))}r.options.on={success:d,failure:v,complete:m},r.options.progress&&(r.options.on.progress=r.options.progress),u=t+"&appid=YahooMailNeo&wssid="+NeoConfig.wssid+"&ts="+ +(new Date)+"&ymreqid="+h,o._logRequest(u,r.logInfo),a=e.io(u,r.options),o._isFormData(r.options.data)&&(c=e.later(r.options.timeout?r.options.timeout:o.DEFAULT_TIMEOUT,o,function(){c=void 0,a.abort&&(a.abort(),o._logClientAbort("Client-Abort-Timer",u)),v(0,{status:0,statusText:"timeoutClient"})}))}),e.mix(l,{io:a,timer:c,url:u}),l)},abort:function(e){var t=this;e.io&&e.io.abort&&(e.io.abort(),e.timer&&e.timer.cancel(),t._logClientAbort("Client-Abort-Request",e.url))},_logClientAbort:function(t,n){var r=t+":"+NeoConfig.farm+":"+(n||"null")+":NewV3",i={m:r,yid:NeoConfig.loginId};e.fire("MailLog",i)},_createErrorObjectIO:function(t,n,r){var i=0,s=-1,o,u={};try{i=t&&t.status||0,s=t&&t.readyState||-1}catch(a){}try{this._isConnErr(i)||s<=3?e.common.Utils.getVal(t,"statusText")==="timeout"?u.code="timeout":e.common.Utils.getVal(t,"statusText")==="timeoutClient"?u.code="timeoutClient":e.common.Utils.getVal(t,"statusText")==="abort"?u.code="abort":u.code="conn":i===403?u.code="relogin":(o=this._getResponseJSON(t),e.Lang.isObject(o)?u=this._createErrorObject(o,i,n):(o==="Malformed-mail"&&(u.rawText=t.response||t.responseText),u.code=o)),u.status=i}catch(a){u={code:"unknown"}}return n.suppressNotification&&(u.suppressNotification=!0),n.suppressStat&&(u.suppressStat=!0),n.logInfo&&(u.logInfo=n.logInfo),u.url=r,u.resource||(u.resource=
r),u},_createErrorV3:function(e,t){var n,r;for(n=0;n<e.length;n++)r=e[n].jsonResult,e[n].jsonResult=void 0,t.errHandler&&(e[n]=t.errHandler(e[n],r));return e},_createErrorObject:function(e,t,n){var r={};return e?!e.error||!e.error.code?r.code="MalformedFault":e.error&&(r=e.error,r.jsonResult=e):r.code="EmptyResponse-mail",r.status=t,n.suppressNotification&&(r.suppressNotification=!0),n.suppressStat&&(r.suppressStat=!0),n.logInfo&&(r.logInfo=n.logInfo),r},_getResponseJSON:function(t){var n,r;return!t||!e.Lang.isValue(t.response)&&!e.Lang.isValue(t.responseText)?"NoResponse-mail":(n=t.response||t.responseText,n?(r=this._validateJSON(n),r?r:"Malformed-mail"):"EmptyResponse-mail")},_validateJSON:function(t){var n=e.common.Utils.parseJSON(t);return n||(n=this._sanitizeJSON(t)),n},_sanitizeJSON:function(e){var t=/^\s*<!doctype\s*[^>]*?>\s*/i,n=/\n/g,r=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;if(e.match(t))return this._retryParse(e,t);if(e.match(r))return this._retryParse(e,r);if(e.match(n))return this._retryParse(e,n)},_retryParse:function(e,t){return e=e.replace(t,""),this._validateJSON(e)},_isConnErr:function(e){for(var t=0;t<this.HTTP_CONN_ERRS.length;t++)if(e===this.HTTP_CONN_ERRS[t])return!0;return!1},_handleBatchItemCallError:function(t,r,i){var s,o,u,a,f=[];r.errHandlerBatch&&(t=r.errHandlerBatch(t));for(s in t)o=t[s],e.Lang.isObject(o)&&o.success===!1&&(a=this._createErrorObject(o.response,o.httpCode,r),i&&(a.resource=a.resource?a.resource:i[s]),f.push(a));return f.length!==0&&(f.url=t.url,u=n.handleV3(this._createErrorV3(f,r))),u},_handleSessionExpiryError:function(t,n,r,i,s,o,u){var a=this,f,l;if(e.common.net.Error.isReloginActive()||a._suspendCode!==0||u>=a.EXPIRY_RETRY_COUNT){n({code:402,res:null});return}l=a._parseUrlForSessionId(r);if(l)try{f=e.common.UserSession.getState(),f.newuser?e.common.net.Error.reloadUserChange():(e.common.net.Error.setWssid(l),u++,this.send(i,s,o,u).then(t,n))}catch(c){}else n({code:402,res:null})},_handleReloginError:function(t,n,r,i,s,o){var u=this;e.once("net:reloginSuccessful",function(){u.send(r,i,s,o).then(t,n)}),e.common.net.Error.simpleRelogin()},_handleConnectionError:function(e,t,n,r,i,s){var o=this;return s<this.MAX_RETRIES?(o.send(n,r,i,++s).then(e,t),!0):!1},_isFormData:function(e){return window.FormData&&e instanceof window.FormData},suspend:function(e){this._suspendCode=e},resume:function(){this._suspendCode=0},_bindEvents:function(){var t=this;e.on("net:reloginAttempted",e.bind(t._reloginAttemptHandler,t)),e.on("net:reloginSuccessful",e.bind(t._reloginSuccessHandler,t))},_reloginAttemptHandler:function(){this.suspend(401)},_reloginSuccessHandler:function(){this.resume()}},e.Mail.Core.Net.Request._bindEvents()},"1.0.0",{requires:["io","json","common-utils","common-net-error","common-net-session","common-user-session","mail-error-v3","mail-core-net-helpers-multipart-request-wrapper"]});
YUI.add("mail-core-net-transport",function(E){var B=E.Mail.Core.Net.Request,D=E.common.Utils.verify,A={POST:1,BATCHJSON:2,BATCHMULTIPART:3,GET:4};var C=function(F){this.policy=F;this.requestMap={};};E.mix(C.prototype,{request:function(G,H,F){return this._request(A.POST,G,H,F);},requestGet:function(G,F){return this._request(A.GET,G,null,F);},requestBatchJSON:function(F,G){return this._request(A.BATCHJSON,B.BATCH_URL,F,G);},requestBatchMultipart:function(G,F){return this._request(A.BATCHMULTIPART,B.BATCH_URL,G,F);},_request:function(F,I,J,H){var G,K;this.policy.enforce(this,I,H);switch(F){case A.POST:K=B.post(I,J,H,true);break;case A.BATCHJSON:K=B.batchJSON(J,H);break;case A.BATCHMULTIPART:K=B.batchMultipart(J,H);break;case A.GET:K=B.get(I,H,true);break;default:D(false,"Bad Request Type requested in transport layer");break;}G=this._wrapPromise(K);this.policy.add(G.id,I,H);return G;},cancel:function(G){var F=this.requestMap[G];if(F){this.requestMap[G]=null;B.abort(F);}},_wrapPromise:function(I){var K=this,J=E.common.Utils.guid(),F;K.requestMap[J]=I;F=K.requestMap[J].then(function H(){if(K.requestMap[J]){K.requestMap[J]=null;}return I;},function G(){if(K.requestMap[J]){K.requestMap[J]=null;}return I;});F.io=I.io;F.id=J;return F;}});E.namespace("Mail.Core.Net").Transport=C;},"1.0.0",{requires:["mail-core-net-request","common-utils"]});YUI.add("mail-models-serializers-draft-formdata-serializer",function(B){var A=function(C){this.draft=C;};B.mix(A.prototype,{data:function(){var C=new FormData(),D=1;C.append("jsonString",this.draft.jsonify());D++;B.Array.each(this.draft.attachments,function(E){if(E.state()==="pending"){if(E.size()===0){E.setState("failed");return;}var F="att"+D;C.append(F,E.file(),E.getFilename());E.setState("uploading");D++;}});return C;}});B.namespace("Mail.Models.Serializers").DraftFormData=A;},"1.0.0",{requires:[]});YUI.add("mail-models-serializers-draft-payloadpart-serializer",function(B){var A=function(C){this.draft=C;};B.mix(A.prototype,{format:function(){var C={partName:"jsonString",contentType:"application/json",payload:this.draft.jsonifyObj()};return[C];}});B.namespace("Mail.Models.Serializers").DraftPayloadPartSerializer=A;},"1.0.0",{requires:["mail-models-draft"]});YUI.add("mail-core-net-helpers-batch-request-helper",function(B){var A={wrapCall:function(D,I,E,F,H,C){var G={id:I,uri:D,method:H||"POST"};if(G.method=="POST"||G.method=="PUT"){G.payloadType=E?"embedded":"multipart";if(E){G.payload=F;}else{G.payloadParts=F;}}if(C){G.suppressResponse=C;}return G;},attachChildCall:function(E,C,D){if(D){C.filters=D;}C.requests=C.requests||[];C.requests.push(E);}};B.namespace("Mail.Core.Net.Helpers").BatchRequestHelper=A;},"1.0.0",{requires:[]});YUI.add("mail-core-net-helpers-cascade-request-helper",function(D){var C=D.common.Utils.verify,B="/ws/mail/v2.0/jsonrpc";var A={getV2Endpoint:function(E){C(E,"method not supplied to getV2Endpoint");return(B+"?m="+E);},getV2EndpointBatch:function(){return B;},formatV2Payload:function(F,E){C(F&&E,"method and params not supplied to formatV2Payload");return({method:F,params:E});},formatV2GdmParams:function(G,E,F){F=F||"all";C(G&&E,"fid and mid not supplied to formatV2GdmParams");return{fid:G,enableRetry:true,textToHtml:true,urlDetection:true,emailDetection:true,qtAnnotate:{enable:true},emailComposeUrl:"mailto:%e%",truncateAt:100000,charsetHint:"",annotateOption:{annotateText:"inline"},message:this.formatV2GdmMsgParams(E,F)};},formatV2GetCidsParams:function(F,E){return[{fid:F,mids:[E]}];},formatV2GdmMsgParams:function(E,F){return([{blockImages:F,restrictCSS:true,expandCIDReferences:true,enableWarnings:true,mid:E}]);}};D.namespace("Mail.Core.Net.Helpers").CascadeRequestHelper=A;},"1.0.0",{requires:["common-utils"]});YUI.add("mail-controller-conv-adapter",function(F){var D=F.mail.model.ConvStore.Conversations,C=F.mail.model.DataStore.Messages,E=F.common.Utils.getVal,A={_serializeSendMessageInfo:function(I,H,G){return{mid:H.mid,cid:I,fid:"Sent",snippet:H?H.snippet:B(H),sourceFolderInfo:{fid:"Sent"},receivedDate:E(H,"header.sentDate")||Math.floor((new Date().getTime())/1000),flags:E(H,"flags")||{"isRead":1},from:H.from,toEmail:E(H,"header.to")||G.to,subject:E(H,"header.subject")||G.subject};},_serializeSaveMessageInfo:function(G,H){return{mid:H.mid,header:{from:G.from,to:G.to,cc:G.cc,bcc:G.bcc,subject:G.subject,replyto:G.replyto,receivedDate:Math.floor((new Date().getTime())/1000)},cid:E(G,"origin.oMsg.cid"),fid:"Draft",flags:{"isRead":1},snippet:H.snippet||B(H),sourceFolderInfo:{fid:"Draft"},inReplyTo:E(G.origin,"parentMsg")?E(G.origin,"parentMsg.mimeMsgId"):E(G.origin,"oMsg.mimeMsgId")};},_send:function(L){var H={draft:L.draft,draftMid:L.draftMid},I=L.draft,K=L.draftMid,J=E(I,"origin.oMsg.cid"),M=L.msgResponse,O=L.midToCidResponse&&L.midToCidResponse[0]&&L.midToCidResponse[0].cid,G;try{K&&C.remove("Draft",K,true,null,{reason:"sent"});if(O&&(D.getPermCidPart(O)===D.getPermCidPart(J))){G=this._serializeSendMessageInfo(O,M,I);F.mail.Controller.Messages._preset({fid:"Sent",msgObj:M});D.msgAdd(J,null,G,H,true);}else{if(M){M.mid=M.mid||M.id;C.set("Sent",M,"add",false,function(P){if(P.sourceFolderInfo){P.sourceFolderInfo.name=P.sourceFolderInfo.fid="Sent";}F.mail.Controller.Messages._process(P,{fid:"Sent"});return P;});}}}catch(N){}},_save:function(L){var J={draft:L.draft,draftMid:L.draftMid},H=L.draft,M=E(H,"origin.oMsg.cid"),K=L.msgResponse,G=L.draftMid,I;if(M){I=this._serializeSaveMessageInfo(H,K);D.msgAdd(M,null,I,J);}else{if(K){I={mid:K.mid||K.id,flags:{}};C.set("Draft",I,"add");}}G&&C.remove("Draft",G,true,null,{reason:"savedraft"});},store:function(G){if(G.method==="send"){this._send(G);}else{if(G.method==="save"){this._save(G);}}}};function B(H){var G=40,I=F.Lang.trim(H.part[0].text);I=I.substring(0,G);return I.replace(/\n/g," ");}F.namespace("mail.Controller").convAdapter=A;},"1.0.0",{requires:["mail-model-convstore","mail-model-datastore","mail-controller-messages","common-utils"]});YUI.add("mail-models-attachment-preprocessor",function(D){function A(G,E){var F=0;for(F=0;F<G.length;F++){if(G[F].partId===E.partId){return G[F];}}return undefined;}function C(G,H){var E,F=H.match(/\<(.+)\>/);if(F){E=F[1];}if(!G[H]&&G[E]){G[H]=G[E];delete G[E];return true;}return false;}var B=function(){};D.mix(B.prototype,{preProcess:function(G){var R=G.normalizedResponse.attachments,H=G.normalizedResponse.parts,N=G.normalizedResponse.mid,I,J,Q,S,M,K=[],L=G.uploads||{},F=G.draft,P=F.attachments,E=F.attachments.map(function(T){return T.contentId();}),O=D.Array.hash(E,P);for(I=0;I<R.length;I++){S=R[I];Q=S.contentId;K.push(Q);C(L,Q);if(G.saveSuccess){if(C(O,Q)){O[Q].setContentId(Q);}if(!O[Q]){M=new D.mail.Models.Attachment(N,S);M.setData(A(H,S));M.setState("saved");M.setSavedInfo(S);F.addAttachment(M);}else{if(O[Q].partId()!==S.partId){O[Q].setData(A(H,S));O[Q].setMid(G.normalizedResponse.mid);}}if(F.draftToDelete&&O[Q].mid()===F.draftToDelete){O[Q].setMid(G.normalizedResponse.mid);}}}if(G.saveSuccess){for(J in O){if(K.indexOf(J)<0&&O[J].state()==="saved"){F.removeAttachment(J);}}}return R;}});D.namespace("Mail.Models.Serializers").AttachmentRespPreprocessor=B;},"1.0.0",{requires:["mail-model-attachment"]});YUI.add("mail-models-serializers-draft-messageV3-unserializer",function(e){var t=function(){};e.mix(t.prototype,{update:function(t,n){var r,i,s;s=e.common.Utils.getVal(n,"result.message"),s&&(r=e.common.Utils.getVal(s,"spame",null),t.setSpame(r?r:"U"),i=e.common.Utils.getVal(s,"csid",null),i&&(t.csid=i))}}),e.namespace("Mail.Models.Serializers").DraftMessageV3Unserializer=t},"1.0.0",{requires:["common-utils"]});
YUI.add("mail-controller-messages-ops",function(e){function w(e,t,n){var r,o,u=t.parms,a=t.reason,f=t.api,l=e.error,p,d,v;if(NeoConfig.scanMoveAction&&t.method==="MoveMessages")for(o=0;o<u.mid.length;o++)p=!1,u.mid[o]&&(v=typeof u.mid[o],v==="string"?p=D(u.mid[o]):v==="object"&&u.mid[o].hashKey?p=u.mid[o].hashKey:v==="object"&&u.mid[o].mid&&(p=D(u.mid[o].mid))),p&&b[p]&&delete b[p];if(l)for(o=0;o<l.length;o++)if(l[o].code!=="WARN")return n("failure"),c._error(e,h.invalidmid);if(t&&t.origParms&&(t.origParms.sourceFid&&t.origParms.sourceFid==="%40S%40Search"||t.origParms.fromSearch)||e&&e.fromSearch)d=d||{},d.fromSearch=!0;t&&t.origParms&&t.origParms.fromConv&&(d=d||{},d.fromConv=!0),(a==="remove"||a==="move")&&u.mid&&u.mid.length>200&&s.remove(u.sourceFid||u.fid,e.mid,!u.destinationFid,u.destinationFid,d),f==="move"&&!e.fromSearch&&u.mid&&u.mid.length&&s.move(u.sourceFid,u.destinationFid,u.mid,e.mid,a,d),r=e.sourceFolder,r&&t.custom.isSparse&&i.Folders.set(r,"ds:msg:",1),r=e.destinationFolder,r&&i.Folders.set(r,"ds:msg:",1)}function E(e,t){var n,r=e.destinationFid&&e.destinationFid===v,i,o=t.origParms,u=o.destinationFid,a=o.sourceFid,f=t.origParms.mid,l;if(r){i={},u===v&&(i[g.spam]=1,i[g.ham]=0),a===v&&u!==d&&(i[g.ham]=1,i[g.spam]=0),s.update(e.sourceFid||e.fid,f,{flags:i},"flag");if(y)for(n=0;n<f.length;n++)f[n].flags.isRead=1}if(t&&t.origParms&&(t.origParms.sourceFid&&t.origParms.sourceFid==="%40S%40Search"||t.origParms.fromSearch)||e&&e.fromSearch)l=l||{},l.fromSearch=!0;t&&t.origParms&&t.origParms.fromConv&&(l=l||{},l.fromConv=!0),f.length<=200&&s.remove(e.sourceFid||e.fid,f,!e.destinationFid,e.destinationFid,l)}function S(e,t,n){var r=t.origParms,i,s=e.returnCodes;if(s&&s.length){for(i=0;i<s.length;i++)if(s[i].code!=="WARN")return n("failure"),c._error(e,h.invalidmid)}else r.mid?t.custom.isSparse&&x(r.setFlags,"read")&&!t.noRefresh&&!NeoConfig.hasConvView&&a.refresh():a.refresh()}function x(e,t){return e&&t in e}function T(e,t){var n,r,i=e.setFlags;if(t.origParms.chain)return;r={};for(n in i)r[g[n]]=i[n];r[g.spam]?r[g.ham]=0:r[g.ham]&&(r[g.spam]=0),f.isUndefined(i.spam)&&t.reason!=="move"&&s.update(e.fid,t.origParms.mid||[],{flags:r},t.reason)}function N(e,t){var n,r={},i,o,u=[],a={},l=t.parms,c=t.origParms.mid||[],h=e&&e.data&&e.data.returnCodes||[],p=l.setFlags;for(n in p)n==="read"&&(a[g[n]]=p[n]?0:1);if(!f.isUndefined(p.read)){for(i=0;i<c.length;i++)r[c[i].mid]=c[i];for(i=0;i<h.length;i++)o=r[h[i].mid],o&&u.push(o);s.update(l.fid,u,{flags:a},t.reason)}}function C(e,t){var n,r=0,i=t.origParms.mid;while(i[r])n=i[r++],n.header||(t.custom.isSparse=1)}function k(e,t){return t("failure"),c._error({},h.invalidparams)}function L(e,t){var n=0,r=e.mid;if(t)return e.mid=f.isArray(r)?r[0].mid:r.mid,1;f.isArray(r)||(r=r?[r]:[]),e.mid=[];for(;n<r.length;n++)e.mid[n]=r[n].mid||r[n];return n||e.selection}function A(t,r,i){var s=f.isArray(t.mid)?t.mid:new Array(t.mid),a,l,c,h={},p,v,m,g,y,b=[],w=10,E=t.sourceFid,S=E||t.fid;if(S==="%40S%40Search"){t.enableRetry=!0;if(!s[0])return;for(l=0,a=s.length;l<a;l++){p=s[l].fid||S;if(S==="%40S%40Search"||r.api!=="move"||p!=="Draft"&&p!=="Sent"||t.destinationFid===d)h[p]||(h[p]=[]),h[p].push(s[l])}if((m=o.size(h))===1&&p==="%40S%40Search")return;if(r.api==="remove"&&S==="%40S%40Search"){t.sourceFid=t.sourceFid||t.fid,delete t.fid,t.destinationFid=d,r.newApi("move","MoveMessages",t),i("pre","move"),i(1,t);return}delete t.mids;for(l in h)y=e.clone(t),E?y.sourceFid=l:y.fid=l,y.mid=h[l],t.sourceFid==="%40S%40Search"&&(y.fromSearch=!0),b[b.length]=y;o.assert(m===b.length);if(!(m>1))return b[0];var x=i(function(){r.cbk.abort()});g=Math.ceil(m/w);for(c=0;c<g;c++){v=u.batch().Messages;for(l=c*w;l<m&&l<c*w+w;l++)l===m-1?v[r.api](b[l],{success:function(e){x(e,"success",n.usercbk)},failure:function(e){x(e,"failure",n.usercbk)}}):v[r.api](b[l]);v.execute()}}}function O(e,t){var n=e.mid,r=e.fid;r==="%40S%40Search"&&(e.enableRetry=!0,n.fid&&n.fid!==r&&(e.fid=n.fid),L(e,t.api==="fullHeader"))}function M(t,n,r){var i,u,a,l,c,h,p,d=0,m,b,w=t.mid,E=t.setFlags,S,x=t.mid=[],T,N,C,A,O;if(o.isEmpty(E))return k(n,r);f.isArray(w)||(w=w?[w]:[]);if(E.spam&&t.fid!==v||E.ham&&t.fid===v||E.sendercompromised&&t.fid!==v||E.phished&&t.fid!==v||E.notmymail)a=1;while(w[d]){i=w[d++];if(!o.isEmpty(i.flags)){i=s.get(t.fid,i.mid)||i;for(u in E){if(i.flags[g[u]]!==E[u]||a){x.push(i);break}if(u==="read"){T=e.all('.thread-item[data-mid="'+s.getPermMidPart(i.mid)+'"]'),N=T.size();for(C=0;C<N;C++){O=i.flags[g.read]?0:1,A=T.item(C).hasClass("unread")?1:0;if(O!==A){x.push(i),o.log({m:"DS does not reflect UI for msg",mid:i.mid},!1,"InterruptBypassed");break}}}}}else x.push(i),n.custom.isSparse=1}if(w.length&&!x.length){r("success");return}if(!L(t))return k(n,r);!t.spam&&((p=E.notmymail)||(l=E.spam)||(c=E.sendercompromised)||(h=E.phished)||E.ham)&&(m=n.getBatch(),S=l||c||h||p?v:t.destinationFid||"Inbox",t.isImapIn&&(S=t.destinationFid,delete t.isImapIn),delete t.destinationFid,b={sourceFid:t.fid,destinationFid:S,mid:w||n.origParms.mid,spam:1,enableRetry:t.enableRetry||!1},t.fromConv&&(b.fromConv=t.fromConv),n.noRefresh=1,(c||h)&&!p&&y&&(E.read=1),r(1,t),m.Messages.move(b),m.execute(n.cbk)),delete t.spam}function _(e,t,n){var r,i,s=e.destinationFid,o=e.sourceFid,u,a;e.mid=e.mid?e.mid:[],u={fid:o,mid:f.isArray(e.mid)?e.mid:[e.mid],spam:1,enableRetry:e.enableRetry||!1},a=function(){var t,r=e.mid.length;if(r>100)return;for(var i=0;i<r;i++)t=e.mid[i]&&e.mid[i].mid&&D(e.mid[i].mid),t&&b[t]?n("failure"):b[t]=!0};if(s===o){n("success");return}e.spam||(s===v&&(i=u.setFlags={spam:1},y&&(i.read=1)),o===v&&s!==d&&(i=u.setFlags={ham:1})),!i&&NeoConfig.scanMoveAction&&a(),i&&(t.newApi("flag","FlagMessages",u),r=t.getBatch(),t.noRefresh=1,n("pre","flag"),n(1,u),e.spam=1,e.bidiDetection=NeoConfig.bidi,r.Messages.move(e),r.execute(t.cbk)),delete e.spam;if(!L(e))return k(t,n)}function D(e){var t=e.split("_");return t[t.length-1]}function P(e,t,n){if(e.fid!==d&&e.fid!==m&&e.fid!==v&&e.fid!==p&&!e.force)return e.sourceFid=e.
fid,delete e.fid,e.destinationFid=d,e.isImapIn&&(e.destinationFid=e.destFid,delete e.isImapIn),t.api=t.reason="move",t.method=l.passthru.move,n("pre","move"),e;delete e.force;if(!L(e))return k(t,n)}function H(t,n){NeoConfig.scanMoveAction&&n.method==="MoveMessages"&&t.fault==="aborted"&&(b=[]);if(t&&t.reason===h.invalidparams)return;n.parms.sourceFid&&s.flush(0,1),e.later(500,a,a.refresh)}function B(e,t){if(e&&e.reason===h.invalidparams)return;var n=t.parms;"read"in n.setFlags?a.refresh():s.flush(n.fid)}var t,n,r=e.mail,i=r.model.DataStore,s=i.Messages,o=e.common.Utils,u=r.Controller,a=u.Folders,f=e.Lang,l={passthru:{move:"MoveMessages",flag:"FlagMessages",remove:"DeleteMessages",fullHeader:"GetMessageRawHeader",redirectMsg:"RedirectMessage",addFilter:"AddFilters"},isdup:{FlagMessages:function(e,t){var n=e.setFlags,r=t.setFlags;if(e.mid&&t.mid&&e.mid.length===1&&t.mid.length===1&&e.mid[0]===t.mid[0]&&n.read===r.read&&n.flagged===r.flagged)return!0}}},c,h,p="%40C%40Chats",d="Trash",v="%40B%40Bulk",m="Draft",g={replied:"isReplied",flagged:"isFlagged",read:"isRead",draft:"isDraft",forwarded:"isForwarded",ham:"isHam",spam:"isSpam",notmymail:"notmymail"},y=strings.str_cfg_tog_set_spam_read_flag,b={};l.batchable=l.passthru,c=u.extend("Messages",l),h=c.Error,n=l.order,e.mix(c,{fixFlagHook:M}),t={success:w,failure:H},c.hook({move:t,remove:t,flag:{success:S,failure:B}}),t={pre:E},c.hook({move:t,remove:t},0,n.optimistic),c.hook({move:{pre:A},remove:{pre:A},flag:{pre:A},fullHeader:{pre:O},redirectMsg:{pre:A}},0,n.fixParms),c.hook({move:{pre:_,aborted:H},remove:{pre:P,aborted:H},flag:{pre:M,aborted:B},redirectMsg:{pre:function(e){L(e)}}},0,n.fixParms),c.hook({move:{pre:C},flag:{pre:T,failure:N}},0,n.optimistic),e.mix(h,{invalidmid:h._reservedIdx+1,invalidparams:h._reservedIdx+1,noitems:h._reservedIdx+2})},"3.0.0",{requires:["mail-controller-base","mail-model-datastore","json-stringify"]});
YUI.add("mail-services-compose",function(e){function f(n){t(n,"no V3 mailbox id supplied to compose service"),this.transport=new e.Mail.Core.Net.Transport(new e.Mail.Core.Net.Policies.ComposePolicy),this.v3url="/ws/v3/mailboxes/@.id=="+n+"/messages",this.gdmUnserializer=new e.Mail.Models.Serializers.DraftGdmUnserializer,this.attachmentRespPreprocessor=new e.Mail.Models.Serializers.AttachmentRespPreprocessor,this.msgUnserializer=new e.Mail.Models.Serializers.DraftMessageV3Unserializer}function l(t){var n=t.attachments.filter(function(e){return e.state()==="pending"&&e.size()!==0}),r=n.map(function(e){return e.contentId()});return e.Array.hash(r,n)}function c(t,n){t&&e.Object.each(t,function(e){e.transactionId=n.id})}function h(t,n){var r=n.loaded;t&&e.Object.each(t,function(e){e.progress=0;if(r>0){var t=r>e.file().size?1:r/e.file().size;r-=e.file().size,e.setProgress(t)}})}function p(e,t){e&&e.attachmentInfo&&t.loaded&&(e.attachmentInfo.bytesSent=Math.min(e.attachmentInfo.size,t.loaded))}function d(e,t){var n=!1;e.attachments.forEach(function(e){e.state()==="deleted"&&(n=!0,t.cancel(e.transactionId))}),n&&e.setState("unsaved")}function v(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&(n+=e[t].size());return n}function m(e){var t=Math.max(e*s,i);return t}function g(t,n,r){var i={contentInfo:t.getLogInfo()},s=n?e.Object.size(n):0;return s>0&&(i.attachmentInfo={count:s,size:r,bytesSent:0}),i}function y(t,n,r){var i,s,o,u;if(!r||e.Lang.isArray(r)&&r.length===0)e.Object.each(n,function(e){u=!0,e.setState("failed")});else for(s=0;s<r.length;s++){i=r[s],o=n[i.contentId];if(!o)continue;i.virus==="Y"?(o.setState("infected"),u=!0):o.setState("pending")}u&&t.setState("unsaved")}function b(e,t){t.forEach(function(t){var n=e.attachments.indexOf(t);n!==-1&&(e.attachments.splice(n,1),t.deleted())})}function w(t){if(t.draftToDelete){var n=function(){},r={success:n,failure:n,suppressNotification:!0};e.mail.Controller.Messages.remove({fid:"Draft",mid:t.draftToDelete,force:!0},r),t.draftToDelete=void 0}}function E(e){var t=e.SaveMessage,r=e.SendMessage,i,s;return t&&r&&t.success&&!r.success&&(i=n(t,"response.result.message.captcha"),s=n(r,"response.error"),i&&s&&(s.code="batchCaptcha")),e}function S(e,t){if(e.code)switch(e.code){case"ET-5012":x(t)&&(e.code="virusDetected");break;default:}return e}function x(e){var t,n,r;if(!e||!e.result||!e.result.simpleBody||!e.result.simpleBody.attachments)return!1;t=e.result.simpleBody.attachments;for(r=0;r<t.length;r++){n=t[r].virus;if(n&&n==="Y")return!0}return!1}var t=e.common.Utils.verify,n=e.common.Utils.getVal,r=e.mail.Controller.convAdapter,i=35e3,s=10,o="SendMessage",u="SaveMessage",a="GetDisplayMessage";e.mix(f.prototype,{save:function(t,i,s){var o=this,u,a,f=t.draftToDelete?t.draftToDelete:t.mid,h=l(t),p=e.Object.size(h)>0,v=!0,m=t.attachments.filter(function(e){return e.state()==="deleted"});return d(t,this.transport),t.generateCsid(),!p&&v?u=this.jsonSave(t,s):window.FormData&&window.FileReader?u=this.formDataSave(t,h,s):u=this.iframeSave(t,h,s),c(h,u),u.then(function(n){return o.attachmentRespPreprocessor.preProcess({uploads:h,normalizedResponse:o._normalizeResponseObject(n),draft:t,saveSuccess:!0}),w(t),o.gdmUnserializer.update(t,h,n),o.msgUnserializer.update(t,n),o._updateDraftCaptcha(t,n),b(t,m),s.suppressDS||(a={method:"save",draft:t,draftMid:f,msgResponse:n.result.messageV2},r.store(a)),n},function(r){var i=o.attachmentRespPreprocessor.preProcess({uploads:h,normalizedResponse:o._normalizeResponseObject(n(r,"res.response")),draft:t,saveSuccess:!1});return y(t,h,i),r}),u},jsonSave:function(e,t){var n=this,r=e.jsonify(),s={options:{timeout:i},upload:!1,errHandler:S,suppressNotification:t&&t.suppressNotification,suppressStat:t&&t.suppressStat,logInfo:g(e)},o;return o=n.transport.request(n.v3url,r,s),o},formDataSave:function(t,n,r){var i=this,s=e.Object.size(n)>0,o=v(n),u=new e.Mail.Models.Serializers.DraftFormData(t),a=u.data(),f=g(t,n,o),l={options:{progress:function(e,t){h(n,t),p(f,t)},timeout:m(o)},upload:s,errHandler:S,suppressNotification:r&&r.suppressNotification,suppressStat:r&&r.suppressStat,logInfo:f},c;return c=i.transport.request(i.v3url,a,l),c},iframeSave:function(t,n,r){var i=this,s=v(n);return e.Object.each(n,function(e){e.setState("uploading")}),new Promise(function(o,u){e.use("io-upload-iframe",function(){var e=t.formId,a={},f={options:{form:{id:e,upload:!0},timeout:m(s)},errHandler:S,suppressNotification:r&&r.suppressNotification,suppressStat:r&&r.suppressStat,logInfo:g(t,n,s)};i.transport.request(i.v3url,a,f).then(o,u)})})},sendBatch:function(e,t){var n=this,r,s,f,l={},c=e.mid;return r=this._createSendBatch(e,t),s={options:{timeout:i},errHandlerBatch:E},t&&(s.logInfo=g(e)),f=this.transport.requestBatchMultipart([r],s).then(function(i){return l.errDetail=i.errDetail,n._wasMessageSent(i,t)&&e.setState("sent"),t&&n._processBatchAPIResponse(i,u,"save",l,function(t){n._handleSaveResponse(e,t.save)||(l.failure="save")}),n._processBatchAPIResponse(i,o,"send",l,function(){n._handleSendResponse(e)}),e.isInConv()?n._processBatchAPIResponse(i,a,"sendGDM",l,function(t){n._updateConvStore(e,t.sendGDM,c)||(l.failure="sendGDM")}):n._updateMsgStore(e,c,l.save),l.failure?Promise.reject(l):l},function(t){return l.failure="batch",l.batch=t,l.errDetail=t.errDetail,Promise.reject(l)}),f},_processBatchAPIResponse:function(e,t,n,r,i){var s=e[t],o=s&&s.response;if(r.failure)return;r[n]=o,s.success?i&&i(r):r.failure=n},_createSendBatch:function(t,n){var r=e.Mail.Core.Net.Helpers.BatchRequestHelper,i=e.Mail.Core.Net.Helpers.CascadeRequestHelper,s=new e.Mail.Models.Serializers.DraftPayloadPartSerializer(t),f={select:{mid:"$..message.immutableid"}},l={select:{mid:"$..message.id"}},c,h,p,d,v,m,g;return h=n?"$(mid)":encodeURIComponent(this._transformMidToRFC4648(t.mid)),c=this.v3url+"/@.id=="+h+"/send",t.generateCsid(),p={csid:t.csid},!n&&t.captchaAnswer&&(p.captcha=t.captchaAnswer),g=v=r.wrapCall(c,o,!0,p),n&&(g=d=r.wrapCall(this.v3url,u,!1,s.format()),r.attachChildCall(
v,d,f)),t.isInConv()&&(m=r.wrapCall(i.getV2EndpointBatch(),a,!0,i.formatV2Payload(a,i.formatV2GdmParams("Sent","$(mid)","none"))),r.attachChildCall(m,v,l)),{name:"batchJson",contentType:"application/json",content:e.JSON.stringify({responseType:"json",requests:[g]})}},_handleSaveResponse:function(e,t){return w(e),this.gdmUnserializer.update(e,null,t),this.msgUnserializer.update(e,t),!this._updateDraftCaptcha(e,t)&&!e.isSpame()},_handleSendResponse:function(t){var n;try{n=t.makeInReplyTo(),n&&(n.forwarded||n.replied)&&e.mail.Controller.Messages.flag({fid:t.origin.fid,mid:[t.origin.action==="edit"?n.messageReference.id:t.origin.oMsg],setFlags:n.forwarded?{forwarded:1}:{replied:1}},{suppressCodes:["*"]})}catch(r){}},_updateConvStore:function(e,t,n){try{r.store({method:"send",draft:e,draftMid:n,msgResponse:t.result.message[0],midToCidResponse:[{cid:e.cid}]})}catch(i){return!1}return!0},_updateMsgStore:function(e,t,i){try{r.store({method:"send",draft:e,draftMid:t,msgResponse:n(i,"result.messageV2")})}catch(s){return!1}return!0},_updateDraftCaptcha:function(e,t){return e.captchaAnswer=null,t.result.message&&t.result.message.captcha?(e.captcha=t.result.message.captcha,!0):(e.captcha=null,!1)},_wasMessageSent:function(e,t){if(!e[o].success)return!1;if(t)if(!e[u].success||n(e[u],"response.result.message.captcha")||n(e[u],"response.result.message.spame","U")==="N")return!1;return!0},_transformMidToRFC4648:function(e){var t=e;return t=t.replace("+","-"),t=t.replace("/","_"),t},_normalizeResponseObject:function(t){var r,i,s,o;if(typeof t=="string")try{r=e.JSON.parse(t)}catch(u){r={}}else r=t;return i=n(r,"result.simpleBody.attachments")||[],s=n(r,"result.messageV2.part")||[],o=n(r,"result.messageV2.mid")||"",{response:r,parts:s,attachments:i,mid:o}}}),e.namespace("Mail.Services").Compose=f},"1.0.0",{requires:["common-utils","json","json-parse","mail-core-net-policies-compose-policy","mail-core-net-transport","mail-models-serializers-draft-formdata-serializer","mail-models-serializers-draft-payloadpart-serializer","mail-core-net-helpers-batch-request-helper","mail-core-net-helpers-cascade-request-helper","mail-controller-conv-adapter","mail-models-serializers-draft-gdm-unserializer","mail-models-attachment-preprocessor","mail-models-serializers-draft-messageV3-unserializer","mail-controller-messages-ops"]});
YUI.add("mail-compose-syncer",function(e){function i(e,t){n(e.folder.id.length>0,"Syncer requires draft.folder.id"),this.draft=e,this.service=t,this.dirty=!1,e.setState("saved")}var t=e.common.Utils,n=t.verify,r=t.getVal;i.prototype={save:function(r){var i=this,s=i.draft,o=(new Date).getTime(),u,a;if(s.state!=="unsaved")return;e.fire("stat:feature_invoke",{feature_group:"SAVE",message:"UI_SAVE_V3_START_SUCCESS"}),t.features.enabled("compose_save_adr")&&e.fire("darlaEvent",{action:"compose_save"}),this.dirty=!1,s.setState("saving"),a=this.service.save(s,!1,r),a.then(function(r){n(!s.hasCsid()||s.csid===r.result.messageV2.csid,"csid invariant violated on svr response."),e.fire("stat:feature_complete",{feature_group:"SAVE",message:"UI_SAVE_V3_COMPLETE_SUCCESS"}),e.fire("stat:feature_latency",{feature_group:"SAVE",message:"UI_SAVE_V3_COMPLETE",value:(new Date).getTime()-o}),u=s.state,r.result.messageV2&&(s.lastSavedRawBody=r.result.messageV2.part[0]);if(!i.dirty){s.setState("saved");return}s.setState("saved"),s.setState(u),n(s.state==="unsaved","state inconsistent w/dirty flag")},function(n){if(s.state==="sending"){e.fire("stat:feature_complete",{feature_group:"SAVE",message:"UI_SAVE_V3_CANCELED_SUCCESS"});return}e.fire("stat:feature_fail",{feature_group:"SAVE",message:"UI_SAVE_V3_COMPLETE_FAILURE",visible:!0,api:"messageSave"}),s.setState("unsaved",n.errDetail)})},_getErrorDetail:function(t){var n={message:"SavingAndSending: transport failed",code:"unknown"},i,s;try{i=r(t,"res.response");if(i)return n.message=e.JSON.parse(t.res.response).error.message,n.code=e.JSON.parse(t.res.response).error.code,n;i=r(t,"sendResponse.res");if(i)return s=e.JSON.parse(i.responseText),s=e.JSON.parse(s.error.message),n=s.error,n;i=r(t,"saveResponse.res");if(i)return s=e.JSON.parse(i.responseText),s=e.JSON.parse(s.error.message),n=s.error,n}catch(o){return n.message="SavingAndSending: unknown error",n}return n},send:function(n){function l(e){var n,r=NeoConfig.serverTime-NeoConfig.userRegTime<f,i={invoke:["ONBOARDING_SEND_INVOKED","ONBOARDING_CTRL_SEND_INVOKED","UI_SEND_V3_START_SUCCESS"],success:["ONBOARDING_SEND_SUCCESS","ONBOARDING_CTRL_SEND_SUCCESS","UI_SEND_V3_COMPLETE_SUCCESS"],failure:["ONBOARDING_SEND_FAILED","ONBOARDING_CTRL_SEND_FAILED","UI_SEND_V3_COMPLETE_FAILURE"],latency:["ONBOARDING_SEND_LATENCY","ONBOARDING_CTRL_SEND_LATENCY","UI_SEND_V3_COMPLETE"]};return t.features.enabled("onboarding")&&r?(n="_"+NeoConfig.expBucketId.slice("-3"),n==="_T01"&&(n=""),i[e][0]+n):t.features.enabled("onboardingctrl")&&r?i[e][1]:i[e][2]}function c(){i.setState("final"),e.fire("stat:feature_complete",{feature_group:"SEND",recipients:o,message:l("success")}),e.fire("stat:feature_latency",{feature_group:"SEND",recipients:o,message:l("latency"),value:(new Date).getTime()-s}),e.fire("SentSuccess",null,null,u)}function h(t){var n=r._getErrorDetail(t);if(i.state==="savingAndSending"&&i.isRejectedOnCaptcha()){i.setState("captchaing");return}i.state==="sending"&&n.code==="EC-4011"&&(r.draft.captcha=null,r.draft.captchaAnswer=null),e.fire("stat:feature_fail",{feature_group:"SEND",message:l("failure"),recipients:o,visible:!0,api:"messageSend"}),i.setState("unsaved",n)}function p(t){var n=t.errDetail;if(t.failure==="save"&&i.isRejectedOnCaptcha()){i.setState("captchaing");return}t.failure==="send"&&n.code==="EC-4011"&&(r.draft.captcha=null,r.draft.captchaAnswer=null);if(t.failure==="getCids"||t.failure==="sendGDM"){c(t);return}e.fire("stat:feature_fail",{feature_group:"SEND",message:"UI_SEND_V3_COMPLETE_FAILURE",recipients:o,visible:!0,api:"messageSend"}),i.setState("unsaved",n)}var r=this,i=r.draft,s=(new Date).getTime(),o=i.to.length,u,a,f=86400;o+=i.cc?i.cc.length:0,o+=i.bcc?i.bcc.length:0;if(i.state==="saving"||i.state==="sending"||i.state==="savingAndSending"||i.state==="sent"||i.state==="final")return;e.fire("stat:feature_invoke",{feature_group:"SEND",recipients:o,message:l("invoke")}),e.fire("SentStart"),this.dirty=!1,!i.hasAttachmentsToReconcile()&&(i.state==="captchaing"||i.state==="saved"&&i.hasCsid())?(i.setState("sending"),u="message_send",a=n?this.service.sendBatch(i,!1):this.service.send(i)):(i.setState("savingAndSending"),u="message_sendSave",a=n?this.service.sendBatch(i,!0):this.service.saveAndSend(i)),a.then(c,n?p:h)},edited:function(){this.draft.state!=="sent"&&this.draft.state!=="final"&&(this.dirty=!0,this.draft.setState("unsaved"))},unedited:function(){this.dirty=!1,this.draft.setState("saved")},isSaving:function(){return this.draft.state==="saving"},isEdited:function(){return this.draft.state==="unsaved"}},e.namespace("mail.Compose").Syncer=i},"1.0.0",{requires:["common-utils","mail-common-utils-features"]});
YUI.add("mail-model-spellcorrections",function(B){function A(){this.corrections=null;this.correctionsHash=null;this.publish("correctionsChanged");}B.mix(A.prototype,{setCorrections:function(C){this.corrections=C;this.fire("correctionsChanged");},setCorrectionsHash:function(C){this.correctionsHash=C;}});B.augment(A,B.EventTarget,true,null,{prefix:"spell"});B.namespace("mail.Model").SpellCorrections=A;},"1.0.0",{requires:["event-custom","oop"]});YUI.add("mail-controller-spell-processor",function(F){var C=F.common.Utils;var A={PREFIX:"spell",MIDPREFIX:"misspell-",MAX_SUGG:5,ERROR_404:"<html><head><title>Yahoo! - 404 Not Found</title><style>",MARK:"mark",MISPELLREG:null,MAX_SPELL_TEXT:51200};var B={},E={"str_rte_check_spelling":"NO_OP","str_rte_spell_lang_auto_select":"asl","str_rte_spell_lang_english_us":"en_US","str_rte_spell_lang_english_uk":"en_GB","str_rte_spell_lang_english_ca":"en_CA","str_rte_spell_lang_arabic":"ar","str_rte_spell_lang_bengali":"bn","str_rte_spell_lang_bulgarian":"bg","str_rte_spell_lang_croatian":"hr","str_rte_spell_lang_czech":"cs","str_rte_spell_lang_danish":"da","str_rte_spell_lang_dutch":"nl","str_rte_spell_lang_estonian":"et","str_rte_spell_lang_filipino":"tl","str_rte_spell_lang_finnish":"fi","str_rte_spell_lang_french_canada":"fr_CA","str_rte_spell_lang_french_france":"fr_FR","str_rte_spell_lang_french_switzerland":"fr_CH","str_rte_spell_lang_german_austria":"de_AT","str_rte_spell_lang_german_switzerland":"de_CH","str_rte_spell_lang_german_germany":"de_DE","str_rte_spell_lang_greek":"el","str_rte_spell_lang_gujarati":"gu","str_rte_spell_lang_hebrew":"he","str_rte_spell_lang_hindi":"hi","str_rte_spell_lang_hungarian":"hu","str_rte_spell_lang_indonesian":"id","str_rte_spell_lang_italian":"it","str_rte_spell_lang_kannada":"kn","str_rte_spell_lang_latvian":"lv","str_rte_spell_lang_lithuanian":"lt","str_rte_spell_lang_malay":"ms","str_rte_spell_lang_malayalam":"ml","str_rte_spell_lang_marathi":"mr","str_rte_spell_lang_norwegian_bokmal":"nb","str_rte_spell_lang_norwegian_nynorsk":"nn","str_rte_spell_lang_polish":"pl","str_rte_spell_lang_portuguese_brazil":"pt_BR","str_rte_spell_lang_portuguese_portugal":"pt_PT","str_rte_spell_lang_romanian":"ro","str_rte_spell_lang_russian":"ru","str_rte_spell_lang_serbian":"sr-cyrl","str_rte_spell_lang_slovak":"sk","str_rte_spell_lang_slovenian":"sl","str_rte_spell_lang_spanish":"es","str_rte_spell_lang_swedish":"sv","str_rte_spell_lang_tamil":"ta","str_rte_spell_lang_telugu":"te","str_rte_spell_lang_turkish":"tr","str_rte_spell_lang_ukrainian":"uk","str_rte_spell_lang_vietnamese":"vi"};var D={"en-US":"en_US","en-GB":"en_GB","en-CA":"en_CA","en-JO":"en_US","en-IN":"en_GB","ko-KR":"en_GB","en-SG":"en_GB","zh-Hant-TW":"en_GB","zh-Hant-HK":"en_GB","en-AU":"en_GB","en-NZ":"en_GB","en-MY":"en_GB","en-IE":"en_GB","en-PH":"en_GB","zh-CN":"en_GB","en-XC":"en_GB","en-035":"en_GB","th-TH":"en_GB","es-CL":"en_GB","es-US":"es","es-AR":"es","es-PE":"es","es-VE":"es","es-CO":"es","es-MX":"es","ar-JO":"ar","bn-BD":"bn","bg-BG":"bg","hr-HR":"hr","cs-CZ":"cs","da-DK":"da","nl-BE":"nl","nl-NL":"nl","et-EE":"et","tl-PH":"tl","fi-FI":"fi","fil-PH":"tl","fr-BE":"fr_FR","fr-CA":"fr_CA","fr-FR":"fr_FR","fr-CH":"fr_CH","de-AT":"de_AT","de-CH":"de_CH","de-DE":"de_DE","el-GR":"el","gu-IN":"gu","he-IL":"he","hi-IN":"hi","hu-HU":"hu","id-ID":"id","it-IT":"it","kn-IN":"kn","lv-LV":"lv","lt-LT":"lt","ms-MY":"ms","ml-IN":"ml","mr-IN":"mr","nb-NO":"nb","nn-NO":"nn","pl-PL":"pl","pt-BR":"pt_BR","pt-PT":"pt_PT","ro-RO":"ro","ru-RU":"ru","sr-Cyrl-RS":"sr-cyrl","sk-SK":"sk","sl-SI":"sl","es-ES":"es","sv-SE":"sv","ta-IN":"ta","te-IN":"te","tr-TR":"tr","uk-UA":"uk","vi-VN":"vi"};function G(){this.spellHelper=A;}F.mix(G.prototype,{checkSpelling:function(N,K,M,H,I){var O=this,T=this.getLangSymbol(H);if(T==="NO_OP"){return;}if(T===""||T==="asl"){T=false;}if(T==="fr_CA"){T="fr_FR";}var L=function(W){var V=(W)?F.JSON.parse(W.responseText):null;O._saveMisspelledWords(N,V);};var S={success:function(W){var V=(W)?F.JSON.parse(W.responseText):null;O._saveMisspelledWords(N,V);},failure:function(){},responseType:"text",args:{}};S.success=(I)?I:L;var Q=K.replace(/%/g,"%25");if(Q&&Q.length>A.MAX_SPELL_TEXT){Q=Q.substring(0,A.MAX_SPELL_TEXT);}if(Q.match(/<var.*yui-ie-cursor.*var>/g)){Q=Q.replace(/<var.*yui-ie-cursor.*var>/g,"");}var J={};J.text=Q;J.iformat="html";J.oformat="js";J.intl=M;J.lang=T;var P=NeoConfig.launch_protocol+document.location.host;var R=P+"/ysp.php";var U=F.common.net.SessionMgr.request(R,F.common.net.SessionMgr.formatQueryParams(J),S,"POST");U.setHeader("Content-Type","application/x-www-form-urlencoded");U.setHeader("Connection","close");U.send();},markMisspelledWords:function(N,H,Q){var O="";if(H&&H.length){var K=H.length;var J=0;var R="";var I=null,P=null;var L=0;for(var M=0;M<K;++M){L=parseInt(H[M].offset,10);I=H[M].word;if(this._isWordIgnored(I,Q)){continue;}O+=N.substring(J,L);P=N.substring(L,L+I.length);if(I===P){O+=this._getMarkerHtml(A.MIDPREFIX+M,P);}else{O+=P;R+=I+"="+P+"|";}J=L+I.length;}if(R){}O+=N.substr(J,N.length);}return O;},_saveMisspelledWords:function(I,H){var K={};if(H&&H.length){var M=H.length;for(var J=0;J<M;++J){var L=H[J].word;K[L]=H[J];}}I.setCorrectionsHash(K);I.setCorrections(H);},removeAllMarkers:function(I,J){var H=(J&&J.toUpperCase)?J.toUpperCase():"";I.all("span[class='"+A.MARK+"']").each(function(L){if(L.get("id").indexOf(A.MIDPREFIX)!==-1){var K=L.get("text").toUpperCase();if(H!==""&&H!==K){return;}I.insert(L.get("innerHTML"),L);L.purge();L.remove();}});},removeMarker:function(I,H){var J=H.get("innerHTML");this.updateMarker(I,H,J);},updateMarker:function(K,H,J){if(J){var I=H.cloneNode(true);I.set("innerHTML",J);I.removeClass(A.MARK);H.purge();H.replace(I);}else{H.purge();H.remove();}},_getMarkerHtml:function(H,I){var J=[];J.push('<span id="');J.push(H);J.push('" class="');J.push(A.MARK);J.push('">');J.push(I);J.push("</span>");return J.join("");},getLangSymbol:function(K){var H="",J,I;if(C.isEmpty(B)){for(I in E){J=strings[I];if(J){B[J]=E[I];}}}if(K){H=B[K];}else{H=D[NeoConfig.lang];}return(H)?H:"";},_getHeaderIgnoredWord:function(K){var I="";if(K){var J=0,H=K.length,L;for(J=0;J<H;J++){L=K[J];I+=L.name+" "+L.email+" ";}}return I;},gatherIgnoreWords:function(O,N){var L="";O.all("img").each(function(P){if(P.hasAttribute("alt")){var Q=P.get("alt");L+=Q+" ";}});if(N.currentAddress){L+=N.currentAddress+" ";}L+=this._getHeaderIgnoredWord(N.from);L+=this._getHeaderIgnoredWord(N.to);
L+=this._getHeaderIgnoredWord(N.cc);L+=this._getHeaderIgnoredWord(N.bcc);var H=F.common.persist.UserData;var K=H.get("userSendPref.defaultFromAddress")||"",J=H.get("userSendPref.defaultFromName")||"",I=H.get("userSendPref.defaultID")||"",M=H.get("userSendPref.loggedInAlias")||"";L+=K+" "+J+" "+I+" "+M+" ";L=L.toUpperCase();L=L.replace(/[\x21-\x40\x5B-\x60\x7B-\x7E]/g," ");L=L.replace(/([^;])[-_\s]+/g,"$1|");return L?L.split("|"):[];},_isWordIgnored:function(J,I){if(I.length===0){return false;}J=J.toUpperCase();var H=F.Array.indexOf(I,J);return(H!==-1);}});F.namespace("mail.Controller").SpellProcessor=new G();},"1.0.0",{requires:["mail-model-spellcorrections","common-net-sessionmgr","common-persist-user-data","json-parse"]});YUI.add("mail-controller-composecontent-helper",function(e){function t(e){this.ctrl=e}e.mix(t.prototype,{attachFromBlob:function(t,n){var r=new e.mail.Models.Attachment(null,{file:t.blob,filename:t.name,size:n,disposition:"attachment"});this.ctrl.draft.addAttachment(r),this.ctrl.draft.setState("unsaved"),this.ctrl.save()},attachFromMessageData:function(t,n){var r=t.mid,i=t.partId*1,s=t.name,o=t.thumbnailurl||t.thumbnail,u;if(!(e.Lang.isNumber(i)&&e.Lang.isString(s)&&e.Lang.isString(r)&&e.Lang.isString(o)))return;u=new e.mail.Models.Attachment(r,{mid:r,partId:i,filename:s,size:n,thumbnailurl:o}),u.setState("uploaded"),this.ctrl.draft.addAttachment(u),this.ctrl.draft.setState("unsaved"),this.ctrl.save()},handleAttachment:function(e){var t=this;if(t.ctrl.willAttachmentOverflow(e.length))return;switch(e.type){case"attachment":t.attachFromMessageData(e.data,e.length);break;case"blob":t.attachFromBlob(e.data,e.length)}},handleInsertText:function(e){var t=this.ctrl.view,n=e.data,r=t.getRTE().rte,i;r.setCaret();switch(e.type){case"plain":r.insertText(n);break;case"html":r.isRich&&(i=r.getPluginByName("rte-caret-plugin"),i&&i.restoreCaret(),r.pushButton("insertHtml",n));break;default:throw"unknow dataTransfer content type "+e.type}},handleDataTransfer:function(e){var t=this,n=e.payload,r=e.payload&&e.payload.content;if(!(n&&n.action&&r&&r.type&&r.data&&r.length>=0))return;switch(n.action){case"attach":t.handleAttachment(n.content);break;case"insertText":t.handleInsertText(n.content);break;default:throw"unknow dataTransfer action"+n.action}t.ctrl.attachedUsingComposeAssist=e.payload.source==="compose_assist"}}),e.namespace("mail.Controller").ComposeContentHelper=t},"1.0.0",{requires:["mail-model-attachment"]});
YUI.add("mail-controller-inlineimage-processor",function(E){function B(){}function C(F){var G;if(!F.attachments){return 0;}G=F.attachments.reduce(function(H,I){return H+I.size();},0);return G;}function A(F){if(F&&F.attachments){F.attachments.filter(function(G){if((G.state()==="failed"||G.state()==="infected")&&G.isInline()){G.setState("deleted");}return true;});}}function D(H){var M=H.inlineImageNode,G=H.ctrl,F=H.lastExitCode,K=H.imageList,I=H.attachmentList,Q=M.getAttribute("data-id"),L=K.get(Q),O,P="",J,N;if(0!==F){return 1;}if(!L){return 1;}H.rteImagePlugin.setDraftModel(G.draft);O=L.get("attachment");if(O&&O.state()!=="pending"){O.setState("deleted");O=null;}if(!O){N=L.processedFile.size;if(G.isOverMaxFileSize(H.existingAttachmentSize+N)){G.view.showAttachmentSizeDialog("25");G.draft.fire("attachmentSizeOverflow");H.node.all(".rte-inline-unsaved-image").remove();return 1;}else{H.existingAttachmentSize=H.existingAttachmentSize+N;}O=new E.mail.Models.Attachment(null,{file:L.processedFile,filename:L.file.name,size:N,"disposition":"inline"});I.push(O);G.draft.addAttachment(O);L.set("attachment",O);}J=O.contentId().match(/\<(.+)\>/);if(J){P=J[1];}M.setAttribute("src","cid://"+P);M.addClass("rte-inline-saved-image");M.addClass(Q);return 0;}E.mix(B.prototype,{process:function(J,H){var K=J.getRteImagePlugin(),I=E.Node.create("<div>"+H+"</div>"),G,F;if(!K){return H;}F={ctrl:J,lastExitCode:0,existingAttachmentSize:C(J.draft),attachmentList:[],imageList:K.imageList,node:I,rteImagePlugin:K};I.all(".rte-inline-unsaved-image").each(function(L){F.inlineImageNode=L;F.lastExitCode=D(F);});I.all(".rte-inline-unsaved-image").removeClass("rte-inline-unsaved-image");if(1===F.lastExitCode){for(G=0;G<F.attachmentList.length;G++){F.attachmentList[G].setState("deleted");}}A(J.draft);H=I.get("innerHTML");return H;}});E.namespace("mail.Controller").InlineImageProcessor=new B();},"1.0.0",{requires:[]});YUI.add("mail-controller-compose-v3",function(e){function w(){var t=g.getVal(this,"view.editor.rte.element");if(!t)return;e.one(t).all("img").each(function(t){var n=t.getAttribute("data-id");n||t.setAttribute("data-id",e.common.Utils.guid())})}function E(e){var t=this;this.injectDataIdFromImages(),this.setDraftHeader(),this.setDraftBody(),t.syncer.save({suppressNotification:!!e,suppressStat:!!e})}function S(){var t=this,n;this.setDraftHeader(),this.setDraftBody({isSend:!0}),t._validateSend().then(function(){t.attachOnSend&&(t.draft.setState("unsaved"),t.attachOnSend=!1),t.syncer.send(!0),t.draft.attachments&&t.draft.attachments.length&&(n=t.view.get("isQuickReply"),d.enabled("richcompose")&&e.fire("util:ymstats",{name:"compose_assist_att_send",tags:{caUsed:t.attachedUsingComposeAssist?1:0,type:n?"QR":"fullCmps"}}),e.fire("mt:click",{action:"tlbr_att_send",append:{ltxt:t.attachedUsingComposeAssist?"ca":"noca",cmpsType:n?"QR":"fullCmps"}}))})}function x(){var t=this,n=this.view.sendValidationHandlers,r=e.mail.Models.Validators.send,i=[],s,o;return o=r.validateNotUploadingAttachments(t.draft),o.valid?(o=r.validateCleanAttachments(t.draft),o.valid?(o=r.validateAddress(t.draft),o.valid?(o=r.validatePresenceOfRecipients(t.draft),o.valid?(o=r.validateNumberOfRecipients(t.draft),o.valid?(o=r.validateSpame(t.draft),o.valid?(o=r.validatePresenceOfContent(t.draft),o.valid||i.push(new Promise(function(e,t){n.handleEmptyMessage(e,t)})),o=r.validateCaptcha(t.draft),o.valid||i.push(new Promise(function(e,r){n.handleCaptcha(e,r,t.draft)})),d.enabled("attachInReply")&&t.attachInReply&&(o=r.checkForAttachment(t.draft),o.valid||i.push(new Promise(function(e,r){n.handleNewRecipients(e,r,t)}))),"saving"===t.draft.state&&(s=function(e,n){t.view.showComposeShim(!0),t.draft.once("stateChanged",function(r){"saving"===r.prev&&"saved"===r.next?e():(t.view.showComposeShim(!1),n())})},i.push(new Promise(s))),Promise.all(i)):(n.handleSpame(),Promise.reject())):(n.handleTooManyRecipients(),Promise.reject())):(n.handleNoRecipients(),Promise.reject())):(n.handleAddressInvalid(o.invalidAddress),Promise.reject())):(n.handleBadAttachments(o.cntInfected),t.view.tray.showError(),Promise.reject())):(n.handleUploadInProgress(),Promise.reject())}function T(){this.syncer.edited()}function N(){this.syncer.unedited()}function C(){return this.syncer.isSaving()}function k(){return this.syncer.isEdited()}function L(){return this.prePopulated}function A(e){var t=this.view.getFontInfo(),n=this.view.getRTEDocNode(),r=g.getVal(this.draft.origin,"yqtdPrefix"),i,s="",o="",u=!!e&&e.isSend;this.view._isSpellCheckActive()&&p.removeAllMarkers(n,null),this.view._isRTEActive()?(i=this.view.getContent(),s=f.process(i,r),u||(s=l.process(this,s)),s=f.wrap(s,t)):o=a.process(n),this.view.updateUploadForm&&(window.FormData===undefined||window.FileReader===undefined)&&this.view.updateUploadForm(),this.draft.setBody(o,s),this.view.dirty&&this.draft.setSpame("U")}function O(){var t=this.view.getHeader(),n=e.mail.Controller.mailComposeFromListHelper.getReplyTo;t.replyto={email:n(t.from.email),name:t.from.name},this.draft.setHeader(t)}function M(){this.edited(),this.save()}function _(){this.view.on("FullCompose:composeEvent",this.handleEvent,this)}function D(){var t,n,r=e.mail.ui&&e.mail.ui.MailView&&e.mail.ui.MailView.prototype,i=e.one("#shellcontent");this.parent&&(t=this.parent.all(".compose-loading-wrapper"),t&&t.remove(),this.view.render(this.parent),this.composeViewTainer=this.view.baseNode),this.view.on("attachmentUpload",this.handleFileUpload,this),this.view.on("dataTransfer",this.composeContentHelper.handleDataTransfer,this.composeContentHelper),this.view.on("attachmentUploadForm",this.handleFileUploadForm,this),this.draft.on("stateChanged",this.handleStateChange,this),this.view.neoFire("composeEvent",{action:"bindComplete",ccv:this}),n=this.getRteImagePlugin(),n&&(n.setDraftModel(this.draft),n.on("inline-image-updated",this.handleInlineImageAdded,this)),r&&!r.isToolBarFit()?i&&i.addClass("narrow-rightPV"):i&&i.removeClass("narrow-rightPV")}function P(e){var t,n,r=d.enabled("ccOnSend"),i=v.get("ccOnSend"),s;if(r){s=c.getDefaultFromAddress();if(i==="bcc"||i==="both"){e.bcc||(e.bcc=[]),n=!1;for(t=0;!n&&t<e.bcc.length;t++)e.bcc[t].email===s.email&&(n=!0);n||e.bcc.push(s)}if(i==="cc"||i==="both"){e.cc||(e.cc=[]),n=!1;for(t=0;!n&&t<e.cc.length;t++)e.cc[t].email===s.email&&(n=!0);n||e.cc.push(s)}}}function H(t,n){var r=this,i=new e.Mail.Models.Draft;return r.setDraftOrigin(i,t),n||r.setMessageFromAddress(i),t&&t.cbfn&&(this.prePopulated=t.cbfn(i,t)),n||h.insertSignature(i,m.get("userUIPref.useRichText")),i.folder.id=y(),n||r._setAutoCC(i),i}function B(e){var t=this,n=e.action;t.eventHandlers&&t.eventHandlers[n]&&t.eventHandlers[n](e)}function j(e){var t=new FileReader;return new Promise(function(n){t.onload=function(t){e.realSize=t.total,n()},t.onerror=function(){e.realSize=0,n()},t.readAsArrayBuffer(e)})}function F(t,n,r){var i=this,s=n.reduce(function(e,t){return e+t.size()},0),o=[],u=0;e.Array.each(t,function(e){o.push(i._findRealFileSize(e))}),Promise.all(o).then(function(){u=t.reduce(function(e,t){return e+t.realSize},0),typeof r=="function"&&r(s,u)})}function I(t){var i=this,s=this.draft.attachments,u=Promise.resolve();return i._determineSize(t.files,s,function(a,f){var l=o.get("largeFileUploaders"),c=t.files.filter(function(e){return e.realSize===0});if(c.length>0){i.view.showAttachmentEmptyDialog(c);return}i.isOverMaxFileSize(a+f)?l.length>0?u=l[0].upload(t.files).then(function(e){i.view.addCards(e)}):i.view.showAttachmentSizeDialog(n):s.length+t.files.length>r?i.view.showAttachmentCountDialog(r):(e.Array.each(t.files,function(t){i.draft.addAttachment(new e.mail.Models.Attachment(null,{file:t,filename:t.name,size:t.realSize}))}),i.edited(),i.save())}),u}function q(t){var n=this,i=t.inputEl,s=i.value||"",o=s.substr(s.lastIndexOf("\\")+1);n.draft.attachments.length+1>r?n.view.showAttachmentCountDialog(r):(n.draft.addAttachment(new e.mail.Models.Attachment
(null,{inputEl:i,filename:o,size:1})),n.edited(),n.save())}function R(e){var n=this,i=n.draft.attachments,s=t+"",o=i.reduce(function(e,t){return e+t.size()},0);return n.isOverMaxFileSize(o+e)?(n.view.showAttachmentSizeDialog(s),!0):i.length+1>r?(n.view.showAttachmentCountDialog(r),!0):!1}function U(e){var t=this,n;if(e.next==="sent"){var r;t.view.dirty=!1,n="closeAction",r=t.eventHandlers[n],r(e)}else e.next==="final"?t.autoAddContacts(t.draft):e.next==="captchaing"&&(t.captchaRetryCount>=i?(t.captchaRetryCount=0,t.draft.setState("unsaved",{code:"EP-4010"})):(t.captchaRetryCount++,t._validateSend().then(function(){t.syncer.send(!0)})["catch"](function(){t.draft.setState("saved")})))}function z(){var t=this;!NeoConfig.isAMT&&m.get("userSendPref.addUnknownContact")!=="prompt"&&e.use("mail-controller-contact-processor",function(e){e.mail.Controller.ContactProcessor.addContacts(t.draft)})}function W(e){var t=e.header||{};t.from=c.getDefaultFromAddress(),e.setHeader(t)}function X(e,t){t&&t.action&&t.fid&&t.oMsg&&e.setOrigin({action:t.action,fid:t.fid,oMsg:t.oMsg,parentMsg:t.parentMsg,forwardAsAttachment:t.forwardAsAttachment,ctxReq:null})}function V(e){this.parent=e}function $(e){var t=this;t.view.isSending=!1,t.view.resetSaveTimer(),e&&(t.view.dirty=!0,t.view.allowSend=!0),t.composeActive=!0}function J(){var e=g.getVal(this,"view.editor.rte.plugins"),t=0;if(!e)return null;for(t=0;t<e.length;t++)if(e[t].name==="inline-image-plugin")return e[t];return null}function K(e){return e>n}var t=25,n=t*1024*1024,r=50,i=2,s=e.common,o=e.Mail.Services.Plugins,u=e.mail.model.DataStore.Folders,a=e.mail.Controller.TextProcessor,f=e.mail.Controller.HtmlProcessor,l=e.mail.Controller.InlineImageProcessor,c=e.mail.Controller.ReplyProcessor,h=e.mail.Controller.SignatureProcessor,p=e.mail.Controller.SpellProcessor,d=e.common.Utils.features,v=e.mail.persist.MetaData,m=s.persist.UserData,g=s.Utils,y=function(){var t,n,r,i;return NeoConfig.imapIn?(i=e.mail.ui.FolderUtils,r=e.mail.Controller.ImapIn,n=r.getCurrentAccountId(),t=r.getFolderByType(i.DraftFolderType,n).folderInfo.index):t=""+u.getByName("Draft").folderInfo.index,t},b=function(t,n,r,i,s){this.parent=t,this.draft=this.initDraftModel(r,s),this.draft.folder.id=y(),this.eventHandlers=n||{},this.view=new e.mail.Views.Compose(this.draft,this,s,r,i),this.service=new e.Mail.Services.Compose(NeoConfig.V3MailboxId),this.syncer=new e.mail.Compose.Syncer(this.draft,this.service),this.composeContentHelper=new e.mail.Controller.ComposeContentHelper(this),this.captchaRetryCount=0,this.attachInReply=!0,n&&this.bindComposeEvent()};b.prototype={save:E,send:S,edited:T,unedited:N,isSaving:C,isEdited:k,isPopulated:L,setDraftHeader:O,setDraftBody:A,initDraftModel:H,setMessageFromAddress:W,setDraftOrigin:X,bindComposeView:D,bindComposeEvent:_,setParent:V,handleEvent:B,handleFileUpload:I,handleFileUploadForm:q,willAttachmentOverflow:R,handleStateChange:U,autoAddContacts:z,showCompose:$,_validateSend:x,isOverMaxFileSize:K,_findRealFileSize:j,_determineSize:F,_setAutoCC:P,getRteImagePlugin:J,handleInlineImageAdded:M,injectDataIdFromImages:w},e.namespace("mail.Controller").ComposeController=b},"1.0.0",{requires:["mail-ui-fullcompose-v3","mail-models-validators-send","mail-model-datastore","mail-models-draft","mail-model-attachment","mail-services-compose","mail-services-plugins","mail-compose-syncer","mail-controller-reply-processor","mail-controller-html-processor","mail-controller-text-processor","mail-controller-signature-processor","mail-controller-spell-processor","mail-ui-mailcompose-header-form-list-helper","mail-controller-composecontent-helper","mail-controller-inlineimage-processor","mail-common-utils-features","rte-file-utils","mail-ui-mailview-base","mail-ui-folder-utils"]});
YUI.add("mail-ui-authorview-v3",function(e){function u(){var t=this;t.closeChgHandler=t.on("closeChange",t.handleCloseChange,t),t.activeChangeHandler=t.on("activeChange",t.handleActiveChange),NeoConfig.hasConvView?t.msgsRemoveHandler=e.on("ds:conv:remove",t.handleConvRemove,t):t.msgsRemoveHandler=e.on("ds:msg:remove",t.handleMsgRemove,t)}function a(e){var t=this;e.newVal?(t.view.set("active",!0),t.view.showComposeView(e)):(t.view.set("active",!1),t.view.hideComposeView(e))}function f(e){var t=this;e.newVal&&t.view.closeCompose()}function l(e,t,n,r,i){var s,o=t||[],u;if(i&&i.reason==="savedraft")return;if(e!=="Draft")return;for(s=0;s<o.length;s++)u=o[s],this.view.getDraftMID()===u.mid&&this.set("close",1)}function c(e,t){var n,r=t||[],i;if(e!=="Draft")return;for(n=0;n<r.length;n++)i=r[n],i.totalMsgs===1&&this.view.getDraftMID()===i.recentmid&&this.set("close",1)}function h(e){var t="str_comp_nosubject",n=e||strings[t];this.set("title",n)}function p(e){this.set("direction",e)}function d(e){var t=this,n=t.localCharCodes.length,r;for(r=0;r<n;r++)if(e===t.localCharCodes[r])return!0;return!1}function v(){var e=this;if(e.view)return[e.view]}function m(t){var n=this,r=t.keyCode;r=n.keyCodesL10N[r]||r;switch(r){case 220:if(!t.altKey&&(t.metaKey||t.ctrlKey))return n.set("close",1),!0;break;case 27:return n.controller&&(n.controller.closeSrc="escKey"),(!e.ACWidgetInst.handleEscape||!e.ACWidgetInst.handleEscape())&&n.set("close",1),!0}return e.UA.ie&&n.view.onLocalKeyDown&&!n.view.onLocalKeyDown(t)?!1:n.view&&n.view.onKeyDown?n.view.onKeyDown(t):null}function g(e){return this.view.onFocus(e)}function y(){return this.view.isDirty()}function b(){return!this.isDirty()&&!this.view.hasContent()}function w(e){var t=this;return t.view.matchOrigin?t.view.matchOrigin(e):!1}function E(t,n){var r=this;return r.view=r.createComposeController(t,n).view,r.view.handles.push(r.view.on("renderComplete",function(){r.set("rootNode",r.get("parentNode").one("div.compose")),t&&t.postRender&&t.postRender(r,t),s.enabled("richcompose")&&(!r.view.get("isQuickReply")||s.enabled("richcomposeInQuickReply"))&&e.use("mail-ui-richcompose-view",function(e){r.richcompose||(r.richcompose=new e.mail.Views.RichCompose(r,r.view))})})),t&&t.oMsg&&t.oMsg.header&&(t.oMsg.header.subject=e.mail.Controller.ReplyProcessor.seedSubject(t)),r.view}function S(t,n){var r=this,s=null,o;return i({m:"start creating ComposeController"}),o={keydownHandler:e.bind(r.onKeyDown,r)},s=new e.mail.Controller.ComposeController(r.get("parentNode"),r.getEventBindings(),t,o,n),s.handles=[],r.controller=s,s}function x(e){e.action=e.type,this.fire("darlaEvent",e)}function T(){var e=this;e.parent=e.get("parentNode"),e.controller.setParent(e.parent),e.controller.bindComposeView()}function N(t){var n=this,r=e.one(t);n.set("parentNode",r),n.set("rootNode",r.one("div.compose"));return}function C(){return}function k(e){var t=this;t.controller.composeViewTainer&&this.controller.composeViewTainer.one(".composeshim")[e?"removeClass":"addClass"]("hidden"),e?t.tab&&t.tab.elTab.addClass("sending"):t.tab&&t.tab.elTab.removeClass("sending")}function L(){var e=this,t=e.view.getSubjectInfo();t.subjectVal?(e.updateTabTitle(n(r(t.subjectVal))),t.subjectDir&&e.updateTabDirection(t.subjectDir)):(e.updateTabTitle(e.view.title),t.subjectDir&&e.updateTabDirection(""))}function A(){var e=this;e.msgsRemoveHandler&&e.msgsRemoveHandler.detach(),e.closeChgHandler&&e.closeChgHandler.detach(),e.toolBarHandler&&e.toolBarHandler.detach(),e.activeChangeHandler&&e.activeChangeHandler.detach(),o.superclass.ondestroy.call(e,arguments)}function O(t){var i=this;i.updateTabTitle(n(r(t.subject))),NeoConfig.bidi&&i.updateTabDirection(e.Intl.detectDirection(t.subject))}function M(e){return this.view.canClose(e)}function _(e){var t=this;this.view.fire("composeWillClose"),e.forceClose&&t.set("forceClose",1),t.set("close",1)}function D(e){this.set("focusNode",e.focusNode)}function P(){this.tab!==e.mail.Tabs.getActiveTab()&&e.mail.Tabs.switchToTab(this.tab)}function H(t){var n=this;n.tab!==e.mail.Tabs.getActiveTab()?e.mail.Tabs.switchToTab(n.tab,t.sdcbk()):t.sdcbk()}function B(e){var t=this;e.sending?t.tab&&t.tab.elTab.addClass("sending"):(t.tab&&t.tab.elTab.removeClass("sending"),e.title?t.updateTabTitle(e.title):t.setSubjectAsTitle())}function j(){var t=this,n={updateSubject:e.bind(t.setSubjectAsTitle,t),closeAction:e.bind(t.closeAction,t),qrCancel:e.bind(t.closeAction,t),replyheaderLoad:e.bind(t.replyheaderLoad,t),setFocusNode:e.bind(t.setFocusNode,t),showSaveDialog:e.bind(t.showSaveDialog,t),showCompose:e.bind(t.showCompose,t),addChild:e.bind(function(e){this.addChild(e.view)},t),removeChild:e.bind(function(e){this.removeChild(e.view)},t),updateTitle:e.bind(t.updateTitle,t),switchToTab:e.bind(t.switchToTab,t),darlaEvent:e.bind(t.fireDarlaEvent,t)};return n}var t=e.common.Utils,n=t.escapeHtml,r=t.unescapeHtml,i=t.log,s=t.features,o=function(t){var n=this,r;n.keyCodes=[],n.keyCodesL10N={},n.parent=null,n.view=null,n.controller=null,n.localCharCodes=[8,77,78,73,84],n.composeActive=!0,n.type="author",n.widgetType="compose",n.keyCodesL10N[strings.str_cfg_sc_keycode_save_as_draft]=83,n.keyCodesL10N[strings.str_cfg_sc_keycode_close_tab]=220;for(r in n.keyCodesL10N)n.keyCodes.push(r);o.superclass.constructor.call(n,t),n.bind(),n.set("charCodes","13,13+ctrl,13+meta,27,188+ctrl,190+ctrl,"+n.keyCodes.join("+ctrl,")+"+ctrl,"+n.keyCodes.join("+meta,")+"+meta"),e.UA.ie&&n.set("localCharCodes",n.localCharCodes.join()),n.updateTabTitle(n.get("title"))};e.extend(o,e.mail.ui.BaseWidget),e.mix(o.prototype,{NAME:"AuthorView",ondestroy:A,onKeyDown:m,onFocus:g,bind:u,bindUI:C,render:N,initCompose:E,createComposeController:S,bindComposeView:T,isLocalCharCode:d,isDirty:y,isClean:b,matchOrigin:w,updateTabTitle:h,updateTabDirection:p,handleCloseChange:f,showComposeShim:k,getComposeWidgets:v,setSubjectAsTitle:L,setFocusNode:D,showSaveDialog:H,_canClose:M,closeAction:_,handleActiveChange:a,replyheaderLoad:O,getEventBindings:j,updateTitle
:B,switchToTab:P,handleConvRemove:c,handleMsgRemove:l,fireDarlaEvent:x},!0),e.namespace("mail.ui"),e.mail.ui.AuthorViewConv=o},"1.0.0",{requires:["mail-controller-base","mail-controller-reply-processor","_shared_module_compose_title","mail-common-utils-features","mail-controller-compose-v3"]});
