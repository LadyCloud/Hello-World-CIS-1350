YUI.add("contacts-ui-hovercard-datastore",function(e){var t,n=e.xobniContacts.searchAPI,r=e.xobniContacts.Utils.getXobniBaseURL();t=function(){var t=this;t.cache=new e.Cache({max:250,expires:36e5,uniqueKeys:!0}),e.on("xobni:contactChanged",function(e){t.addIntoCache(e.email,null)})},t.prototype={isFBTokenActive:null,load:function(t,n){var r=this,i,s=[],o=[];e.xobniContacts.isXobnified()?e.Array.each(t,function(e){i=r.retrieveFromCache(e),i?s.push(i):o.push(e)}):e.Array.each(t,function(e){s.push({name:e.name||e.email,email:e.email,card_size:0})}),o.length>0?(e.fire("util:ymstats",{name:"hovercard_ds",tags:{chache_hit:"false"}}),r.getContacts(o,s,n,0)):(e.fire("util:ymstats",{name:"hovercard_ds",tags:{chache_hit:"true"}}),n(s))},getContacts:function(t,r,i,s){var o=this,u=[],a,f,l=2,c;a=function(n){var o=this,u=n.contacts_by_ep,a=n.contacts_info,f,l,c;e.Object.each(u,function(n,i){l=i.replace("smtp:",""),f=n&&n[0],f?c=o.massageContactData(a[f],l):e.Array.each(t,function(e){l===e.email&&(c=o.massageContactData({email:e.email,endpoints:[]},e.email,e.name||e.email))}),r.push(c),o.addIntoCache(l,c)}),e.fire("util:ymstats",{name:"hovercard_api",tags:{api:"contactsByEp",result:"success",retry:s}}),i(r)},f=function(n){e.fire("util:ymstats",{name:"hovercard_api",tags:{api:"contactsByEp",result:"failure",retry:s}}),s<l?(s++,o.getContacts(t,r,i,l)):(e.Array.each(t,function(e){r.push(o.massageContactData({email:e.email,endpoints:[]},e.email,e.name||e.email))}),i(r))},e.Array.each(t,function(e){c=e.isCompose,u.push("smtp:"+e.email)}),n.contactsByEp({eps:u,isCompose:c},e.bind(a,o),e.bind(f,o))},massageContactData:function(t,n,i){var s=this,o={},u=t.endpoints,a,f,l;o={id:t.id,email:n,edit_token:t.edit_token,image_url:r.url,updated:Math.floor(Math.random()*1e5),card_size:0,endpoints:[],location:"",buildNumber:NeoConfig.buildNumber,isKnownEntity:t.is_known_entity,isMachineGenerated:!1},t.name?o.name=t.name.name:o.name=i||n,t.role&&(o.card_size++,o.company=t.role.company,o.position=t.role.position,o.company&&o.position?o.title=o.position+", "+o.company:o.title=o.position||o.company,e.fire("util:ymstats",{name:"hovercard_role",tags:{source:t.role.source,isCorp:NeoConfig.isCorpmail?"true":"false"}}));for(l=0;l<u.length;l++){a=u[l];if(!o.phone&&a.ep.match(/tel:/g))o.card_size++,o.phone=a.display||a.ep.replace("tel:",""),o.isElcaro=a.source==="elcaro"?!0:!1,e.fire("util:ymstats",{name:"hovercard_phone",tags:{source:a.source,isCorp:NeoConfig.isCorpmail?"true":"false"}});else if(!o.im&&a.ep.match(/ymessenger:/g))o.im=a.display||a.ep.replace("ymessenger:","");else if(!o.facebook&&a.ep.match(/facebook:/g))o.facebook=a.display||a.ep.replace("facebook:",""),o.facebook_url="https://www.facebook.com/"+o.facebook;else if(!o.linkedin&&a.ep.match(/linkedin:/g))o.linkedin=a.ep.replace("linkedin:",""),o.linkedin_url=a.display;else if(!o.twitter&&(a.ep.match(/twitter:/g)||a.source==="twitter")){o.twitter=a.display||a.ep.replace("twitter:","");while(o.twitter.charAt(0)==="@")o.twitter=o.twitter.substr(1);o.twitter_url="https://twitter.com/"+o.twitter+"?app=yahoo_mail"}else!o.flickr&&a.ep.match(/flickr:/g)&&(o.flickr=a.ep.replace("flickr:",""),o.flickr_url="https://www.flickr.com/"+o.flickr);f=a.ep.split(":"),o.endpoints[f[0]]||(o.endpoints[f[0]]=[]),o.endpoints[f[0]].push(a)}return e.Array.each(t.attributes,function(e){o.location===""&&e.key==="location"&&(o.location=e.value),e.key==="user_id"&&e.source==="corpdir"&&(o.corpId=e.value),e.key==="last_edit_timestamp"&&(o.updated=e.value),e.key==="is_machine_generated"&&(o.isMachineGenerated=e.value==="true"?!0:!1)}),o},addIntoCache:function(e,t){var n=this;n.cache.add(e,t)},retrieveFromCache:function(e){var t=this,n,r;return e.email===NeoConfig.emailAddress?r=t.massageContactData({email:e.email,endpoints:[]},e.email,e.name||e.email):(n=t.cache.retrieve(e.email),r=n&&n.response||null),r},flushCache:function(){this.cache.flush()}},e.namespace("mail.ui"),e.mail.ui.HoverCardDataStore=new t},"0.0.1",{requires:["cache-base","xobni-utilities","xobni-contacts-search-api"]});
YUI.add("mail-common-connected-accounts-ult",function(e){e.mix(e.common.Utils.RapidCM,{ln_interstitial:["dialog","dialog","lnkdnDlg","show"],ln_interstitial_close:["dialog","dialog","lnkdnDlg","cls"],linkedin_oauth_popup:["popup","popup","lnkdnOAuth","wndwOpnd"],linkedin_link_done:["popup","popup","lnkdnOAuth","cnnct","done"],linkedin_link_declined:["popup","popup","lnkdnOAuth","cnnct","dclnd"],linkedin_link_error:["popup","popup","lnkdnOAuth","cnnct","err"],linkedin_unlink_done:["popup","popup","lnkdnOAuth","dscnnct","done"],linkedin_unlink_error:["popup","popup","lnkdnOAuth","dscnnct","err"],facebook_oauth_popup:["popup","popup","fcbkOAuth","wndwOpnd"],facebook_link_done:["popup","popup","fcbkOAuth","cnnct","done"],facebook_link_declined:["popup","popup","fcbkOAuth","cnnct","dclnd"],facebook_link_error:["popup","popup","fcbkOAuth","cnnct","err"],facebook_unlink_done:["popup","popup","fcbkOAuth","dscnnct","done"],facebook_unlink_error:["popup","popup","fcbkOAuth","dscnnct","err"],twitter_oauth_popup:["popup","popup","twttrOAuth","wndwOpnd"],twitter_link_done:["popup","popup","twttrOAuth","cnnct","done"],twitter_link_declined:["popup","popup","twttrOAuth","cnnct","dclnd"],twitter_link_error:["popup","popup","twttrOAuth","cnnct","err"],twitter_unlink_done:["popup","popup","twttrOAuth","dscnnct","done"],twitter_unlink_error:["popup","popup","twttrOAuth","dscnnct","err"]})},"1.0.0",{requires:["common-utils-rapid-clickmap"]});
YUI.add("_shared_module_offscreen_bin_modal_connected_accounts",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_offscreen_bin_modal_connected_accounts={base:'<div id="modal-conn-accounts" class="modal"> <h2 class="modal-hd"> {{_shared_module_offscreen_bin_modal_close_icon}} </h2> <div class="modal-bd"> {{oauth_success}} {{oauth_failure}} </div> <div class="modal-ft"> {{_shared_module_offscreen_bin_modal_btn_ok}} </div></div>',fb_disclaimer:"<div>{{str_facebook_disclaimer}}</div> ",tw_disclaimer:"<div>{{str_twitter_disclaimer}}</div> ",ln_disclaimer:"<div>{{str_linkedin_disclaimer}}</div> ",oauth_success:'<div class="header {{service}}"> <span></span> </div> <div class="bd">{{str_oauth_conn_success}}</div> <div class="disclaimer"> {{fb_disclaimer}} {{tw_disclaimer}} {{ln_disclaimer}} </div> ',oauth_failure:'<div class="header"></div> <div class="bd"> <span> {{str_oauth_conn_failed_title}} </span> </div> <div class="disclaimer"> <div>{{str_oauth_conn_failed}}</div> </div> '}},"1.0.0",{requires:["_shared_module_offscreen_bin_modal_close_icon","_shared_module_offscreen_bin_modal_btn_ok"]});
YUI.add("_shared_module_offscreen_bin_modal_ln_upsell",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_offscreen_bin_modal_ln_upsell={base:'<div id="modal-ln-upsell" class="modal"> <h2 class="modal-hd"> {{_shared_module_offscreen_bin_modal_close_icon}} </h2> <div class="modal-bd"> <div class="header linkedin upsell"> <span></span> </div> <div class="disclaimer"> <div> <p>{{str_linkedin_upsell1}}</p> <p>{{str_linkedin_upsell2}}</p> </div> <div>{{str_linkedin_upsell3}}</div> <div>{{str_linkedin_disclaimer2}}</div> <div>{{str_linkedin_disclaimer3}}</div> </div> </div> <div class="modal-ft"> <button id="okayModalOverlay" class="btn left right default" title="{{str_linkedin_connect}}" role="button" data-action="connect-ln">{{str_linkedin_connect}}</button> <button id="cancelModalOverlay" class="btn left right" data-action="cancel" title="{{str_btn_cancel}}" role="button">{{str_btn_cancel}}</button> </div></div>'}},"1.0.0",{requires:["_shared_module_offscreen_bin_modal_close_icon"]});
YUI.add("mail-common-connected-accounts",function(e){var t,n=e.xobniContacts,r=e.common.Utils,i=e.common.net.SessionMgr,s=n.searchAPI,o=e.ui.Templates,u=n.Utils.getXobniBaseURL(),a="/neo/oauth",f=r.substitute,l=o._shared_module_offscreen_bin_modal_connected_accounts,c=o._shared_module_offscreen_bin_modal_ln_upsell,h=[],p=["facebook","linkedin","twitter"];t=function(t){var n=this;e.augment(n,e.EventTarget),h.push(n.once("statTokenStatus",n.statTokenStatus,n))},t.prototype={formattedStatus:null,dialog:null,setup:function(){var e=this;n.isXobnified&&n.isXobnified(function(t){t===!0&&e.fetchFormattedStatus()})},linkTo:function(t,n,r){var i=this,s=a+"?service="+t+"&cmd=link&wssid="+encodeURIComponent(NeoConfig.wssid),o=700,u=500,f=screen.width/2-o/2,l=screen.height/2-u/2,c,p;if(i.isValidServiceProvider(t))if(t==="linkedin"&&!r)e.fire("mt:click",{action:"ln_interstitial"}),e.fire("util:ymstats",{name:"oauth_linkedin_interstitial_rendered"}),i.showDialog({service:"upsell"},n);else{p=t+"_oauth_popup";for(c in h)h[c].detach();h=[],e.fire("mt:click",{action:p}),e.fire("util:ymstats",{name:"oauth_"+p}),e.fire("util:ymstats",{name:"ca_popup",tags:{service:t}}),e.fire("util:ymstats",{name:"ca_popup_dupe",tags:{service:t}}),h.push(e.once("OAUTH:CONN_ACCOUNT",i._handleOAuthResponse,i,n)),window.open(s,"_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+o+", height="+u+", top="+l+", left="+f)}},unlinkFrom:function(t,n){var r=this,i,s,o;if(r.isValidServiceProvider(t)){i="?service="+t+"&cmd=unlink&ymreqid="+(e.common.net.Session.genReqID?e.common.net.Session.genReqID():"NO_YMREQID_LOADED")+"&wssid="+NeoConfig.wssid,s={method:"GET",on:{complete:function(n,r){var i=r.responseText&&r.responseText.length&&e.JSON.parse(r.responseText);i||(i={service:t,command:"unlink",status:0}),e.fire("OAUTH:CONN_ACCOUNT",i)}}};for(o in h)h[o].detach();return h=[],h.push(e.once("OAUTH:CONN_ACCOUNT",r._handleOAuthResponse,r,n)),e.io(a+i,s)}},_handleOAuthResponse:function(t,n){var r=this,i=t.service,s=t.command,o=parseInt(t.status,10),u,a;(s==="done"||o===-9999)&&t.wssid&&(NeoConfig.wssid=t.wssid),o==200&&o<300&&s==="done"&&(r.pingWorkflow(i),r.showDialog(t)),o==200&&s==="unlink"&&r.pingWorkflow(i),!(o==200&&o<300)&&o!==412&&s!=="unlink"&&r.showDialog(t,n),r.fetchFormattedStatus(),n&&n(t),e.fire("util:ymstats",{name:"connected_accounts_oauth",tags:{service:i,status:o,command:s}});if(s==="done"||s==="unlink")o==200&&o<300?u="done":o===412?u="declined":u="error",s=s==="done"?"link":s,r.isValidServiceProvider(i)&&u&&(a=i+"_"+s+"_"+u,e.fire("mt:click",{action:a}),e.fire("util:ymstats",{name:"oauth_"+a}))},showDialog:function(t,n){var r=this,i,s,u={twitter:strings.str_branding_twitter,facebook:strings.str_branding_facebook,linkedin:strings.str_branding_linkedin};s={oauth_success:function(e,t,n){var r=n,i=parseInt(e.status,10);return i>=200&&i<300?(e={service:e.service,service_provider:u[e.service]},f(l.oauth_success,e,s,{},strings,o,r)):""},fb_disclaimer:function(e,t,n){return e.service==="facebook"?f(l.fb_disclaimer,e,s,{},strings):""},tw_disclaimer:function(e,t,n){return e.service==="twitter"?f(l.tw_disclaimer,e,s,{},strings):""},ln_disclaimer:function(e,t,n){return e.service==="linkedin"?f(l.ln_disclaimer,e,s,{},strings):""},oauth_failure:function(e,t,n){var r=parseInt(e.status,10);return r>=200&&r<300?"":(e={service:e.service,service_provider:u[e.service]},f(l.oauth_failure,e,s,{},strings))}},t.service==="upsell"?i=f(c.base,{},null,{},strings,o):i=f(l.base,t,s,{},strings,o,r),r.dialog=new e.comms.ui.Dialog({template:i,centered:!0,zIndex:39e3,focusedNode:".modal"}),r.dialog.render(),r.bindDialogUI(n),r.dialog.show()},bindDialogUI:function(t){var n=this,i=n.dialog.get("contentBox"),s,o;for(o in h)h[o].detach();h=[],h.push(i.delegate("click",function(i){var s=r.getDataAction(i),o=s.action,u;switch(o){case"retry":u=s.node.getAttribute("data-value"),e.fire("util:ymstats",{name:"connected_accounts_retry",tags:{service:u}}),n.destroyDialog(),n.linkTo(u,t);break;case"connect-ln":n.destroyDialog(),n.linkTo("linkedin",t,!0);break;case"ok":case"cancel":n.destroyDialog(o)}},"*[data-action]")),h.push(n.dialog.on("dialog:action",function(e){var t=e.dataAction;t==="cancel"&&n.destroyDialog(t)}))},destroyDialog:function(t){var n=this,r;if(n.dialog){t==="cancel"&&n.dialog.get("contentBox").get("id")==="modal-ln-upsell"&&(e.fire("mt:click",{action:"ln_interstitial_close"}),e.fire("util:ymstats",{name:"oauth_linkedin_interstitial_closed"}),e.fire("util:ymstats",{name:"ln_interstitial",tags:{action:t}}));for(r in h)h[r].detach();h=[],n.dialog.destroy(),n.dialog=null}},getStatusBySPID:function(e){var t=this,n,r;return t.formattedStatus!==null&&(r=t.formattedStatus.results,r&&r[e]?n=!r[e].is_expired:n=!1),n},getStatus:function(t,n){var r=this;return typeof n=="function"&&(r.formattedStatus===null?e.once("status_retrieved",function(){n(r.getStatusBySPID(t))}):n(r.getStatusBySPID(t))),r.getStatusBySPID(t)},getAllSPIDStatus:function(t){var n=this;return typeof t=="function"&&(n.formattedStatus===null?e.once("status_retrieved",function(){t(n.formattedStatus)}):t(n.formattedStatus)),n.formattedStatus},fetchFormattedStatus:function(){var t=this,n,r;n=function(n){t.formattedStatus=n,t.fire("status_retrieved",t.formattedStatus),t.fire("statTokenStatus",t.formattedStatus),e.fire("util:ymstats",{name:"connected_accounts",tags:{api:"formatted",result:"success"}})},r=function(t){var n=this;n.formattedStatus=null,n.fire("status_retrieved",n.formattedStatus),e.fire("util:ymstats",{name:"connected_accounts",tags:{api:"formatted",result:"failure"}})},s.formatted(e.bind(n,t),e.bind(r,t))},pingWorkflow:function(t){var n=this,r,i;r=function(n){e.fire("util:ymstats",{name:"connected_accounts",tags:{api:"workflow",source:t,result:"success"}})},i=function(n){e.fire("util:ymstats",{name:"connected_accounts",tags:{api:"workflow",source:t,result:"failure"}})},s.workflow(t,e.bind(r,n),e.bind(i,n))},isValidServiceProvider
:function(t){return e.Array.indexOf(p,t)>=0?!0:!1},statTokenStatus:function(){var t=this,n=r.settings.value("facebook_credstore_spid"),i=r.settings.value("twitter_credstore_spid"),s=r.settings.value("linkedin_credstore_spid");e.fire("util:ymstats",{name:"credstore_token_status",tags:{facebook:t.getStatusBySPID(n),twitter:t.getStatusBySPID(i),linkedin:t.getStatusBySPID(s),isCorp:NeoConfig.isCorpmail}})}},e.namespace("mail.common"),window.ConnectedAccounts=window.ConnectedAccounts||new t,e.mail.common.ConnectedAccounts=window.ConnectedAccounts,e.mail.common.ConnectedAccounts.setup()},"0.0.1",{requires:["io-base","event-base","node-base","ymma-stats","xobni-utilities","common-net-session","xobni-utilities","isXobnifiedCheck","xobni-contacts-search-api","common-ui-dialog-helper","mail-common-connected-accounts-ult","_shared_module_offscreen_bin_modal_connected_accounts","_shared_module_offscreen_bin_modal_ln_upsell"]});
YUI.add("hovercard-ult",function(A){A.mix(A.common.Utils.RapidCM,{"cmps_hvrCrdNewMsg":["hvrCrd","cmpsTb","cmpsHdr","hvrCrdNewMsg"],"cmps_hvrCrdNewIM":["hvrCrd","cmpsTb","cmpsHdr","hvrCrdNewIM"],"cmps_hvrCrdSrchMsg":["hvrCrd","cmpsTb","cmpsHdr","hvrCrdSrchMsg"],"cmps_hvrCrdAddCntct":["hvrCrd","cmpsTb","cmpsHdr","hvrCrdAddCntct"],"cmps_hvrCrdLnkBkyrd":["hvrCrd","cmpsTb","cmpsHdr","hvrCrdLnkBkyrd"],"cmps_hvrCrdLnkFb":["hvrCrd","cmpsTb","cmpsHdr","hvrCrdLnkFb"],"cmps_hvrCrdLnkTwtr":["hvrCrd","cmpsTb","cmpsHdr","hvrCrdLnkTwtr"],"msgRd_hvrCrdNewMsg":["hvrCrd","msgRdTb","msgHdr","hvrCrdNewMsg"],"msgRd_hvrCrdNewIM":["hvrCrd","msgRdTb","msgHdr","hvrCrdNewIM"],"msgRd_hvrCrdSrchMsg":["hvrCrd","msgRdTb","msgHdr","hvrCrdSrchMsg"],"msgRd_hvrCrdAddCntct":["hvrCrd","msgRdTb","msgHdr","hvrCrdAddCntct"],"msgRd_hvrCrdLnkBkyrd":["hvrCrd","msgRdTb","msgHdr","hvrCrdLnkBkyrd"],"msgRd_hvrCrdLnkFb":["hvrCrd","msgRdTb","msgHdr","hvrCrdLnkFb"],"msgRd_hvrCrdLnkTwtr":["hvrCrd","msgRdTb","msgHdr","hvrCrdLnkTwtr"],"thrdRd_hvrCrdNewMsg":["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdNewMsg"],"thrdRd_hvrCrdNewIM":["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdNewIM"],"thrdRd_hvrCrdSrchMsg":["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdSrchMsg"],"thrdRd_hvrCrdAddCntct":["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdAddCntct"],"thrdRd_hvrCrdLnkBkyrd":["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdLnkBkyrd"],"thrdRd_hvrCrdLnkFb":["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdLnkFb"],"thrdRd_hvrCrdLnkTwtr":["thrdRead","thrdRdTb","msg","msgHdr","hvrCrd","hvrCrdLnkTwtr"]});A.mix(A.common.Utils.RapidVM,{cmps_hvrCrd:["cmps_hvrCrdNewMsg","cmps_hvrCrdNewIM","cmps_hvrCrdSrchMsg","cmps_hvrCrdAddCntct","cmps_hvrCrdLnkBkyrd","cmps_hvrCrdLnkFb","cmps_hvrCrdLnkTwtr"],msgRd_hvrCrd:["msgRd_hvrCrdNewMsg","msgRd_hvrCrdNewIM","msgRd_hvrCrdSrchMsg","msgRd_hvrCrdAddCntct","msgRd_hvrCrdLnkBkyrd","msgRd_hvrCrdLnkFb","msgRd_hvrCrdLnkTwtr"],thrdRd_hvrCrd:["thrdRd_hvrCrdNewMsg","thrdRd_hvrCrdNewIM","thrdRd_hvrCrdSrchMsg","thrdRd_hvrCrdAddCntct","thrdRd_hvrCrdLnkBkyrd","thrdRd_hvrCrdLnkFb","thrdRd_hvrCrdLnkTwtr"]});},"1.0.0",{requires:["common-utils-rapid-clickmap","common-utils-rapid-viewmap"]});YUI.add("_shared_module_offscreen_bin_contacts_hovercard",function(e){e.namespace("ui.Templates"),e.ui.Templates._shared_module_offscreen_bin_contacts_hovercard={base:'<div class=\'hovercard-arrow\'> <div class=\'inner\'></div></div><div id="hovercard" class="size-{{card_size}}"> <div class="image icon-attendee"> {{profile_photo}} {{fb_connect}} </div> <div class="bd"> <div class="name" tabindex="-1" > <span>{{name}}</span> </div> {{_title}} {{_email}} {{_phone}} <div class="link search" tabindex="-1" > <i class="icon icon-search"></i><span tabindex="-1" data-action="search-msg" title="{{str_people_card_search_msgs}}" >{{str_people_card_msgs}}</span> </div> </div> <div class="footer"> <div class="more"> <span data-action="more"> <i class="icon icon-more" ></i> </span> </div> <div class="menu-more optionMenu" role="menu" tabindex="-1"> <ul role="group"> {{add_contact}} {{edit_card}} <li data-action="copy-email" class="copy-email clipboard disabled" role="presentation" title="{{str_hovercard_copy_email}}"> <a href="#" role="menuitem" tabindex="-1" ><span>{{str_hovercard_copy_email}}</span></a> </li> <li data-action="copy-all" id="copy_all" class="copy-all clipboard disabled" role="presentation" title="{{str_hovercard_copy_all}}"> <a href="#" role="menuitem" tabindex="-1" ><span>{{str_hovercard_copy_all}}</span></a> </li> </ul> </div> <div class="social"> {{_backyard}} {{_facebook}} {{_flickr}} {{_linkedin}} {{_twitter}} </div> </div></div>',profile_photo:'<div class="image" id="hcardProfileImg" style="background-image: url({{image_url}}/v4/contacts/{{id}}/photo?spsize=250X250&badge=true&u={{updated}}&y-dc=hc-{{buildNumber}})" data-action="open-img-src" data-value=""> <img style="display:none" id="upsellImg" src="{{image_url}}/v4/contacts/{{id}}/photo?spsize=250X250&badge=true&u={{updated}}&y-dc=hc-{{buildNumber}}" /> </div> ',fb_connect:'<div class="fb-connect hidden" data-action="fb-connect"> <span><i class="icon icon-logo-facebook"></i></span> <span class="label">{{str_hovercard_get_photos}}</span> <span class="decline" data-action="rm-fb-connect" title="{{str_hovercard_fb_dismiss}}">x</span> </div> ',_title:'<div class="title"> <span>{{title}}</span> </div> ',_email:'<div class="link email" tabindex="-1" title="{{str_people_card_new_compose}}" data-to="{{email}}" data-name="{{name}}" > <i class="icon icon-mail-inbox"></i><span data-action="new-message" ><a href="mailto:{{email}}">{{email}}</a></span> </div> ',_phone:'<div class="phone" tabindex="-1" > <i class="icon icon-mobile-phone"></i><span dir="ltr" class="{{phone_style}}" title="{{phone_source}}" >{{phone}}</span> </div> ',add_contact:'<li data-action="add-contact" role="presentation" title="{{str_people_card_add_contacts}}"> <a href="#" role="menuitem" tabindex="-1" ><span>{{str_people_card_add_contacts}}</span></a> </li> ',edit_card:'<li data-action="edit-card" role="presentation" title="{{str_hovercard_edit_card}}"> <a href="#" role="menuitem" tabindex="-1" ><span>{{str_hovercard_edit_card}}</span></a> </li> ',_backyard:'<i data-action="backyard" title="{{str_hovercard_backyard_profile}}" class="icon icon-logo-backyard" ></i> ',_facebook:'<i data-action="facebook" title="{{str_hovercard_facebook_profile}}" class="icon icon-linkedin" ></i> ',_flickr:'<span class="circle" data-action="flickr" title="{{str_hovercard_flickr_profile}}"> <span class="inner c1"></span> <span class="inner c2"></span> </span> ',_linkedin:'<i data-action="linkedin" title="{{str_hovercard_linkedin_profile}}" class="icon icon-facebook" ></i> ',_twitter:'<i data-action="twitter" title="{{str_hovercard_twitter_profile}} @{{twitter}}" class="icon icon-twitter" ></i> '}},"1.0.0");
YUI.add("_shared_module_offscreen_bin_contacts_hovercard_mini",function(A){A.namespace("ui.Templates");A.ui.Templates._shared_module_offscreen_bin_contacts_hovercard_mini={base:"<div class='hovercard-arrow'> <div class='inner'></div></div><div id=\"hovercard\" class=\"mini\"> {{contact_item}}</div>",profile_photo:'<div class="image" style="background-image: url({{image_url}}/v4/contacts/{{id}}/photo?spsize=72X72&badge=true&u={{updated}}&y-dc=hc-{{buildNumber}})"></div> ',_name:'<div class="name"> <span>{{name}}</span> </div> ',_email:'<div class="title" > <span>{{email}}</span> </div> ',_title:'<div class="title"> <span>{{title}}</span> </div> ',contact_item:'<div class="item"> <div class="line"></div> <div class="image icon-attendee"> {{profile_photo}} </div> <div class="bd"> {{_name}} {{_email}} {{_title}} </div> </div> '};},"1.0.0");YUI.add("contacts-ui-hovercard-plugin",function(e){var t,n=e.common.Utils,r=e.mail,i=e.ui.Templates,s=n.substitute,o=n.escapeHtml,u=n.unescapeHtml,a=r.ui.HoverCardDataStore,f=r.persist.MetaData,l=r.common.ConnectedAccounts,c=i._shared_module_offscreen_bin_contacts_hovercard,h=i._shared_module_offscreen_bin_contacts_hovercard_mini,p={regular:i._shared_module_offscreen_bin_contacts_hovercard,mini:i._shared_module_offscreen_bin_contacts_hovercard_mini},d=["mini","regular"],v="menu-active-item",m="hovercardHideFBConnect",g=null,y=function(){return window.clipboardData?e.UA.ie>=9?!1:!0:!1}(),b=[],w=e.xobniContacts.isXobnified(),E=e.xobniContacts.searchAPI,S=n.settings.value("facebook_credstore_spid"),x,T=function(e){return(!!e).toString()};t=e.Base.create("hovercard",e.Widget,[e.WidgetPosition,e.WidgetStack,e.WidgetPositionConstrain],{mouseMoveTimeout:null,initializer:function(){var e=this;e._triggerClassName="hcard",e._currTrigger={node:null,dataAddress:null,contactsData:[],cardSize:null,mouseX:t.OFFSCREEN_XY[0],mouseY:t.OFFSCREEN_XY[1]},e._eventHandles={delegateEnter:null,delegateLeave:null},e._timers={show:null,hide:null,offscreen:null}},bindUI:function(){var t=this;t._bindDelegate(),e.on("lozenge:highlight",function(){t._hideHoverCard()}),e.on("lozenge:remove",function(){t._hideHoverCard()}),e.on("HoverCard:hideHoverCard",function(){t._hideHoverCard()})},syncUI:function(){var e=this;e.get("boundingBox").setStyles({position:"absolute"})},_bindDelegate:function(){var t=this,n=t._eventHandles,r=e.one("#shellcontent");n.delegateEnter&&(n.delegateEnter.detach(),n.delegateEnter=null),n.delegateLeave&&(n.delegateLeave.detach(),n.delegateLeave=null),n.delegateEnter=r.delegate("mouseenter",e.bind(t._onNodeMouseEnter,t),"."+t._triggerClassName),n.delegateLeave=r.delegate("mouseleave",e.bind(t._onNodeMouseLeave,t),"."+t._triggerClassName)},setTriggerContent:function(t){var n=this,r=n._currTrigger,i=r.cardSize,s=n.get("contentBox"),o;e.Lang.isUndefined(w)&&(w=e.xobniContacts.isXobnified());if(i===d[0]||i===d[1]&&r.dataAddress===t[0].email)r.contactsData=t,s.set("innerHTML",""),o=n._getHoverCardMarkup(),s.appendChild(o),n._showHoverCard(),n._bindContentBoxUI(),i===d[1]&&t[0].id&&n.setProfilePhotoHandler()},_onNodeMouseEnter:function(t){var n=this,r=t.currentTarget;t.halt(),n._clearTimers();if(r.get("parentNode").hasClass("focus")||r.hasClass("lozenge-error")){n._hideHoverCard();return}n._triggerNodeChanged(t)&&(n._hideHoverCard(),n._toggleTitleAttr(r,!0),clearTimeout(n.mouseMoveTimeout),e.fire("hideHoverCardCallout"),n.mouseMoveTimeout=setTimeout(function(){n._clearTimers(),n._clearHandles(),n._setOffscreenTimer(),n._setCurrentTrigger(r,t.pageX,t.pageY)},400))},_triggerNodeChanged:function(e){var t=this,n=e.currentTarget,r=t._currTrigger.node,i=n&&n.getAttribute("data-address");return i?r?i===t._currTrigger.dataAddress&&n.getY()===r.getY()?!1:!0:!0:!1},_onNodeMouseLeave:function(t){var n=this,r=t.currentTarget;n._setNodeActive(!1),n._toggleTitleAttr(r,!1),clearTimeout(n.mouseMoveTimeout),n._timers.hide=e.later(n.get("delay.hide"),n,n._hideHoverCard)},_onNodeMouseMove:function(e){var t=this;e.halt(),t._currTrigger.mouseX=e.pageX,t._currTrigger.mouseY=e.pageY},_toggleTitleAttr:function(t,n){var r=e.mail.Tabs.getActiveTab().elContent,i=r&&r.all("[title]"),s="title",o="title-off",u,a,f;n?(u=o,a=s):(u=s,a=o),i&&i.each(function(e){f=e.getAttribute(a),f&&(e.setAttribute(a,""),e.setAttribute(u,f))})},_showHoverCard:function(){var n=this,r=n._currTrigger,i=r.node,s=i&&i.get("parentNode").hasClass("focus"),o,u;o=n._getXYForPosition(),o&&!s&&(n.move(o[0]+t.OFFSET_XY[0],o[1]+t.OFFSET_XY[1]),n._track("view","hvrCrd"),e.fire("util:ymstats",{name:"hovercard",tags:{size:r.cardSize,isCorp:T(NeoConfig.isCorpmail)}}),r.cardSize===d[1]&&(u=r.contactsData[0],e.fire("util:ymstats",{name:"hovercard_name",tags:{name:u.name===u.email?"email":"name",xuser:T(w),xcontact:T(u.id),isCorp:T(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_tel",tags:{phone:T(u.phone),xuser:T(w),xcontact:T(u.id),isCorp:T(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_im",tags:{im:T(u.im),xuser:T(w),xcontact:T(u.id),isCorp:T(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_facebook",tags:{facebook:T(u.facebook),xuser:T(w),xcontact:T(u.id),isCorp:T(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_twitter",tags:{twitter:T(u.twitter),xuser:T(w),xcontact:T(u.id),isCorp:T(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_linkedin",tags:{linkedin:T(u.linkedin),xuser:T(w),xcontact:T(u.id),isCorp:T(NeoConfig.isCorpmail)}}),e.fire("util:ymstats",{name:"hovercard_flickr",tags:{flickr:T(u.flickr),xuser:T(w),xcontact:T(u.id),isCorp:T(NeoConfig.isCorpmail)}})),e.ACWidgetInst&&e.ACWidgetInst.hide(),n.show(),n._clearOffscreenTimer())},_getXYForPosition:function(){var t=this,n=t.get("boundingBox"),r=n.one(".hovercard-arrow"),i=e.one("html"),s=strings.str_tog_loadRTLCss?!0:!1,o=t._currTrigger,u=o.node,a,f,l,c,h,p,d,v,m;if(u){f=o.mouseX,l=o.mouseY,a=u.getXY(),c=u.get("clientHeight"),h=u.get("clientWidth"),v=n.get("clientWidth")-20,m=n.get("clientHeight")-20;if(a[0]&&a[1])return p=i.get("clientWidth"),d=i.get("clientHeight"),s?f>v?(f=h<30?a[0]+10:a[0]-10,f=f+h-v):(f=h<30?a[0]-30:a[0]-10,r&&r.setStyle("right",v-30+"px")):(f=h<30?a[0]-30:a[0]-10,p-f<v&&(f=a[0]+h-v,r&&r.setStyle("left",v-30+"px"))),d-l<m?(l=a[1]-c-m,r.addClass("down")):(r.removeClass("down"),l=a[1]+20),[f,l]}return!1},_hideHoverCard:function(){var e=this;try{e._currTrigger.dataAddress&&(e._toggleTitleAttr(e._currTrigger.node,!1),e.hide(),e._setNodeActive(!1),e._clearCurrentTrigger(),e._clearTimers(),e._setOffscreenTimer())}catch(t){typeof globals!="undefined"&&globals.report?globals.report("caughterror:..-build-contacts-ui-hovercard-hovercard-plugin:1",t,"TRY_CATCH",1,1,1):window.console&&console.log&&console.log("caughterror:..-build-contacts-ui-hovercard-hovercard-plugin:1")}},_setNodeActive:function(e){var t=this,n=t._currTrigger
.node,r=t._currTrigger.cardSize;r===d[1]&&n&&n.getDOMNode()&&n.toggleClass("active",e)},hideHoverCard:function(){this._hideHoverCard()},_setOffscreenTimer:function(){var t=this,n=t._timers;t._clearOffscreenTimer(),n.offscreen=e.later(t.get("delay.offscreen"),t,t._moveOffscreen)},_moveOffscreen:function(){this.get("boundingBox").setStyles({top:t.OFFSCREEN_XY[0]})},_clearOffscreenTimer:function(){var e=this._timers;e.offscreen&&e.offscreen.cancel()},_setCurrentTrigger:function(t,n,r){var i=this,s=i._currTrigger,o,u,f=[],l;u=t.getAttribute("data-name"),o=t.getAttribute("data-address"),l=t.hasClass("cl"),s.mouseX=n,s.mouseY=r,s.node=t,s.dataAddress=o,t.hasClass("more")?(s.cardSize=d[0],o=o.split(","),e.Array.each(o,function(e){f.push({name:e,email:e,isCompose:l})})):(s.cardSize=d[1],f.push({name:u,email:o,isCompose:l})),i._setNodeActive(!0),g&&clearTimeout(g),g=setTimeout(function(){a.load(f,e.bind(i.setTriggerContent,i))},0)},_clearCurrentTrigger:function(){var e=this,t=e._currTrigger,n;t.node&&(n=t.node,t.node=null,t.dataAddress=null,e._clearHandles())},_clearTimers:function(){var e=this._timers;e.hide&&(e.hide.cancel(),e.hide=null)},_clearHandles:function(){var t;for(t in b)e.detach(b[t]);b=[]},_getHoverCardMarkup:function(){var t=this,r=t._currTrigger.contactsData,a=t._currTrigger.cardSize,c=a===d[0]?r:r[0],h=p[a],v,g=function(t){var n=e.contacts&&e.contacts.utils.getContactsByEmail(t)||[!1];return n[0]&&n[0].id>=0?n[0].id:!1};return v={_name:function(e,t,n){return e.name?(e.name=o(u(e.name)),s(h._name,e,null,null,strings)):""},_title:function(e,t,n){return e.title?(e.title=o(u(e.title)),s(h._title,e,null,null,strings)):""},_email:function(e,t,n){return a===d[1]||a===d[0]&&!e.title?(e.email=o(u(e.email)),s(h._email,e,null,null,strings)):""},_phone:function(e,t,r){return e.phone?(e.phone=o(u(e.phone)),e.isElcaro===!0?(e.phone_source=strings.str_hovercard_phone_src,e.phone_style=n.features.enabled("highlightElCaro")===!0?"elcaro":""):e.phone_source="",s(h._phone,e,null,null,strings)):""},add_contact:function(e,t,n){return g(e.email)===!1?s(h.add_contact,e,null,null,strings):""},edit_card:function(e,t,n){return e.id?s(h.edit_card,e,null,null,strings):""},_backyard:function(e,t,n){return e.corpId&&NeoConfig.isCorpmail?s(h._backyard,e,null,null,strings):""},_facebook:function(e,t,n){return e.facebook?(e.facebook=o(u(e.facebook)),s(h._facebook,e,null,null,strings)):""},_twitter:function(e,t,n){return e.twitter?(e.twitter=o(u(e.twitter)),s(h._twitter,e,null,null,strings)):""},_linkedin:function(t,n,r){return t.linkedin?(e.fire("util:ymstats",{name:"hovercard_linkedin_rendered"}),t.linkedin=o(u(t.linkedin)),s(h._linkedin,t,null,null,strings)):""},_flickr:function(e,t,n){return e.flickr?(e.flickr=o(u(e.flickr)),s(h._flickr,e,null,null,strings)):""},fb_connect:function(e,t,n){return w===!0&&l.getStatusBySPID(S)===!1&&f.get(m)!=="true"&&e.isKnownEntity===!1&&e.isMachineGenerated===!1?s(h.fb_connect,e,null,t,strings):""},profile_photo:function(e,t,n){return e.id?s(h.profile_photo,e,null,null,strings):""},contact_item:function(n,r,a){var f="";return e.Array.each(n,function(e){e.name=o(u(e.name)),f+=s(h.contact_item,e,v,{},strings,i,t)}),f}},c.name&&(c.name=o(u(c.name))),s(h.base,c,v,{},strings,i,t)},_bindContentBoxUI:function(){var t=this,r=t._currTrigger.contactsData[0],i=t.get("boundingBox"),s=t._currTrigger,o=s.node,u,a,f,l;t._clearHandles(),o&&(a=o.ancestor(".thread-item-list"),b.push(e.one("document").on("keydown",e.bind(function(e){var t=this;e.target.ancestor("#hovercard")||t._hideHoverCard()},t))),b.push(i.on("mouseenter",e.bind(function(e){var t=this;t._setNodeActive(!0),t._clearTimers()},t))),b.push(i.on("mouseleave",e.bind(function(t){var n=this,r=t.target.ancestor(".clipboard");r||(n._clearTimers(),n._timers.hide=e.later(n.get("delay.hide"),n,n._hideHoverCard))},t))),b.push(o.on("mousemove",e.bind(t._onNodeMouseMove,t))),a&&b.push(a.on("scroll",e.bind(t._hideHoverCard,t))),s.cardSize===d[1]&&(u=i.one(".fb-connect"),b.push(i.one(".more").on("mouseenter",e.bind(function(n){i.all("li."+v).removeClass(v),i.one(".menu-more").setStyle("display","block"),e.fire("util:ymstats",{name:"hovercard_action",tags:{action:"more",isCorp:T(NeoConfig.isCorpmail)}}),t._setupClipBoard()},t),t)),b.push(i.one(".footer").on("mouseleave",function(e){var t=e.target.ancestor(".clipboard");t||i.one(".menu-more").setStyle("display","none")})),b.push(i.one(".menu-more").delegate("mouseenter",e.bind(function(e){i.all("li."+v).removeClass(v)},t),"li")),b.push(i.delegate("click",function(r){f=n.getDataAction(r),l=f.action,r.halt(),t._handleAction(f),l!=="more"&&l!=="rm-fb-connect"&&l!=="open-img-src"&&t._hideHoverCard(),l!=="more"&&e.fire("util:ymstats",{name:"hovercard_action",tags:{action:l,isCorp:T(NeoConfig.isCorpmail)}})},"*[data-action]")),u&&r.id&&b.push(i.one("#upsellImg").on("error",function(e){u.removeClass("hidden")}))),s.cardSize===d[0]&&b.push(o.on("click",e.bind(t._hideHoverCard,t))))},_handleAction:function(t){var n=this,i=e.common.Utils.features.enabled("searchresults"),s=n._currTrigger.node,o=n._currTrigger.contactsData[0],u="click";switch(t.action){case"new-message":if(!s.hasClass("cl")){var a={cbfn:function(e){var t={};return t.to=[{name:o.name,email:o.email}],e.setHeader(t),!0}};e.fire("newMessage",a),n._track(u,"hvrCrdNewMsg")}break;case"new-im":e.fire("chats:sendIM",{id:o.im}),n._track(u,"hvrCrdNewIM");break;case"add-contact":e.use("contacts-ui-hovercard-addedit",function(e){(new r.ui.HoverCardAddEdit({action:"addContact",data:o})).show()}),n._track(u,"hvrCrdAddCntct");break;case"edit-card":e.use("contacts-ui-hovercard-addedit",function(e){(new r.ui.HoverCardAddEdit({action:"editCard",data:o})).show()});break;case"search-msg":e.use("mail-ui-execute-search-utils",function(e){e.mail.ui.ExecuteSearchUtils.doMailSearch({email:o.email,typeTag:"hovercard_search_email"})}),n._track(u,"hvrCrdSrchMsg");break;case"backyard":e.use("mail-common-corpmail",function(e){r.common.corpmail.showBackyardProfile(o.corpId
)}),n._track(u,"hvrCrdLnkBkyrd");break;case"facebook":window.open(o.facebook_url),n._track(u,"hvrCrdLnkFb");break;case"twitter":window.open(o.twitter_url),n._track(u,"hvrCrdLnkTwtr");break;case"linkedin":e.fire("util:ymstats",{name:"hovercard_linkedin_clicked"}),window.open(o.linkedin_url);break;case"flickr":window.open(o.flickr_url);break;case"copy-email":y&&window.clipboardData.setData("text",o.email);break;case"copy-all":y&&window.clipboardData.setData("text",[o.name,o.title,o.email,o.im,o.phone].join("\n"));break;case"fb-connect":l.linkTo("facebook");break;case"rm-fb-connect":n._dismissFBConnectButton(t.node);break;case"open-img-src":var f=t.node.getAttribute("data-value");n._openImageSrc(f)}},setProfilePhotoHandler:function(){var t=this,n=t._currTrigger.contactsData[0],r=t.get("boundingBox"),i=r.one("#hcardProfileImg"),s={facebook:strings.str_hovercard_facebook_profile,linkedin:strings.str_hovercard_linkedin_profile,twitter:strings.str_hovercard_twitter_profile+" @"+n.twitter,corpdir:strings.str_hovercard_backyard_profile,flickr:strings.str_hovercard_flickr_profile},o=function(t){t!==!1&&(n.photoSrc=t,["facebook","twitter","linkedin","flickr","corpdir"].indexOf(t)>-1&&(i.setAttribute("data-value",t),i.setAttribute("title",s[t]),i.setStyle("cursor","pointer"))),e.fire("util:ymstats",{name:"hovercard_imgsrc",tags:{src:t,isCorp:T(NeoConfig.isCorpmail)}})};e.Lang.isUndefined(n.photoSrc)?E.photo(n,e.bind(o,t)):o(n.photoSrc)},_openImageSrc:function(t){var n=this,i=n._currTrigger.contactsData[0],s;if(t){switch(t){case"corpdir":e.use("mail-common-corpmail",function(e){r.common.corpmail.showBackyardProfile(i.corpId)});break;case"facebook":window.open(i.facebook_url);break;case"twitter":window.open(i.twitter_url);break;case"linkedin":e.fire("util:ymstats",{name:"hovercard_linkedin_clicked"}),window.open(i.linkedin_url);break;case"flickr":window.open(i.flickr_url)}n._hideHoverCard(),e.fire("util:ymstats",{name:"hovercard_imgClkSrc",tags:{src:t,isCorp:T(NeoConfig.isCorpmail)}})}},_setupClipBoard:function(){var t=this,n,r=t._currTrigger.contactsData[0],i=t.get("contentBox"),s=t.get("contentBox").all(".clipboard"),o=e.SWFDetect.isFlashVersionAtLeast(10,1,0);y?s.removeClass("disabled"):o&&e.use("comms-ui-clipboard-plugin",function(o){n=o.comms.ui.ClipBoard,s.each(function(s){s instanceof e.Node&&s.plug(n,{moviepath:NeoConfig.copySwfMoviePath}).on("clipboard:load",function(){var n=this;n.removeClass("disabled"),n.on("mouseenter",function(e){this.hasClass("copy-email")?this.setAttribute("copy",r.email):this.setAttribute("copy",[r.name,r.title,r.email,r.phone].join("\n"))},n),n.on("mouseleave",function(e){n.removeClass(v)},n),n.clipboard.setEvent("click",e.bind(function(e){n.clipboard.hide(),t.hideHoverCard()},n),!0),n.clipboard.setEvent("mouseOver",function(e){i.all("li."+v).removeClass(v),n.addClass(v),n.focus()}),e.on("HoverCard:hideHoverCard",function(){n.clipboard.removeEvent("mouseOver"),n.clipboard.removeEvent("click"),n.clipboard.hide()})})}),e.on("clipboard:error",function(e){s.addClass("disabled")})})},_dismissFBConnectButton:function(e){e.ancestor(".fb-connect").remove(),f.set(m,"true"),f.save()},_track:function(t,n){var i,s=t==="view"?"mt:view":"mt:click",o=null;x||(x=r.Tabs),i=x.getActiveTab().get("widget").type,i==="messagepane"?o="msgRd":i==="convpane"?o="thrdRd":i==="author"&&(o="cmps"),o&&e.fire(s,{action:o+"_"+n})}},{OFFSCREEN_XY:[-1e4,-1e4],OFFSET_XY:[0,0],ATTRS:{shim:{value:!1},render:{value:!0},trigger:{value:".hcard"},zIndex:{value:100},delay:{value:{show:100,hide:300,auto:1e3,offscreen:0}},xy:{value:[-1e4,-1e4]},constrain:{value:!0}}}),e.namespace("mail.ui"),e.mail.ui.HoverCard=t},"0.0.1",{requires:["node","widget","widget-position","widget-position-constrain","widget-stack","event-mouseenter","common-utils","comms-utils","contacts-ui-hovercard-datastore","mail-common-connected-accounts","hovercard-ult","isXobnifiedCheck","xobni-contacts-search-api","mail-common-utils-settings","mail-common-utils-features","_shared_module_offscreen_bin_contacts_hovercard","_shared_module_offscreen_bin_contacts_hovercard_mini","hovercard_css"]});
